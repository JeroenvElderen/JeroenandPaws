"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/availability";
exports.ids = ["pages/api/availability"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Favailability&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cavailability.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Favailability&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cavailability.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_availability_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\availability.js */ \"(api)/./pages/api/availability.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_availability_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_availability_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/availability\",\n        pathname: \"/api/availability\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_availability_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmF2YWlsYWJpbGl0eSZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDYXZhaWxhYmlsaXR5LmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQzBEO0FBQzFEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyx1REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsdURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8/NDNmYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXGF2YWlsYWJpbGl0eS5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F2YWlsYWJpbGl0eVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2F2YWlsYWJpbGl0eVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Favailability&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cavailability.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./api/_lib/auth.js":
/*!**************************!*\
  !*** ./api/_lib/auth.js ***!
  \**************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst TOKEN_COOKIE = \"msTokens\";\nconst SCOPES = [\n    \"offline_access\",\n    \"Calendars.ReadWrite\"\n];\nconst requiredEnv = [\n    \"AZURE_CLIENT_ID\",\n    \"AZURE_CLIENT_SECRET\",\n    \"AZURE_TENANT_ID\",\n    \"BACKEND_BASE_URL\"\n];\nrequiredEnv.forEach((key)=>{\n    if (!process.env[key]) {\n        console.warn(`Missing env var ${key}`);\n    }\n});\nconst authority = `https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0`;\nconst redirectUri = process.env.AZURE_REDIRECT_URI || `${process.env.BACKEND_BASE_URL}/api/auth/microsoft/callback`;\nconst encryptionKey = crypto.createHash(\"sha256\").update(process.env.TOKEN_ENCRYPTION_KEY || process.env.AZURE_CLIENT_SECRET).digest();\nconst serializeCookie = (name, value, options = {})=>{\n    const segments = [\n        `${name}=${value}`\n    ];\n    if (options.maxAge) segments.push(`Max-Age=${options.maxAge}`);\n    if (options.domain) segments.push(`Domain=${options.domain}`);\n    if (options.path) segments.push(`Path=${options.path}`);\n    if (options.secure) segments.push(\"Secure\");\n    if (options.httpOnly) segments.push(\"HttpOnly\");\n    if (options.sameSite) segments.push(`SameSite=${options.sameSite}`);\n    return segments.join(\"; \");\n};\nconst parseCookieHeader = (header)=>{\n    if (!header) return {};\n    return header.split(/; */).reduce((acc, part)=>{\n        const [key, ...rest] = part.split(\"=\");\n        if (!key) return acc;\n        acc[key.trim()] = decodeURIComponent(rest.join(\"=\"));\n        return acc;\n    }, {});\n};\nconst encrypt = (data)=>{\n    const iv = crypto.randomBytes(16);\n    const cipher = crypto.createCipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    const encrypted = Buffer.concat([\n        cipher.update(JSON.stringify(data), \"utf8\"),\n        cipher.final()\n    ]);\n    const authTag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        authTag,\n        encrypted\n    ]).toString(\"base64\");\n};\nconst decrypt = (payload)=>{\n    const buffer = Buffer.from(payload, \"base64\");\n    const iv = buffer.subarray(0, 16);\n    const tag = buffer.subarray(16, 32);\n    const encrypted = buffer.subarray(32);\n    const decipher = crypto.createDecipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    decipher.setAuthTag(tag);\n    const decrypted = Buffer.concat([\n        decipher.update(encrypted),\n        decipher.final()\n    ]).toString(\"utf8\");\n    return JSON.parse(decrypted);\n};\nconst serializeTokens = (res, tokens)=>{\n    const encoded = encrypt(tokens);\n    const secure = \"development\" === \"production\";\n    const cookieString = serializeCookie(TOKEN_COOKIE, encoded, {\n        httpOnly: true,\n        secure,\n        sameSite: \"lax\",\n        path: \"/\",\n        maxAge: 60 * 60 * 24 * 30\n    });\n    res.setHeader(\"Set-Cookie\", cookieString);\n};\nconst parseTokens = (req)=>{\n    if (!req.headers.cookie) return null;\n    const cookies = parseCookieHeader(req.headers.cookie || \"\");\n    if (!cookies[TOKEN_COOKIE]) return null;\n    try {\n        return decrypt(cookies[TOKEN_COOKIE]);\n    } catch (error) {\n        console.error(\"Failed to decrypt token cookie\", error);\n        return null;\n    }\n};\nconst buildAuthUrl = async ()=>{\n    const params = new URLSearchParams({\n        client_id: process.env.AZURE_CLIENT_ID,\n        response_type: \"code\",\n        redirect_uri: redirectUri,\n        response_mode: \"query\",\n        scope: SCOPES.join(\" \"),\n        prompt: \"select_account\"\n    });\n    return `${authority}/authorize?${params.toString()}`;\n};\nconst tokenRequest = async (formData)=>{\n    const response = await fetch(`${authority}/token`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n        },\n        body: new URLSearchParams({\n            client_id: process.env.AZURE_CLIENT_ID,\n            client_secret: process.env.AZURE_CLIENT_SECRET,\n            redirect_uri: redirectUri,\n            ...formData\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Token endpoint error: ${response.status} ${error}`);\n    }\n    const data = await response.json();\n    return {\n        accessToken: data.access_token,\n        refreshToken: data.refresh_token,\n        expiresAt: new Date(Date.now() + data.expires_in * 1000).toISOString()\n    };\n};\nconst exchangeCodeForTokens = async (code)=>tokenRequest({\n        grant_type: \"authorization_code\",\n        code,\n        scope: SCOPES.join(\" \")\n    });\nconst refreshTokens = async (stored)=>{\n    if (!stored?.refreshToken) return null;\n    return tokenRequest({\n        grant_type: \"refresh_token\",\n        refresh_token: stored.refreshToken,\n        scope: SCOPES.join(\" \")\n    });\n};\nconst needsRefresh = (tokens)=>{\n    if (!tokens?.expiresAt) return true;\n    const expiresAt = new Date(tokens.expiresAt);\n    const refreshThreshold = Date.now() + 5 * 60 * 1000;\n    return expiresAt.getTime() <= refreshThreshold;\n};\nconst ensureTokens = async (req, res)=>{\n    const stored = parseTokens(req);\n    if (!stored) return null;\n    if (!needsRefresh(stored)) {\n        return stored;\n    }\n    const refreshed = await refreshTokens(stored);\n    if (refreshed) {\n        serializeTokens(res, refreshed);\n        return refreshed;\n    }\n    return null;\n};\nmodule.exports = {\n    buildAuthUrl,\n    ensureTokens,\n    exchangeCodeForTokens,\n    parseTokens,\n    serializeTokens\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU92RixPQUFPK0IsSUFBSSxDQUFDO0lBQ3JCO0FBRUYsTUFBTWtGLGdCQUFnQixPQUFPQztJQUMzQixJQUFJLENBQUNBLFFBQVFYLGNBQWMsT0FBTztJQUNsQyxPQUFPZCxhQUFhO1FBQ2xCdUIsWUFBWTtRQUNaUixlQUFlVSxPQUFPWCxZQUFZO1FBQ2xDaEIsT0FBT3ZGLE9BQU8rQixJQUFJLENBQUM7SUFDckI7QUFDRjtBQUVBLE1BQU1vRixlQUFlLENBQUM5QztJQUNwQixJQUFJLENBQUNBLFFBQVFvQyxXQUFXLE9BQU87SUFDL0IsTUFBTUEsWUFBWSxJQUFJQyxLQUFLckMsT0FBT29DLFNBQVM7SUFDM0MsTUFBTVcsbUJBQW1CVixLQUFLQyxHQUFHLEtBQUssSUFBSSxLQUFLO0lBQy9DLE9BQU9GLFVBQVVZLE9BQU8sTUFBTUQ7QUFDaEM7QUFFQSxNQUFNRSxlQUFlLE9BQU81QyxLQUFLTjtJQUMvQixNQUFNOEMsU0FBU3pDLFlBQVlDO0lBQzNCLElBQUksQ0FBQ3dDLFFBQVEsT0FBTztJQUVwQixJQUFJLENBQUNDLGFBQWFELFNBQVM7UUFDekIsT0FBT0E7SUFDVDtJQUVBLE1BQU1LLFlBQVksTUFBTU4sY0FBY0M7SUFDdEMsSUFBSUssV0FBVztRQUNicEQsZ0JBQWdCQyxLQUFLbUQ7UUFDckIsT0FBT0E7SUFDVDtJQUVBLE9BQU87QUFDVDtBQUVBQyxPQUFPQyxPQUFPLEdBQUc7SUFDZjFDO0lBQ0F1QztJQUNBUjtJQUNBckM7SUFDQU47QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2plcm9lbmFuZHBhd3MvLi9hcGkvX2xpYi9hdXRoLmpzPzc2MjQiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY3J5cHRvID0gcmVxdWlyZShcImNyeXB0b1wiKTtcclxuXHJcbmNvbnN0IFRPS0VOX0NPT0tJRSA9IFwibXNUb2tlbnNcIjtcclxuY29uc3QgU0NPUEVTID0gW1wib2ZmbGluZV9hY2Nlc3NcIiwgXCJDYWxlbmRhcnMuUmVhZFdyaXRlXCJdO1xyXG5cclxuY29uc3QgcmVxdWlyZWRFbnYgPSBbXHJcbiAgXCJBWlVSRV9DTElFTlRfSURcIixcclxuICBcIkFaVVJFX0NMSUVOVF9TRUNSRVRcIixcclxuICBcIkFaVVJFX1RFTkFOVF9JRFwiLFxyXG4gIFwiQkFDS0VORF9CQVNFX1VSTFwiLFxyXG5dO1xyXG5cclxucmVxdWlyZWRFbnYuZm9yRWFjaCgoa2V5KSA9PiB7XHJcbiAgaWYgKCFwcm9jZXNzLmVudltrZXldKSB7XHJcbiAgICBjb25zb2xlLndhcm4oYE1pc3NpbmcgZW52IHZhciAke2tleX1gKTtcclxuICB9XHJcbn0pO1xyXG5cclxuY29uc3QgYXV0aG9yaXR5ID0gYGh0dHBzOi8vbG9naW4ubWljcm9zb2Z0b25saW5lLmNvbS8ke3Byb2Nlc3MuZW52LkFaVVJFX1RFTkFOVF9JRH0vb2F1dGgyL3YyLjBgO1xyXG5jb25zdCByZWRpcmVjdFVyaSA9XHJcbiAgcHJvY2Vzcy5lbnYuQVpVUkVfUkVESVJFQ1RfVVJJIHx8XHJcbiAgYCR7cHJvY2Vzcy5lbnYuQkFDS0VORF9CQVNFX1VSTH0vYXBpL2F1dGgvbWljcm9zb2Z0L2NhbGxiYWNrYDtcclxuXHJcbmNvbnN0IGVuY3J5cHRpb25LZXkgPSBjcnlwdG9cclxuICAuY3JlYXRlSGFzaChcInNoYTI1NlwiKVxyXG4gIC51cGRhdGUocHJvY2Vzcy5lbnYuVE9LRU5fRU5DUllQVElPTl9LRVkgfHwgcHJvY2Vzcy5lbnYuQVpVUkVfQ0xJRU5UX1NFQ1JFVClcclxuICAuZGlnZXN0KCk7XHJcblxyXG5jb25zdCBzZXJpYWxpemVDb29raWUgPSAobmFtZSwgdmFsdWUsIG9wdGlvbnMgPSB7fSkgPT4ge1xyXG4gIGNvbnN0IHNlZ21lbnRzID0gW2Ake25hbWV9PSR7dmFsdWV9YF07XHJcbiAgaWYgKG9wdGlvbnMubWF4QWdlKSBzZWdtZW50cy5wdXNoKGBNYXgtQWdlPSR7b3B0aW9ucy5tYXhBZ2V9YCk7XHJcbiAgaWYgKG9wdGlvbnMuZG9tYWluKSBzZWdtZW50cy5wdXNoKGBEb21haW49JHtvcHRpb25zLmRvbWFpbn1gKTtcclxuICBpZiAob3B0aW9ucy5wYXRoKSBzZWdtZW50cy5wdXNoKGBQYXRoPSR7b3B0aW9ucy5wYXRofWApO1xyXG4gIGlmIChvcHRpb25zLnNlY3VyZSkgc2VnbWVudHMucHVzaChcIlNlY3VyZVwiKTtcclxuICBpZiAob3B0aW9ucy5odHRwT25seSkgc2VnbWVudHMucHVzaChcIkh0dHBPbmx5XCIpO1xyXG4gIGlmIChvcHRpb25zLnNhbWVTaXRlKSBzZWdtZW50cy5wdXNoKGBTYW1lU2l0ZT0ke29wdGlvbnMuc2FtZVNpdGV9YCk7XHJcbiAgcmV0dXJuIHNlZ21lbnRzLmpvaW4oXCI7IFwiKTtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlQ29va2llSGVhZGVyID0gKGhlYWRlcikgPT4ge1xyXG4gIGlmICghaGVhZGVyKSByZXR1cm4ge307XHJcbiAgcmV0dXJuIGhlYWRlci5zcGxpdCgvOyAqLykucmVkdWNlKChhY2MsIHBhcnQpID0+IHtcclxuICAgIGNvbnN0IFtrZXksIC4uLnJlc3RdID0gcGFydC5zcGxpdChcIj1cIik7XHJcbiAgICBpZiAoIWtleSkgcmV0dXJuIGFjYztcclxuICAgIGFjY1trZXkudHJpbSgpXSA9IGRlY29kZVVSSUNvbXBvbmVudChyZXN0LmpvaW4oXCI9XCIpKTtcclxuICAgIHJldHVybiBhY2M7XHJcbiAgfSwge30pO1xyXG59O1xyXG5cclxuY29uc3QgZW5jcnlwdCA9IChkYXRhKSA9PiB7XHJcbiAgY29uc3QgaXYgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpO1xyXG4gIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIGVuY3J5cHRpb25LZXksIGl2KTtcclxuICBjb25zdCBlbmNyeXB0ZWQgPSBCdWZmZXIuY29uY2F0KFtcclxuICAgIGNpcGhlci51cGRhdGUoSlNPTi5zdHJpbmdpZnkoZGF0YSksIFwidXRmOFwiKSxcclxuICAgIGNpcGhlci5maW5hbCgpLFxyXG4gIF0pO1xyXG4gIGNvbnN0IGF1dGhUYWcgPSBjaXBoZXIuZ2V0QXV0aFRhZygpO1xyXG4gIHJldHVybiBCdWZmZXIuY29uY2F0KFtpdiwgYXV0aFRhZywgZW5jcnlwdGVkXSkudG9TdHJpbmcoXCJiYXNlNjRcIik7XHJcbn07XHJcblxyXG5jb25zdCBkZWNyeXB0ID0gKHBheWxvYWQpID0+IHtcclxuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShwYXlsb2FkLCBcImJhc2U2NFwiKTtcclxuICBjb25zdCBpdiA9IGJ1ZmZlci5zdWJhcnJheSgwLCAxNik7XHJcbiAgY29uc3QgdGFnID0gYnVmZmVyLnN1YmFycmF5KDE2LCAzMik7XHJcbiAgY29uc3QgZW5jcnlwdGVkID0gYnVmZmVyLnN1YmFycmF5KDMyKTtcclxuICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KFwiYWVzLTI1Ni1nY21cIiwgZW5jcnlwdGlvbktleSwgaXYpO1xyXG4gIGRlY2lwaGVyLnNldEF1dGhUYWcodGFnKTtcclxuICBjb25zdCBkZWNyeXB0ZWQgPSBCdWZmZXIuY29uY2F0KFtcclxuICAgIGRlY2lwaGVyLnVwZGF0ZShlbmNyeXB0ZWQpLFxyXG4gICAgZGVjaXBoZXIuZmluYWwoKSxcclxuICBdKS50b1N0cmluZyhcInV0ZjhcIik7XHJcbiAgcmV0dXJuIEpTT04ucGFyc2UoZGVjcnlwdGVkKTtcclxufTtcclxuXHJcbmNvbnN0IHNlcmlhbGl6ZVRva2VucyA9IChyZXMsIHRva2VucykgPT4ge1xyXG4gIGNvbnN0IGVuY29kZWQgPSBlbmNyeXB0KHRva2Vucyk7XHJcbiAgY29uc3Qgc2VjdXJlID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiO1xyXG4gIGNvbnN0IGNvb2tpZVN0cmluZyA9IHNlcmlhbGl6ZUNvb2tpZShUT0tFTl9DT09LSUUsIGVuY29kZWQsIHtcclxuICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgc2VjdXJlLFxyXG4gICAgc2FtZVNpdGU6IFwibGF4XCIsXHJcbiAgICBwYXRoOiBcIi9cIixcclxuICAgIG1heEFnZTogNjAgKiA2MCAqIDI0ICogMzAsXHJcbiAgfSk7XHJcbiAgcmVzLnNldEhlYWRlcihcIlNldC1Db29raWVcIiwgY29va2llU3RyaW5nKTtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlVG9rZW5zID0gKHJlcSkgPT4ge1xyXG4gIGlmICghcmVxLmhlYWRlcnMuY29va2llKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBjb29raWVzID0gcGFyc2VDb29raWVIZWFkZXIocmVxLmhlYWRlcnMuY29va2llIHx8IFwiXCIpO1xyXG4gIGlmICghY29va2llc1tUT0tFTl9DT09LSUVdKSByZXR1cm4gbnVsbDtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIGRlY3J5cHQoY29va2llc1tUT0tFTl9DT09LSUVdKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBkZWNyeXB0IHRva2VuIGNvb2tpZVwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBidWlsZEF1dGhVcmwgPSBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICBjbGllbnRfaWQ6IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9JRCxcclxuICAgIHJlc3BvbnNlX3R5cGU6IFwiY29kZVwiLFxyXG4gICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcclxuICAgIHJlc3BvbnNlX21vZGU6IFwicXVlcnlcIixcclxuICAgIHNjb3BlOiBTQ09QRVMuam9pbihcIiBcIiksXHJcbiAgICBwcm9tcHQ6IFwic2VsZWN0X2FjY291bnRcIixcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGAke2F1dGhvcml0eX0vYXV0aG9yaXplPyR7cGFyYW1zLnRvU3RyaW5nKCl9YDtcclxufTtcclxuXHJcbmNvbnN0IHRva2VuUmVxdWVzdCA9IGFzeW5jIChmb3JtRGF0YSkgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7YXV0aG9yaXR5fS90b2tlbmAsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIgfSxcclxuICAgIGJvZHk6IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xyXG4gICAgICBjbGllbnRfaWQ6IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9JRCxcclxuICAgICAgY2xpZW50X3NlY3JldDogcHJvY2Vzcy5lbnYuQVpVUkVfQ0xJRU5UX1NFQ1JFVCxcclxuICAgICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcclxuICAgICAgLi4uZm9ybURhdGEsXHJcbiAgICB9KSxcclxuICB9KTtcclxuXHJcbiAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRva2VuIGVuZHBvaW50IGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtlcnJvcn1gKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIGFjY2Vzc1Rva2VuOiBkYXRhLmFjY2Vzc190b2tlbixcclxuICAgIHJlZnJlc2hUb2tlbjogZGF0YS5yZWZyZXNoX3Rva2VuLFxyXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgZGF0YS5leHBpcmVzX2luICogMTAwMCkudG9JU09TdHJpbmcoKSxcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgZXhjaGFuZ2VDb2RlRm9yVG9rZW5zID0gYXN5bmMgKGNvZGUpID0+XHJcbiAgdG9rZW5SZXF1ZXN0KHtcclxuICAgIGdyYW50X3R5cGU6IFwiYXV0aG9yaXphdGlvbl9jb2RlXCIsXHJcbiAgICBjb2RlLFxyXG4gICAgc2NvcGU6IFNDT1BFUy5qb2luKFwiIFwiKSxcclxuICB9KTtcclxuXHJcbmNvbnN0IHJlZnJlc2hUb2tlbnMgPSBhc3luYyAoc3RvcmVkKSA9PiB7XHJcbiAgaWYgKCFzdG9yZWQ/LnJlZnJlc2hUb2tlbikgcmV0dXJuIG51bGw7XHJcbiAgcmV0dXJuIHRva2VuUmVxdWVzdCh7XHJcbiAgICBncmFudF90eXBlOiBcInJlZnJlc2hfdG9rZW5cIixcclxuICAgIHJlZnJlc2hfdG9rZW46IHN0b3JlZC5yZWZyZXNoVG9rZW4sXHJcbiAgICBzY29wZTogU0NPUEVTLmpvaW4oXCIgXCIpLFxyXG4gIH0pO1xyXG59O1xyXG5cclxuY29uc3QgbmVlZHNSZWZyZXNoID0gKHRva2VucykgPT4ge1xyXG4gIGlmICghdG9rZW5zPy5leHBpcmVzQXQpIHJldHVybiB0cnVlO1xyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKHRva2Vucy5leHBpcmVzQXQpO1xyXG4gIGNvbnN0IHJlZnJlc2hUaHJlc2hvbGQgPSBEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMDtcclxuICByZXR1cm4gZXhwaXJlc0F0LmdldFRpbWUoKSA8PSByZWZyZXNoVGhyZXNob2xkO1xyXG59O1xyXG5cclxuY29uc3QgZW5zdXJlVG9rZW5zID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3Qgc3RvcmVkID0gcGFyc2VUb2tlbnMocmVxKTtcclxuICBpZiAoIXN0b3JlZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIGlmICghbmVlZHNSZWZyZXNoKHN0b3JlZCkpIHtcclxuICAgIHJldHVybiBzdG9yZWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdCByZWZyZXNoZWQgPSBhd2FpdCByZWZyZXNoVG9rZW5zKHN0b3JlZCk7XHJcbiAgaWYgKHJlZnJlc2hlZCkge1xyXG4gICAgc2VyaWFsaXplVG9rZW5zKHJlcywgcmVmcmVzaGVkKTtcclxuICAgIHJldHVybiByZWZyZXNoZWQ7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIGJ1aWxkQXV0aFVybCxcclxuICBlbnN1cmVUb2tlbnMsXHJcbiAgZXhjaGFuZ2VDb2RlRm9yVG9rZW5zLFxyXG4gIHBhcnNlVG9rZW5zLFxyXG4gIHNlcmlhbGl6ZVRva2VucyxcclxufTsiXSwibmFtZXMiOlsiY3J5cHRvIiwicmVxdWlyZSIsIlRPS0VOX0NPT0tJRSIsIlNDT1BFUyIsInJlcXVpcmVkRW52IiwiZm9yRWFjaCIsImtleSIsInByb2Nlc3MiLCJlbnYiLCJjb25zb2xlIiwid2FybiIsImF1dGhvcml0eSIsIkFaVVJFX1RFTkFOVF9JRCIsInJlZGlyZWN0VXJpIiwiQVpVUkVfUkVESVJFQ1RfVVJJIiwiQkFDS0VORF9CQVNFX1VSTCIsImVuY3J5cHRpb25LZXkiLCJjcmVhdGVIYXNoIiwidXBkYXRlIiwiVE9LRU5fRU5DUllQVElPTl9LRVkiLCJBWlVSRV9DTElFTlRfU0VDUkVUIiwiZGlnZXN0Iiwic2VyaWFsaXplQ29va2llIiwibmFtZSIsInZhbHVlIiwib3B0aW9ucyIsInNlZ21lbnRzIiwibWF4QWdlIiwicHVzaCIsImRvbWFpbiIsInBhdGgiLCJzZWN1cmUiLCJodHRwT25seSIsInNhbWVTaXRlIiwiam9pbiIsInBhcnNlQ29va2llSGVhZGVyIiwiaGVhZGVyIiwic3BsaXQiLCJyZWR1Y2UiLCJhY2MiLCJwYXJ0IiwicmVzdCIsInRyaW0iLCJkZWNvZGVVUklDb21wb25lbnQiLCJlbmNyeXB0IiwiZGF0YSIsIml2IiwicmFuZG9tQnl0ZXMiLCJjaXBoZXIiLCJjcmVhdGVDaXBoZXJpdiIsImVuY3J5cHRlZCIsIkJ1ZmZlciIsImNvbmNhdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJmaW5hbCIsImF1dGhUYWciLCJnZXRBdXRoVGFnIiwidG9TdHJpbmciLCJkZWNyeXB0IiwicGF5bG9hZCIsImJ1ZmZlciIsImZyb20iLCJzdWJhcnJheSIsInRhZyIsImRlY2lwaGVyIiwiY3JlYXRlRGVjaXBoZXJpdiIsInNldEF1dGhUYWciLCJkZWNyeXB0ZWQiLCJwYXJzZSIsInNlcmlhbGl6ZVRva2VucyIsInJlcyIsInRva2VucyIsImVuY29kZWQiLCJjb29raWVTdHJpbmciLCJzZXRIZWFkZXIiLCJwYXJzZVRva2VucyIsInJlcSIsImhlYWRlcnMiLCJjb29raWUiLCJjb29raWVzIiwiZXJyb3IiLCJidWlsZEF1dGhVcmwiLCJwYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJjbGllbnRfaWQiLCJBWlVSRV9DTElFTlRfSUQiLCJyZXNwb25zZV90eXBlIiwicmVkaXJlY3RfdXJpIiwicmVzcG9uc2VfbW9kZSIsInNjb3BlIiwicHJvbXB0IiwidG9rZW5SZXF1ZXN0IiwiZm9ybURhdGEiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsImNsaWVudF9zZWNyZXQiLCJvayIsInRleHQiLCJFcnJvciIsInN0YXR1cyIsImpzb24iLCJhY2Nlc3NUb2tlbiIsImFjY2Vzc190b2tlbiIsInJlZnJlc2hUb2tlbiIsInJlZnJlc2hfdG9rZW4iLCJleHBpcmVzQXQiLCJEYXRlIiwibm93IiwiZXhwaXJlc19pbiIsInRvSVNPU3RyaW5nIiwiZXhjaGFuZ2VDb2RlRm9yVG9rZW5zIiwiY29kZSIsImdyYW50X3R5cGUiLCJyZWZyZXNoVG9rZW5zIiwic3RvcmVkIiwibmVlZHNSZWZyZXNoIiwicmVmcmVzaFRocmVzaG9sZCIsImdldFRpbWUiLCJlbnN1cmVUb2tlbnMiLCJyZWZyZXNoZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./api/_lib/auth.js\n");

/***/ }),

/***/ "(api)/./api/_lib/graph.js":
/*!***************************!*\
  !*** ./api/_lib/graph.js ***!
  \***************************/
/***/ ((module) => {

eval("\nconst GRAPH_BASE = \"https://graph.microsoft.com/v1.0\";\nconst mapBusyIntervals = (items)=>items.map((item)=>({\n            start: new Date(item.start.dateTime),\n            end: new Date(item.end.dateTime)\n        }));\nconst overlaps = (start, end, busy)=>{\n    return busy.some((interval)=>start < interval.end && end > interval.start);\n};\nconst buildSlots = (startDate, days, intervalMinutes, busy)=>{\n    const slotsByDate = {};\n    const workingDayStart = 9;\n    const workingDayEnd = 17;\n    for(let i = 0; i < days; i += 1){\n        const date = new Date(startDate);\n        date.setDate(date.getDate() + i);\n        const currentDate = date.toISOString().slice(0, 10);\n        slotsByDate[currentDate] = [];\n        for(let hour = workingDayStart; hour <= workingDayEnd; hour += 1){\n            for(let minute = 0; minute < 60; minute += intervalMinutes){\n                const slotStart = new Date(date);\n                slotStart.setUTCHours(hour, minute, 0, 0);\n                const slotEnd = new Date(slotStart);\n                slotEnd.setMinutes(slotEnd.getMinutes() + intervalMinutes);\n                const time = slotStart.toISOString().slice(11, 16);\n                const available = !overlaps(slotStart, slotEnd, busy);\n                slotsByDate[currentDate].push({\n                    time,\n                    available\n                });\n            }\n        }\n    }\n    return slotsByDate;\n};\nconst getSchedule = async ({ accessToken, calendarId, windowDays = 7 })=>{\n    const startTime = new Date();\n    const endTime = new Date();\n    endTime.setDate(startTime.getDate() + windowDays);\n    const response = await fetch(`${GRAPH_BASE}/me/calendar/getSchedule`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            schedules: [\n                calendarId || \"me\"\n            ],\n            startTime: {\n                dateTime: startTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            endTime: {\n                dateTime: endTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            availabilityViewInterval: 30\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph schedule error: ${response.status} ${error}`);\n    }\n    const data = await response.json();\n    const schedule = data.value?.[0];\n    const timeZone = schedule?.workingHours?.timeZone?.name || \"UTC\";\n    const busy = mapBusyIntervals(schedule?.scheduleItems || []);\n    const slotsByDate = buildSlots(startTime, windowDays, 30, busy);\n    const dates = Object.keys(slotsByDate).map((date)=>({\n            date,\n            slots: slotsByDate[date]\n        }));\n    return {\n        timeZone,\n        dates\n    };\n};\nconst createEvent = async ({ accessToken, subject, body, start, end, attendeeEmail, timeZone = \"UTC\" })=>{\n    const response = await fetch(`${GRAPH_BASE}/me/events`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            subject,\n            body: {\n                contentType: \"Text\",\n                content: body\n            },\n            start: {\n                dateTime: start,\n                timeZone\n            },\n            end: {\n                dateTime: end,\n                timeZone\n            },\n            attendees: attendeeEmail ? [\n                {\n                    emailAddress: {\n                        address: attendeeEmail\n                    },\n                    type: \"required\"\n                }\n            ] : [],\n            isReminderOn: true,\n            reminderMinutesBeforeStart: 15\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph create event error: ${response.status} ${error}`);\n    }\n    return response.json();\n};\nmodule.exports = {\n    createEvent,\n    getSchedule\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSTtRQUNqQyxNQUFNLElBQUlDLE1BQU0sQ0FBQywwQkFBMEIsRUFBRWQsU0FBU2UsTUFBTSxDQUFDLENBQUMsRUFBRUgsTUFBTSxDQUFDO0lBQ3pFO0lBRUEsT0FBT1osU0FBU2lCLElBQUk7QUFDdEI7QUFFQXFCLE9BQU9DLE9BQU8sR0FBRztJQUFFWjtJQUFhakM7QUFBWSIsInNvdXJjZXMiOlsid2VicGFjazovL2plcm9lbmFuZHBhd3MvLi9hcGkvX2xpYi9ncmFwaC5qcz82OGQwIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEdSQVBIX0JBU0UgPSBcImh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wXCI7XHJcblxyXG5jb25zdCBtYXBCdXN5SW50ZXJ2YWxzID0gKGl0ZW1zKSA9PlxyXG4gIGl0ZW1zLm1hcCgoaXRlbSkgPT4gKHtcclxuICAgIHN0YXJ0OiBuZXcgRGF0ZShpdGVtLnN0YXJ0LmRhdGVUaW1lKSxcclxuICAgIGVuZDogbmV3IERhdGUoaXRlbS5lbmQuZGF0ZVRpbWUpLFxyXG4gIH0pKTtcclxuXHJcbmNvbnN0IG92ZXJsYXBzID0gKHN0YXJ0LCBlbmQsIGJ1c3kpID0+IHtcclxuICByZXR1cm4gYnVzeS5zb21lKChpbnRlcnZhbCkgPT4gc3RhcnQgPCBpbnRlcnZhbC5lbmQgJiYgZW5kID4gaW50ZXJ2YWwuc3RhcnQpO1xyXG59O1xyXG5cclxuY29uc3QgYnVpbGRTbG90cyA9IChzdGFydERhdGUsIGRheXMsIGludGVydmFsTWludXRlcywgYnVzeSkgPT4ge1xyXG4gIGNvbnN0IHNsb3RzQnlEYXRlID0ge307XHJcbiAgY29uc3Qgd29ya2luZ0RheVN0YXJ0ID0gOTtcclxuICBjb25zdCB3b3JraW5nRGF5RW5kID0gMTc7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF5czsgaSArPSAxKSB7XHJcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcclxuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGkpO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gZGF0ZS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcclxuICAgIHNsb3RzQnlEYXRlW2N1cnJlbnREYXRlXSA9IFtdO1xyXG5cclxuICAgIGZvciAobGV0IGhvdXIgPSB3b3JraW5nRGF5U3RhcnQ7IGhvdXIgPD0gd29ya2luZ0RheUVuZDsgaG91ciArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IG1pbnV0ZSA9IDA7IG1pbnV0ZSA8IDYwOyBtaW51dGUgKz0gaW50ZXJ2YWxNaW51dGVzKSB7XHJcbiAgICAgICAgY29uc3Qgc2xvdFN0YXJ0ID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgICAgICAgc2xvdFN0YXJ0LnNldFVUQ0hvdXJzKGhvdXIsIG1pbnV0ZSwgMCwgMCk7XHJcbiAgICAgICAgY29uc3Qgc2xvdEVuZCA9IG5ldyBEYXRlKHNsb3RTdGFydCk7XHJcbiAgICAgICAgc2xvdEVuZC5zZXRNaW51dGVzKHNsb3RFbmQuZ2V0TWludXRlcygpICsgaW50ZXJ2YWxNaW51dGVzKTtcclxuICAgICAgICBjb25zdCB0aW1lID0gc2xvdFN0YXJ0LnRvSVNPU3RyaW5nKCkuc2xpY2UoMTEsIDE2KTtcclxuXHJcbiAgICAgICAgY29uc3QgYXZhaWxhYmxlID0gIW92ZXJsYXBzKHNsb3RTdGFydCwgc2xvdEVuZCwgYnVzeSk7XHJcbiAgICAgICAgc2xvdHNCeURhdGVbY3VycmVudERhdGVdLnB1c2goeyB0aW1lLCBhdmFpbGFibGUgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBzbG90c0J5RGF0ZTtcclxufTtcclxuXHJcbmNvbnN0IGdldFNjaGVkdWxlID0gYXN5bmMgKHsgYWNjZXNzVG9rZW4sIGNhbGVuZGFySWQsIHdpbmRvd0RheXMgPSA3IH0pID0+IHtcclxuICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gIGVuZFRpbWUuc2V0RGF0ZShzdGFydFRpbWUuZ2V0RGF0ZSgpICsgd2luZG93RGF5cyk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7R1JBUEhfQkFTRX0vbWUvY2FsZW5kYXIvZ2V0U2NoZWR1bGVgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCxcclxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICBzY2hlZHVsZXM6IFtjYWxlbmRhcklkIHx8IFwibWVcIl0sXHJcbiAgICAgIHN0YXJ0VGltZTogeyBkYXRlVGltZTogc3RhcnRUaW1lLnRvSVNPU3RyaW5nKCksIHRpbWVab25lOiBcIlVUQ1wiIH0sXHJcbiAgICAgIGVuZFRpbWU6IHsgZGF0ZVRpbWU6IGVuZFRpbWUudG9JU09TdHJpbmcoKSwgdGltZVpvbmU6IFwiVVRDXCIgfSxcclxuICAgICAgYXZhaWxhYmlsaXR5Vmlld0ludGVydmFsOiAzMCxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR3JhcGggc2NoZWR1bGUgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke2Vycm9yfWApO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICBjb25zdCBzY2hlZHVsZSA9IGRhdGEudmFsdWU/LlswXTtcclxuICBjb25zdCB0aW1lWm9uZSA9IHNjaGVkdWxlPy53b3JraW5nSG91cnM/LnRpbWVab25lPy5uYW1lIHx8IFwiVVRDXCI7XHJcbiAgY29uc3QgYnVzeSA9IG1hcEJ1c3lJbnRlcnZhbHMoc2NoZWR1bGU/LnNjaGVkdWxlSXRlbXMgfHwgW10pO1xyXG4gIGNvbnN0IHNsb3RzQnlEYXRlID0gYnVpbGRTbG90cyhzdGFydFRpbWUsIHdpbmRvd0RheXMsIDMwLCBidXN5KTtcclxuXHJcbiAgY29uc3QgZGF0ZXMgPSBPYmplY3Qua2V5cyhzbG90c0J5RGF0ZSkubWFwKChkYXRlKSA9PiAoe1xyXG4gICAgZGF0ZSxcclxuICAgIHNsb3RzOiBzbG90c0J5RGF0ZVtkYXRlXSxcclxuICB9KSk7XHJcblxyXG4gIHJldHVybiB7IHRpbWVab25lLCBkYXRlcyB9O1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlRXZlbnQgPSBhc3luYyAoe1xyXG4gIGFjY2Vzc1Rva2VuLFxyXG4gIHN1YmplY3QsXHJcbiAgYm9keSxcclxuICBzdGFydCxcclxuICBlbmQsXHJcbiAgYXR0ZW5kZWVFbWFpbCxcclxuICB0aW1lWm9uZSA9IFwiVVRDXCIsXHJcbn0pID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0dSQVBIX0JBU0V9L21lL2V2ZW50c2AsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIHN1YmplY3QsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBjb250ZW50VHlwZTogXCJUZXh0XCIsXHJcbiAgICAgICAgY29udGVudDogYm9keSxcclxuICAgICAgfSxcclxuICAgICAgc3RhcnQ6IHsgZGF0ZVRpbWU6IHN0YXJ0LCB0aW1lWm9uZSB9LFxyXG4gICAgICBlbmQ6IHsgZGF0ZVRpbWU6IGVuZCwgdGltZVpvbmUgfSxcclxuICAgICAgYXR0ZW5kZWVzOiBhdHRlbmRlZUVtYWlsXHJcbiAgICAgICAgPyBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBlbWFpbEFkZHJlc3M6IHsgYWRkcmVzczogYXR0ZW5kZWVFbWFpbCB9LFxyXG4gICAgICAgICAgICAgIHR5cGU6IFwicmVxdWlyZWRcIixcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgIF1cclxuICAgICAgICA6IFtdLFxyXG4gICAgICBpc1JlbWluZGVyT246IHRydWUsXHJcbiAgICAgIHJlbWluZGVyTWludXRlc0JlZm9yZVN0YXJ0OiAxNSxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR3JhcGggY3JlYXRlIGV2ZW50IGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtlcnJvcn1gKTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgY3JlYXRlRXZlbnQsIGdldFNjaGVkdWxlIH07Il0sIm5hbWVzIjpbIkdSQVBIX0JBU0UiLCJtYXBCdXN5SW50ZXJ2YWxzIiwiaXRlbXMiLCJtYXAiLCJpdGVtIiwic3RhcnQiLCJEYXRlIiwiZGF0ZVRpbWUiLCJlbmQiLCJvdmVybGFwcyIsImJ1c3kiLCJzb21lIiwiaW50ZXJ2YWwiLCJidWlsZFNsb3RzIiwic3RhcnREYXRlIiwiZGF5cyIsImludGVydmFsTWludXRlcyIsInNsb3RzQnlEYXRlIiwid29ya2luZ0RheVN0YXJ0Iiwid29ya2luZ0RheUVuZCIsImkiLCJkYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJjdXJyZW50RGF0ZSIsInRvSVNPU3RyaW5nIiwic2xpY2UiLCJob3VyIiwibWludXRlIiwic2xvdFN0YXJ0Iiwic2V0VVRDSG91cnMiLCJzbG90RW5kIiwic2V0TWludXRlcyIsImdldE1pbnV0ZXMiLCJ0aW1lIiwiYXZhaWxhYmxlIiwicHVzaCIsImdldFNjaGVkdWxlIiwiYWNjZXNzVG9rZW4iLCJjYWxlbmRhcklkIiwid2luZG93RGF5cyIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInNjaGVkdWxlcyIsInRpbWVab25lIiwiYXZhaWxhYmlsaXR5Vmlld0ludGVydmFsIiwib2siLCJlcnJvciIsInRleHQiLCJFcnJvciIsInN0YXR1cyIsImRhdGEiLCJqc29uIiwic2NoZWR1bGUiLCJ2YWx1ZSIsIndvcmtpbmdIb3VycyIsIm5hbWUiLCJzY2hlZHVsZUl0ZW1zIiwiZGF0ZXMiLCJPYmplY3QiLCJrZXlzIiwic2xvdHMiLCJjcmVhdGVFdmVudCIsInN1YmplY3QiLCJhdHRlbmRlZUVtYWlsIiwiY29udGVudFR5cGUiLCJjb250ZW50IiwiYXR0ZW5kZWVzIiwiZW1haWxBZGRyZXNzIiwiYWRkcmVzcyIsInR5cGUiLCJpc1JlbWluZGVyT24iLCJyZW1pbmRlck1pbnV0ZXNCZWZvcmVTdGFydCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./api/_lib/graph.js\n");

/***/ }),

/***/ "(api)/./api/availability.js":
/*!*****************************!*\
  !*** ./api/availability.js ***!
  \*****************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { ensureTokens, parseTokens } = __webpack_require__(/*! ./_lib/auth */ \"(api)/./api/_lib/auth.js\");\nconst { getSchedule } = __webpack_require__(/*! ./_lib/graph */ \"(api)/./api/_lib/graph.js\");\nmodule.exports = async (req, res)=>{\n    if (req.method !== \"GET\") {\n        res.statusCode = 405;\n        res.setHeader(\"Allow\", \"GET\");\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify({\n            message: \"Method Not Allowed\"\n        }));\n        return;\n    }\n    try {\n        const tokens = await ensureTokens(req, res) || parseTokens(req);\n        if (!tokens?.accessToken) {\n            res.statusCode = 401;\n            res.setHeader(\"Content-Type\", \"application/json\");\n            res.end(JSON.stringify({\n                message: \"Unauthorized\",\n                loginUrl: \"/api/auth/microsoft/login\"\n            }));\n            return;\n        }\n        const availability = await getSchedule({\n            accessToken: tokens.accessToken,\n            calendarId: process.env.OUTLOOK_CALENDAR_ID\n        });\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify(availability));\n    } catch (error) {\n        console.error(\"Availability error\", error);\n        res.statusCode = 500;\n        res.setHeader(\"Content-Type\", \"application/json\"); // â† critical fix\n        res.end(JSON.stringify({\n            message: \"Failed to fetch availability\"\n        }));\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9hcGkvYXZhaWxhYmlsaXR5LmpzIiwibWFwcGluZ3MiOiI7QUFBQSxNQUFNLEVBQUVBLFlBQVksRUFBRUMsV0FBVyxFQUFFLEdBQUdDLG1CQUFPQSxDQUFDLDZDQUFhO0FBQzNELE1BQU0sRUFBRUMsV0FBVyxFQUFFLEdBQUdELG1CQUFPQSxDQUFDLCtDQUFjO0FBRTlDRSxPQUFPQyxPQUFPLEdBQUcsT0FBT0MsS0FBS0M7SUFDM0IsSUFBSUQsSUFBSUUsTUFBTSxLQUFLLE9BQU87UUFDeEJELElBQUlFLFVBQVUsR0FBRztRQUNqQkYsSUFBSUcsU0FBUyxDQUFDLFNBQVM7UUFDdkJILElBQUlHLFNBQVMsQ0FBQyxnQkFBZ0I7UUFDOUJILElBQUlJLEdBQUcsQ0FBQ0MsS0FBS0MsU0FBUyxDQUFDO1lBQUVDLFNBQVM7UUFBcUI7UUFDdkQ7SUFDRjtJQUVBLElBQUk7UUFDRixNQUFNQyxTQUFTLE1BQU9mLGFBQWFNLEtBQUtDLFFBQVNOLFlBQVlLO1FBQzdELElBQUksQ0FBQ1MsUUFBUUMsYUFBYTtZQUN4QlQsSUFBSUUsVUFBVSxHQUFHO1lBQ2pCRixJQUFJRyxTQUFTLENBQUMsZ0JBQWdCO1lBQzlCSCxJQUFJSSxHQUFHLENBQ0xDLEtBQUtDLFNBQVMsQ0FBQztnQkFDYkMsU0FBUztnQkFDVEcsVUFBVTtZQUNaO1lBRUY7UUFDRjtRQUVBLE1BQU1DLGVBQWUsTUFBTWYsWUFBWTtZQUNyQ2EsYUFBYUQsT0FBT0MsV0FBVztZQUMvQkcsWUFBWUMsUUFBUUMsR0FBRyxDQUFDQyxtQkFBbUI7UUFDN0M7UUFFQWYsSUFBSUcsU0FBUyxDQUFDLGdCQUFnQjtRQUM5QkgsSUFBSUksR0FBRyxDQUFDQyxLQUFLQyxTQUFTLENBQUNLO0lBQ3pCLEVBQUUsT0FBT0ssT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsc0JBQXNCQTtRQUNwQ2hCLElBQUlFLFVBQVUsR0FBRztRQUNqQkYsSUFBSUcsU0FBUyxDQUFDLGdCQUFnQixxQkFBcUIsaUJBQWlCO1FBQ3BFSCxJQUFJSSxHQUFHLENBQUNDLEtBQUtDLFNBQVMsQ0FBQztZQUFFQyxTQUFTO1FBQStCO0lBQ25FO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vYXBpL2F2YWlsYWJpbGl0eS5qcz85YjNlIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgZW5zdXJlVG9rZW5zLCBwYXJzZVRva2VucyB9ID0gcmVxdWlyZShcIi4vX2xpYi9hdXRoXCIpO1xyXG5jb25zdCB7IGdldFNjaGVkdWxlIH0gPSByZXF1aXJlKFwiLi9fbGliL2dyYXBoXCIpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICBpZiAocmVxLm1ldGhvZCAhPT0gXCJHRVRcIikge1xyXG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDU7XHJcbiAgICByZXMuc2V0SGVhZGVyKFwiQWxsb3dcIiwgXCJHRVRcIik7XHJcbiAgICByZXMuc2V0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcclxuICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIk1ldGhvZCBOb3QgQWxsb3dlZFwiIH0pKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB0b2tlbnMgPSAoYXdhaXQgZW5zdXJlVG9rZW5zKHJlcSwgcmVzKSkgfHwgcGFyc2VUb2tlbnMocmVxKTtcclxuICAgIGlmICghdG9rZW5zPy5hY2Nlc3NUb2tlbikge1xyXG4gICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMTtcclxuICAgICAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICAgIHJlcy5lbmQoXHJcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgbWVzc2FnZTogXCJVbmF1dGhvcml6ZWRcIixcclxuICAgICAgICAgIGxvZ2luVXJsOiBcIi9hcGkvYXV0aC9taWNyb3NvZnQvbG9naW5cIixcclxuICAgICAgICB9KVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYXZhaWxhYmlsaXR5ID0gYXdhaXQgZ2V0U2NoZWR1bGUoe1xyXG4gICAgICBhY2Nlc3NUb2tlbjogdG9rZW5zLmFjY2Vzc1Rva2VuLFxyXG4gICAgICBjYWxlbmRhcklkOiBwcm9jZXNzLmVudi5PVVRMT09LX0NBTEVOREFSX0lELFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KGF2YWlsYWJpbGl0eSkpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiQXZhaWxhYmlsaXR5IGVycm9yXCIsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXNDb2RlID0gNTAwO1xyXG4gICAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7IC8vIOKGkCBjcml0aWNhbCBmaXhcclxuICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkZhaWxlZCB0byBmZXRjaCBhdmFpbGFiaWxpdHlcIiB9KSk7XHJcbiAgfVxyXG59O1xyXG4iXSwibmFtZXMiOlsiZW5zdXJlVG9rZW5zIiwicGFyc2VUb2tlbnMiLCJyZXF1aXJlIiwiZ2V0U2NoZWR1bGUiLCJtb2R1bGUiLCJleHBvcnRzIiwicmVxIiwicmVzIiwibWV0aG9kIiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsImVuZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZXNzYWdlIiwidG9rZW5zIiwiYWNjZXNzVG9rZW4iLCJsb2dpblVybCIsImF2YWlsYWJpbGl0eSIsImNhbGVuZGFySWQiLCJwcm9jZXNzIiwiZW52IiwiT1VUTE9PS19DQUxFTkRBUl9JRCIsImVycm9yIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./api/availability.js\n");

/***/ }),

/***/ "(api)/./pages/api/availability.js":
/*!***********************************!*\
  !*** ./pages/api/availability.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst availabilityHandler = __webpack_require__(/*! ../../api/availability */ \"(api)/./api/availability.js\");\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (availabilityHandler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYXZhaWxhYmlsaXR5LmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxzQkFBc0JDLG1CQUFPQSxDQUFDO0FBRXBDLGlFQUFlRCxtQkFBbUJBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vcGFnZXMvYXBpL2F2YWlsYWJpbGl0eS5qcz80MTMzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGF2YWlsYWJpbGl0eUhhbmRsZXIgPSByZXF1aXJlKCcuLi8uLi9hcGkvYXZhaWxhYmlsaXR5Jyk7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhdmFpbGFiaWxpdHlIYW5kbGVyO1xyXG4iXSwibmFtZXMiOlsiYXZhaWxhYmlsaXR5SGFuZGxlciIsInJlcXVpcmUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/availability.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Favailability&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cavailability.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();