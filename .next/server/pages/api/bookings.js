"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/bookings";
exports.ids = ["pages/api/bookings"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "luxon":
/*!************************!*\
  !*** external "luxon" ***!
  \************************/
/***/ ((module) => {

module.exports = require("luxon");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbookings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbookings.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbookings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbookings.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_bookings_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\bookings.js */ \"(api)/./pages/api/bookings.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_bookings_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_bookings_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/bookings\",\n        pathname: \"/api/bookings\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_bookings_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJvb2tpbmdzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNib29raW5ncy5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNzRDtBQUN0RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsbURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLG1EQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCIsInNvdXJjZXMiOlsid2VicGFjazovL2plcm9lbmFuZHBhd3MvPzg3OTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxib29raW5ncy5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Jvb2tpbmdzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYm9va2luZ3NcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbookings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbookings.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./api/_lib/supabase.js":
/*!******************************!*\
  !*** ./api/_lib/supabase.js ***!
  \******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { createClient } = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst { DateTime } = __webpack_require__(/*! luxon */ \"luxon\");\nconst supabaseUrl = \"https://jjsxfzhgyfuigogxzire.supabase.co\";\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nlet supabaseAdmin = null;\nif (!supabaseUrl || !supabaseServiceRoleKey) {\n    console.warn(\"Supabase admin client is missing configuration. Check NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY\");\n} else {\n    supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\nconst createConfigError = ()=>{\n    const error = new Error(\"Supabase admin client is not configured. Please set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY.\");\n    error.statusCode = 503;\n    error.publicMessage = \"Bookings are temporarily unavailable. Please try again later.\";\n    return error;\n};\nconst requireSupabase = ()=>{\n    if (!supabaseAdmin) {\n        throw createConfigError();\n    }\n};\nconst hashPassword = (value)=>crypto.createHash(\"sha256\").update(value || \"\").digest(\"hex\");\nconst ensureClientProfile = async ({ email, fullName, phone })=>{\n    requireSupabase();\n    const normalizedEmail = (email || \"\").trim().toLowerCase();\n    if (!normalizedEmail) {\n        throw new Error(\"Client email is required to create a profile\");\n    }\n    const existingClient = await supabaseAdmin.from(\"clients\").select(\"*\").eq(\"email\", normalizedEmail).maybeSingle();\n    if (existingClient.error) {\n        throw existingClient.error;\n    }\n    if (existingClient.data) {\n        return {\n            client: existingClient.data,\n            created: false\n        };\n    }\n    const temporaryPassword = crypto.randomBytes(9).toString(\"base64\");\n    const passwordSetupToken = crypto.randomUUID();\n    const insertResult = await supabaseAdmin.from(\"clients\").insert({\n        email: normalizedEmail,\n        full_name: fullName || null,\n        phone_number: phone || null,\n        hashed_password: hashPassword(temporaryPassword),\n        password_setup_token: passwordSetupToken\n    }).select(\"*\").single();\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return {\n        client: insertResult.data,\n        created: true,\n        temporaryPassword\n    };\n};\nconst ensurePetProfiles = async (clientId, pets = [])=>{\n    requireSupabase();\n    if (!clientId) return [];\n    const ensuredPets = [];\n    for (const pet of pets){\n        if (pet?.id) {\n            const existing = await supabaseAdmin.from(\"pets\").select(\"*\").eq(\"id\", pet.id).eq(\"owner_id\", clientId).maybeSingle();\n            if (existing.error) {\n                throw existing.error;\n            }\n            if (existing.data) {\n                ensuredPets.push(existing.data);\n                continue;\n            }\n        }\n        const insertResult = await supabaseAdmin.from(\"pets\").insert({\n            owner_id: clientId,\n            name: pet?.name || \"New pet\",\n            breed: pet?.breed || null,\n            notes: pet?.notes || null,\n            photo_data_url: pet?.photoDataUrl || null\n        }).select(\"*\").single();\n        if (insertResult.error) {\n            throw insertResult.error;\n        }\n        ensuredPets.push(insertResult.data);\n    }\n    return ensuredPets;\n};\nconst looksLikeUuid = (value)=>typeof value === \"string\" && /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(value);\nconst getServiceByIdentifier = async (serviceIdOrSlug)=>{\n    requireSupabase();\n    if (!serviceIdOrSlug) return null;\n    const isUuid = looksLikeUuid(serviceIdOrSlug);\n    const query = supabaseAdmin.from(\"services_catalog\").select(\"*\");\n    const result = isUuid ? await query.eq(\"id\", serviceIdOrSlug).maybeSingle() : await query.eq(\"slug\", serviceIdOrSlug).maybeSingle();\n    if (result.error) {\n        if (result.error.code === \"PGRST116\") {\n            return null;\n        }\n        throw result.error;\n    }\n    return result.data;\n};\nconst createBookingRecord = async ({ clientId, serviceId, serviceTitle, start, end, timeZone, notes })=>{\n    requireSupabase();\n    const insertResult = await supabaseAdmin.from(\"bookings\").insert({\n        client_id: clientId,\n        service_id: serviceId || null,\n        service_title: serviceTitle || null,\n        start_at: start.toUTC().toISO(),\n        end_at: end.toUTC().toISO(),\n        time_zone: timeZone || \"UTC\",\n        notes: notes || null\n    }).select(\"*\").single();\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return insertResult.data;\n};\nconst linkBookingPets = async (bookingId, pets)=>{\n    requireSupabase();\n    if (!bookingId || pets.length === 0) return [];\n    const records = pets.map((pet)=>({\n            booking_id: bookingId,\n            pet_id: pet.id\n        }));\n    const insertResult = await supabaseAdmin.from(\"booking_pets\").insert(records).select(\"*\");\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return insertResult.data;\n};\nconst createBookingWithProfiles = async ({ date, time, durationMinutes = 60, serviceId, serviceTitle, timeZone = \"UTC\", clientName, clientEmail, notes, pets = [], dogCount })=>{\n    requireSupabase();\n    const service = await getServiceByIdentifier(serviceId);\n    const duration = Number.isFinite(durationMinutes) ? durationMinutes : service?.duration_minutes || 60;\n    const start = DateTime.fromISO(`${date}T${time}`, {\n        zone: timeZone || \"UTC\"\n    });\n    const safeStart = start.isValid ? start : DateTime.fromISO(`${date}T${time}`, {\n        zone: \"UTC\"\n    });\n    const end = safeStart.plus({\n        minutes: duration\n    });\n    const { client, created, temporaryPassword } = await ensureClientProfile({\n        email: clientEmail,\n        fullName: clientName\n    });\n    const ensuredPets = await ensurePetProfiles(client.id, pets);\n    const booking = await createBookingRecord({\n        clientId: client.id,\n        serviceId: service?.id || null,\n        serviceTitle: service?.title || serviceTitle,\n        start: safeStart,\n        end,\n        timeZone,\n        notes\n    });\n    await linkBookingPets(booking.id, ensuredPets);\n    return {\n        booking,\n        client,\n        pets: ensuredPets,\n        service,\n        passwordDelivery: created ? {\n            temporaryPassword,\n            passwordSetupToken: client.password_setup_token\n        } : null,\n        totals: {\n            requestedDogCount: dogCount,\n            storedPetCount: ensuredPets.length\n        }\n    };\n};\nmodule.exports = {\n    createBookingWithProfiles,\n    ensureClientProfile,\n    ensurePetProfiles,\n    getServiceByIdentifier,\n    supabaseAdmin\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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b0JMLE9BQU9ZLG9CQUFvQjtRQUNqRCxJQUNBO1FBQ0prRSxRQUFRO1lBQ05DLG1CQUFtQmhCO1lBQ25CaUIsZ0JBQWdCL0QsWUFBWW1DLE1BQU07UUFDcEM7SUFDRjtBQUNGO0FBRUE2QixPQUFPQyxPQUFPLEdBQUc7SUFDZnpCO0lBQ0F0RTtJQUNBMkI7SUFDQWdCO0lBQ0E1RDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL2FwaS9fbGliL3N1cGFiYXNlLmpzP2UxMGQiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IHJlcXVpcmUoJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycpO1xyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuY29uc3QgeyBEYXRlVGltZSB9ID0gcmVxdWlyZSgnbHV4b24nKTtcclxuXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VSb2xlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbmxldCBzdXBhYmFzZUFkbWluID0gbnVsbDtcclxuXHJcbmlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZVJvbGVLZXkpIHtcclxuICBjb25zb2xlLndhcm4oXHJcbiAgICAnU3VwYWJhc2UgYWRtaW4gY2xpZW50IGlzIG1pc3NpbmcgY29uZmlndXJhdGlvbi4gQ2hlY2sgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGFuZCBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZJ1xyXG4gICk7XHJcbn0gZWxzZSB7XHJcbiAgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlUm9sZUtleSwge1xyXG4gICAgYXV0aDoge1xyXG4gICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcclxuICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gICAgfSxcclxuICB9KTtcclxufVxyXG5cclxuY29uc3QgY3JlYXRlQ29uZmlnRXJyb3IgPSAoKSA9PiB7XHJcbiAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXHJcbiAgICAnU3VwYWJhc2UgYWRtaW4gY2xpZW50IGlzIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBhbmQgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWS4nXHJcbiAgKTtcclxuICBlcnJvci5zdGF0dXNDb2RlID0gNTAzO1xyXG4gIGVycm9yLnB1YmxpY01lc3NhZ2UgPSAnQm9va2luZ3MgYXJlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XHJcbiAgcmV0dXJuIGVycm9yO1xyXG59O1xyXG5cclxuY29uc3QgcmVxdWlyZVN1cGFiYXNlID0gKCkgPT4ge1xyXG4gIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgdGhyb3cgY3JlYXRlQ29uZmlnRXJyb3IoKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoYXNoUGFzc3dvcmQgPSAodmFsdWUpID0+XHJcbiAgY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZSh2YWx1ZSB8fCAnJykuZGlnZXN0KCdoZXgnKTtcclxuXHJcbmNvbnN0IGVuc3VyZUNsaWVudFByb2ZpbGUgPSBhc3luYyAoeyBlbWFpbCwgZnVsbE5hbWUsIHBob25lIH0pID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgY29uc3Qgbm9ybWFsaXplZEVtYWlsID0gKGVtYWlsIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgaWYgKCFub3JtYWxpemVkRW1haWwpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignQ2xpZW50IGVtYWlsIGlzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIHByb2ZpbGUnKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGV4aXN0aW5nQ2xpZW50ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgLmZyb20oJ2NsaWVudHMnKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoJ2VtYWlsJywgbm9ybWFsaXplZEVtYWlsKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChleGlzdGluZ0NsaWVudC5lcnJvcikge1xyXG4gICAgdGhyb3cgZXhpc3RpbmdDbGllbnQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICBpZiAoZXhpc3RpbmdDbGllbnQuZGF0YSkge1xyXG4gICAgcmV0dXJuIHsgY2xpZW50OiBleGlzdGluZ0NsaWVudC5kYXRhLCBjcmVhdGVkOiBmYWxzZSB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdGVtcG9yYXJ5UGFzc3dvcmQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoOSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG4gIGNvbnN0IHBhc3N3b3JkU2V0dXBUb2tlbiA9IGNyeXB0by5yYW5kb21VVUlEKCk7XHJcblxyXG4gIGNvbnN0IGluc2VydFJlc3VsdCA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdjbGllbnRzJylcclxuICAgIC5pbnNlcnQoe1xyXG4gICAgICBlbWFpbDogbm9ybWFsaXplZEVtYWlsLFxyXG4gICAgICBmdWxsX25hbWU6IGZ1bGxOYW1lIHx8IG51bGwsXHJcbiAgICAgIHBob25lX251bWJlcjogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgaGFzaGVkX3Bhc3N3b3JkOiBoYXNoUGFzc3dvcmQodGVtcG9yYXJ5UGFzc3dvcmQpLFxyXG4gICAgICBwYXNzd29yZF9zZXR1cF90b2tlbjogcGFzc3dvcmRTZXR1cFRva2VuLFxyXG4gICAgfSlcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoaW5zZXJ0UmVzdWx0LmVycm9yKSB7XHJcbiAgICB0aHJvdyBpbnNlcnRSZXN1bHQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY2xpZW50OiBpbnNlcnRSZXN1bHQuZGF0YSxcclxuICAgIGNyZWF0ZWQ6IHRydWUsXHJcbiAgICB0ZW1wb3JhcnlQYXNzd29yZCxcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgZW5zdXJlUGV0UHJvZmlsZXMgPSBhc3luYyAoY2xpZW50SWQsIHBldHMgPSBbXSkgPT4ge1xyXG4gIHJlcXVpcmVTdXBhYmFzZSgpO1xyXG5cclxuICBpZiAoIWNsaWVudElkKSByZXR1cm4gW107XHJcblxyXG4gIGNvbnN0IGVuc3VyZWRQZXRzID0gW107XHJcblxyXG4gIGZvciAoY29uc3QgcGV0IG9mIHBldHMpIHtcclxuICAgIGlmIChwZXQ/LmlkKSB7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdwZXRzJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ2lkJywgcGV0LmlkKVxyXG4gICAgICAgIC5lcSgnb3duZXJfaWQnLCBjbGllbnRJZClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChleGlzdGluZy5lcnJvcikge1xyXG4gICAgICAgIHRocm93IGV4aXN0aW5nLmVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZXhpc3RpbmcuZGF0YSkge1xyXG4gICAgICAgIGVuc3VyZWRQZXRzLnB1c2goZXhpc3RpbmcuZGF0YSk7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgaW5zZXJ0UmVzdWx0ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAuZnJvbSgncGV0cycpXHJcbiAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgIG93bmVyX2lkOiBjbGllbnRJZCxcclxuICAgICAgICBuYW1lOiBwZXQ/Lm5hbWUgfHwgJ05ldyBwZXQnLFxyXG4gICAgICAgIGJyZWVkOiBwZXQ/LmJyZWVkIHx8IG51bGwsXHJcbiAgICAgICAgbm90ZXM6IHBldD8ubm90ZXMgfHwgbnVsbCxcclxuICAgICAgICBwaG90b19kYXRhX3VybDogcGV0Py5waG90b0RhdGFVcmwgfHwgbnVsbCxcclxuICAgICAgfSlcclxuICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoaW5zZXJ0UmVzdWx0LmVycm9yKSB7XHJcbiAgICAgIHRocm93IGluc2VydFJlc3VsdC5lcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICBlbnN1cmVkUGV0cy5wdXNoKGluc2VydFJlc3VsdC5kYXRhKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBlbnN1cmVkUGV0cztcclxufTtcclxuXHJcbmNvbnN0IGxvb2tzTGlrZVV1aWQgPSAodmFsdWUpID0+XHJcbiAgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJlxyXG4gIC9eWzAtOWEtZl17OH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17NH0tWzAtOWEtZl17MTJ9JC9pLnRlc3QodmFsdWUpO1xyXG5cclxuY29uc3QgZ2V0U2VydmljZUJ5SWRlbnRpZmllciA9IGFzeW5jIChzZXJ2aWNlSWRPclNsdWcpID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgaWYgKCFzZXJ2aWNlSWRPclNsdWcpIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCBpc1V1aWQgPSBsb29rc0xpa2VVdWlkKHNlcnZpY2VJZE9yU2x1Zyk7XHJcblxyXG4gIGNvbnN0IHF1ZXJ5ID0gc3VwYWJhc2VBZG1pbi5mcm9tKCdzZXJ2aWNlc19jYXRhbG9nJykuc2VsZWN0KCcqJyk7XHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9IGlzVXVpZFxyXG4gICAgPyBhd2FpdCBxdWVyeS5lcSgnaWQnLCBzZXJ2aWNlSWRPclNsdWcpLm1heWJlU2luZ2xlKClcclxuICAgIDogYXdhaXQgcXVlcnkuZXEoJ3NsdWcnLCBzZXJ2aWNlSWRPclNsdWcpLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChyZXN1bHQuZXJyb3IpIHtcclxuICAgIGlmIChyZXN1bHQuZXJyb3IuY29kZSA9PT0gJ1BHUlNUMTE2Jykge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIHRocm93IHJlc3VsdC5lcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXN1bHQuZGF0YTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUJvb2tpbmdSZWNvcmQgPSBhc3luYyAoe1xyXG4gIGNsaWVudElkLFxyXG4gIHNlcnZpY2VJZCxcclxuICBzZXJ2aWNlVGl0bGUsXHJcbiAgc3RhcnQsXHJcbiAgZW5kLFxyXG4gIHRpbWVab25lLFxyXG4gIG5vdGVzLFxyXG59KSA9PiB7XHJcbiAgcmVxdWlyZVN1cGFiYXNlKCk7XHJcblxyXG4gIGNvbnN0IGluc2VydFJlc3VsdCA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAuaW5zZXJ0KHtcclxuICAgICAgY2xpZW50X2lkOiBjbGllbnRJZCxcclxuICAgICAgc2VydmljZV9pZDogc2VydmljZUlkIHx8IG51bGwsXHJcbiAgICAgIHNlcnZpY2VfdGl0bGU6IHNlcnZpY2VUaXRsZSB8fCBudWxsLFxyXG4gICAgICBzdGFydF9hdDogc3RhcnQudG9VVEMoKS50b0lTTygpLFxyXG4gICAgICBlbmRfYXQ6IGVuZC50b1VUQygpLnRvSVNPKCksXHJcbiAgICAgIHRpbWVfem9uZTogdGltZVpvbmUgfHwgJ1VUQycsXHJcbiAgICAgIG5vdGVzOiBub3RlcyB8fCBudWxsLFxyXG4gICAgfSlcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoaW5zZXJ0UmVzdWx0LmVycm9yKSB7XHJcbiAgICB0aHJvdyBpbnNlcnRSZXN1bHQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaW5zZXJ0UmVzdWx0LmRhdGE7XHJcbn07XHJcblxyXG5jb25zdCBsaW5rQm9va2luZ1BldHMgPSBhc3luYyAoYm9va2luZ0lkLCBwZXRzKSA9PiB7XHJcbiAgcmVxdWlyZVN1cGFiYXNlKCk7XHJcblxyXG4gIGlmICghYm9va2luZ0lkIHx8IHBldHMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XHJcblxyXG4gIGNvbnN0IHJlY29yZHMgPSBwZXRzLm1hcCgocGV0KSA9PiAoe1xyXG4gICAgYm9va2luZ19pZDogYm9va2luZ0lkLFxyXG4gICAgcGV0X2lkOiBwZXQuaWQsXHJcbiAgfSkpO1xyXG5cclxuICBjb25zdCBpbnNlcnRSZXN1bHQgPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAuZnJvbSgnYm9va2luZ19wZXRzJylcclxuICAgIC5pbnNlcnQocmVjb3JkcylcclxuICAgIC5zZWxlY3QoJyonKTtcclxuXHJcbiAgaWYgKGluc2VydFJlc3VsdC5lcnJvcikge1xyXG4gICAgdGhyb3cgaW5zZXJ0UmVzdWx0LmVycm9yO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGluc2VydFJlc3VsdC5kYXRhO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlQm9va2luZ1dpdGhQcm9maWxlcyA9IGFzeW5jICh7XHJcbiAgZGF0ZSxcclxuICB0aW1lLFxyXG4gIGR1cmF0aW9uTWludXRlcyA9IDYwLFxyXG4gIHNlcnZpY2VJZCxcclxuICBzZXJ2aWNlVGl0bGUsXHJcbiAgdGltZVpvbmUgPSAnVVRDJyxcclxuICBjbGllbnROYW1lLFxyXG4gIGNsaWVudEVtYWlsLFxyXG4gIG5vdGVzLFxyXG4gIHBldHMgPSBbXSxcclxuICBkb2dDb3VudCxcclxufSkgPT4ge1xyXG4gIHJlcXVpcmVTdXBhYmFzZSgpO1xyXG5cclxuICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgZ2V0U2VydmljZUJ5SWRlbnRpZmllcihzZXJ2aWNlSWQpO1xyXG4gIGNvbnN0IGR1cmF0aW9uID0gTnVtYmVyLmlzRmluaXRlKGR1cmF0aW9uTWludXRlcylcclxuICAgID8gZHVyYXRpb25NaW51dGVzXHJcbiAgICA6IHNlcnZpY2U/LmR1cmF0aW9uX21pbnV0ZXMgfHwgNjA7XHJcblxyXG4gIGNvbnN0IHN0YXJ0ID0gRGF0ZVRpbWUuZnJvbUlTTyhgJHtkYXRlfVQke3RpbWV9YCwgeyB6b25lOiB0aW1lWm9uZSB8fCAnVVRDJyB9KTtcclxuICBjb25zdCBzYWZlU3RhcnQgPSBzdGFydC5pc1ZhbGlkID8gc3RhcnQgOiBEYXRlVGltZS5mcm9tSVNPKGAke2RhdGV9VCR7dGltZX1gLCB7IHpvbmU6ICdVVEMnIH0pO1xyXG4gIGNvbnN0IGVuZCA9IHNhZmVTdGFydC5wbHVzKHsgbWludXRlczogZHVyYXRpb24gfSk7XHJcblxyXG4gIGNvbnN0IHsgY2xpZW50LCBjcmVhdGVkLCB0ZW1wb3JhcnlQYXNzd29yZCB9ID0gYXdhaXQgZW5zdXJlQ2xpZW50UHJvZmlsZSh7XHJcbiAgICBlbWFpbDogY2xpZW50RW1haWwsXHJcbiAgICBmdWxsTmFtZTogY2xpZW50TmFtZSxcclxuICB9KTtcclxuXHJcbiAgY29uc3QgZW5zdXJlZFBldHMgPSBhd2FpdCBlbnN1cmVQZXRQcm9maWxlcyhjbGllbnQuaWQsIHBldHMpO1xyXG5cclxuICBjb25zdCBib29raW5nID0gYXdhaXQgY3JlYXRlQm9va2luZ1JlY29yZCh7XHJcbiAgICBjbGllbnRJZDogY2xpZW50LmlkLFxyXG4gICAgc2VydmljZUlkOiBzZXJ2aWNlPy5pZCB8fCBudWxsLFxyXG4gICAgc2VydmljZVRpdGxlOiBzZXJ2aWNlPy50aXRsZSB8fCBzZXJ2aWNlVGl0bGUsXHJcbiAgICBzdGFydDogc2FmZVN0YXJ0LFxyXG4gICAgZW5kLFxyXG4gICAgdGltZVpvbmUsXHJcbiAgICBub3RlcyxcclxuICB9KTtcclxuXHJcbiAgYXdhaXQgbGlua0Jvb2tpbmdQZXRzKGJvb2tpbmcuaWQsIGVuc3VyZWRQZXRzKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGJvb2tpbmcsXHJcbiAgICBjbGllbnQsXHJcbiAgICBwZXRzOiBlbnN1cmVkUGV0cyxcclxuICAgIHNlcnZpY2UsXHJcbiAgICBwYXNzd29yZERlbGl2ZXJ5OiBjcmVhdGVkXHJcbiAgICAgID8ge1xyXG4gICAgICAgICAgdGVtcG9yYXJ5UGFzc3dvcmQsXHJcbiAgICAgICAgICBwYXNzd29yZFNldHVwVG9rZW46IGNsaWVudC5wYXNzd29yZF9zZXR1cF90b2tlbixcclxuICAgICAgICB9XHJcbiAgICAgIDogbnVsbCxcclxuICAgIHRvdGFsczoge1xyXG4gICAgICByZXF1ZXN0ZWREb2dDb3VudDogZG9nQ291bnQsXHJcbiAgICAgIHN0b3JlZFBldENvdW50OiBlbnN1cmVkUGV0cy5sZW5ndGgsXHJcbiAgICB9LFxyXG4gIH07XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICBjcmVhdGVCb29raW5nV2l0aFByb2ZpbGVzLFxyXG4gIGVuc3VyZUNsaWVudFByb2ZpbGUsXHJcbiAgZW5zdXJlUGV0UHJvZmlsZXMsXHJcbiAgZ2V0U2VydmljZUJ5SWRlbnRpZmllcixcclxuICBzdXBhYmFzZUFkbWluLFxyXG59OyJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJyZXF1aXJlIiwiY3J5cHRvIiwiRGF0ZVRpbWUiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VSb2xlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN1cGFiYXNlQWRtaW4iLCJjb25zb2xlIiwid2FybiIsImF1dGgiLCJhdXRvUmVmcmVzaFRva2VuIiwicGVyc2lzdFNlc3Npb24iLCJjcmVhdGVDb25maWdFcnJvciIsImVycm9yIiwiRXJyb3IiLCJzdGF0dXNDb2RlIiwicHVibGljTWVzc2FnZSIsInJlcXVpcmVTdXBhYmFzZSIsImhhc2hQYXNzd29yZCIsInZhbHVlIiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsImVuc3VyZUNsaWVudFByb2ZpbGUiLCJlbWFpbCIsImZ1bGxOYW1lIiwicGhvbmUiLCJub3JtYWxpemVkRW1haWwiLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJleGlzdGluZ0NsaWVudCIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm1heWJlU2luZ2xlIiwiZGF0YSIsImNsaWVudCIsImNyZWF0ZWQiLCJ0ZW1wb3JhcnlQYXNzd29yZCIsInJhbmRvbUJ5dGVzIiwidG9TdHJpbmciLCJwYXNzd29yZFNldHVwVG9rZW4iLCJyYW5kb21VVUlEIiwiaW5zZXJ0UmVzdWx0IiwiaW5zZXJ0IiwiZnVsbF9uYW1lIiwicGhvbmVfbnVtYmVyIiwiaGFzaGVkX3Bhc3N3b3JkIiwicGFzc3dvcmRfc2V0dXBfdG9rZW4iLCJzaW5nbGUiLCJlbnN1cmVQZXRQcm9maWxlcyIsImNsaWVudElkIiwicGV0cyIsImVuc3VyZWRQZXRzIiwicGV0IiwiaWQiLCJleGlzdGluZyIsInB1c2giLCJvd25lcl9pZCIsIm5hbWUiLCJicmVlZCIsIm5vdGVzIiwicGhvdG9fZGF0YV91cmwiLCJwaG90b0RhdGFVcmwiLCJsb29rc0xpa2VVdWlkIiwidGVzdCIsImdldFNlcnZpY2VCeUlkZW50aWZpZXIiLCJzZXJ2aWNlSWRPclNsdWciLCJpc1V1aWQiLCJxdWVyeSIsInJlc3VsdCIsImNvZGUiLCJjcmVhdGVCb29raW5nUmVjb3JkIiwic2VydmljZUlkIiwic2VydmljZVRpdGxlIiwic3RhcnQiLCJlbmQiLCJ0aW1lWm9uZSIsImNsaWVudF9pZCIsInNlcnZpY2VfaWQiLCJzZXJ2aWNlX3RpdGxlIiwic3RhcnRfYXQiLCJ0b1VUQyIsInRvSVNPIiwiZW5kX2F0IiwidGltZV96b25lIiwibGlua0Jvb2tpbmdQZXRzIiwiYm9va2luZ0lkIiwibGVuZ3RoIiwicmVjb3JkcyIsIm1hcCIsImJvb2tpbmdfaWQiLCJwZXRfaWQiLCJjcmVhdGVCb29raW5nV2l0aFByb2ZpbGVzIiwiZGF0ZSIsInRpbWUiLCJkdXJhdGlvbk1pbnV0ZXMiLCJjbGllbnROYW1lIiwiY2xpZW50RW1haWwiLCJkb2dDb3VudCIsInNlcnZpY2UiLCJkdXJhdGlvbiIsIk51bWJlciIsImlzRmluaXRlIiwiZHVyYXRpb25fbWludXRlcyIsImZyb21JU08iLCJ6b25lIiwic2FmZVN0YXJ0IiwiaXNWYWxpZCIsInBsdXMiLCJtaW51dGVzIiwiYm9va2luZyIsInRpdGxlIiwicGFzc3dvcmREZWxpdmVyeSIsInRvdGFscyIsInJlcXVlc3RlZERvZ0NvdW50Iiwic3RvcmVkUGV0Q291bnQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./api/_lib/supabase.js\n");

/***/ }),

/***/ "(api)/./api/booking.js":
/*!************************!*\
  !*** ./api/booking.js ***!
  \************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { supabaseAdmin } = __webpack_require__(/*! ./_lib/supabase */ \"(api)/./api/_lib/supabase.js\");\nconst isAdmin = (req)=>{\n    const adminEmail = process.env.ADMIN_EMAIL || \"jeroen@jeroenandpaws.com\";\n    const headerEmail = (req.headers[\"x-admin-email\"] || \"\").toLowerCase();\n    return headerEmail && headerEmail === adminEmail.toLowerCase();\n};\nmodule.exports = async (req, res)=>{\n    if (req.method !== \"GET\") {\n        res.statusCode = 405;\n        res.setHeader(\"Allow\", \"GET\");\n        res.end(\"Method Not Allowed\");\n        return;\n    }\n    if (!isAdmin(req)) {\n        res.statusCode = 401;\n        res.end(JSON.stringify({\n            message: \"Admin email required\"\n        }));\n        return;\n    }\n    const emailFilter = (req.query.email || \"\").toLowerCase();\n    let query = supabaseAdmin.from(\"bookings\").select(\"*, clients(full_name,email), services_catalog(*), booking_pets(pet_id)\").order(\"start_at\", {\n        ascending: false\n    }).limit(50);\n    if (emailFilter) {\n        query = query.eq(\"clients.email\", emailFilter);\n    }\n    const result = await query;\n    if (result.error) {\n        res.statusCode = 500;\n        res.end(JSON.stringify({\n            message: \"Failed to load bookings\"\n        }));\n        return;\n    }\n    res.setHeader(\"Content-Type\", \"application/json\");\n    res.end(JSON.stringify({\n        bookings: result.data || []\n    }));\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9hcGkvYm9va2luZy5qcyIsIm1hcHBpbmdzIjoiO0FBQUEsTUFBTSxFQUFFQSxhQUFhLEVBQUUsR0FBR0MsbUJBQU9BLENBQUM7QUFFbEMsTUFBTUMsVUFBVSxDQUFDQztJQUNmLE1BQU1DLGFBQWFDLFFBQVFDLEdBQUcsQ0FBQ0MsV0FBVyxJQUFJO0lBQzlDLE1BQU1DLGNBQWMsQ0FBQ0wsSUFBSU0sT0FBTyxDQUFDLGdCQUFnQixJQUFJLEVBQUMsRUFBR0MsV0FBVztJQUNwRSxPQUFPRixlQUFlQSxnQkFBZ0JKLFdBQVdNLFdBQVc7QUFDOUQ7QUFFQUMsT0FBT0MsT0FBTyxHQUFHLE9BQU9ULEtBQUtVO0lBQzNCLElBQUlWLElBQUlXLE1BQU0sS0FBSyxPQUFPO1FBQ3hCRCxJQUFJRSxVQUFVLEdBQUc7UUFDakJGLElBQUlHLFNBQVMsQ0FBQyxTQUFTO1FBQ3ZCSCxJQUFJSSxHQUFHLENBQUM7UUFDUjtJQUNGO0lBRUEsSUFBSSxDQUFDZixRQUFRQyxNQUFNO1FBQ2pCVSxJQUFJRSxVQUFVLEdBQUc7UUFDakJGLElBQUlJLEdBQUcsQ0FBQ0MsS0FBS0MsU0FBUyxDQUFDO1lBQUVDLFNBQVM7UUFBdUI7UUFDekQ7SUFDRjtJQUVBLE1BQU1DLGNBQWMsQ0FBQ2xCLElBQUltQixLQUFLLENBQUNDLEtBQUssSUFBSSxFQUFDLEVBQUdiLFdBQVc7SUFFdkQsSUFBSVksUUFBUXRCLGNBQ1R3QixJQUFJLENBQUMsWUFDTEMsTUFBTSxDQUFDLDBFQUNQQyxLQUFLLENBQUMsWUFBWTtRQUFFQyxXQUFXO0lBQU0sR0FDckNDLEtBQUssQ0FBQztJQUVULElBQUlQLGFBQWE7UUFDZkMsUUFBUUEsTUFBTU8sRUFBRSxDQUFDLGlCQUFpQlI7SUFDcEM7SUFFQSxNQUFNUyxTQUFTLE1BQU1SO0lBRXJCLElBQUlRLE9BQU9DLEtBQUssRUFBRTtRQUNoQmxCLElBQUlFLFVBQVUsR0FBRztRQUNqQkYsSUFBSUksR0FBRyxDQUFDQyxLQUFLQyxTQUFTLENBQUM7WUFBRUMsU0FBUztRQUEwQjtRQUM1RDtJQUNGO0lBRUFQLElBQUlHLFNBQVMsQ0FBQyxnQkFBZ0I7SUFDOUJILElBQUlJLEdBQUcsQ0FBQ0MsS0FBS0MsU0FBUyxDQUFDO1FBQUVhLFVBQVVGLE9BQU9HLElBQUksSUFBSSxFQUFFO0lBQUM7QUFDdkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vYXBpL2Jvb2tpbmcuanM/MjExZiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHN1cGFiYXNlQWRtaW4gfSA9IHJlcXVpcmUoJy4vX2xpYi9zdXBhYmFzZScpO1xyXG5cclxuY29uc3QgaXNBZG1pbiA9IChyZXEpID0+IHtcclxuICBjb25zdCBhZG1pbkVtYWlsID0gcHJvY2Vzcy5lbnYuQURNSU5fRU1BSUwgfHwgJ2plcm9lbkBqZXJvZW5hbmRwYXdzLmNvbSc7XHJcbiAgY29uc3QgaGVhZGVyRW1haWwgPSAocmVxLmhlYWRlcnNbJ3gtYWRtaW4tZW1haWwnXSB8fCAnJykudG9Mb3dlckNhc2UoKTtcclxuICByZXR1cm4gaGVhZGVyRW1haWwgJiYgaGVhZGVyRW1haWwgPT09IGFkbWluRW1haWwudG9Mb3dlckNhc2UoKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdHRVQnKSB7XHJcbiAgICByZXMuc3RhdHVzQ29kZSA9IDQwNTtcclxuICAgIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgJ0dFVCcpO1xyXG4gICAgcmVzLmVuZCgnTWV0aG9kIE5vdCBBbGxvd2VkJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBpZiAoIWlzQWRtaW4ocmVxKSkge1xyXG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDE7XHJcbiAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogJ0FkbWluIGVtYWlsIHJlcXVpcmVkJyB9KSk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjb25zdCBlbWFpbEZpbHRlciA9IChyZXEucXVlcnkuZW1haWwgfHwgJycpLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gIGxldCBxdWVyeSA9IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdib29raW5ncycpXHJcbiAgICAuc2VsZWN0KCcqLCBjbGllbnRzKGZ1bGxfbmFtZSxlbWFpbCksIHNlcnZpY2VzX2NhdGFsb2coKiksIGJvb2tpbmdfcGV0cyhwZXRfaWQpJylcclxuICAgIC5vcmRlcignc3RhcnRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgIC5saW1pdCg1MCk7XHJcblxyXG4gIGlmIChlbWFpbEZpbHRlcikge1xyXG4gICAgcXVlcnkgPSBxdWVyeS5lcSgnY2xpZW50cy5lbWFpbCcsIGVtYWlsRmlsdGVyKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5O1xyXG5cclxuICBpZiAocmVzdWx0LmVycm9yKSB7XHJcbiAgICByZXMuc3RhdHVzQ29kZSA9IDUwMDtcclxuICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGxvYWQgYm9va2luZ3MnIH0pKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XHJcbiAgcmVzLmVuZChKU09OLnN0cmluZ2lmeSh7IGJvb2tpbmdzOiByZXN1bHQuZGF0YSB8fCBbXSB9KSk7XHJcbn07Il0sIm5hbWVzIjpbInN1cGFiYXNlQWRtaW4iLCJyZXF1aXJlIiwiaXNBZG1pbiIsInJlcSIsImFkbWluRW1haWwiLCJwcm9jZXNzIiwiZW52IiwiQURNSU5fRU1BSUwiLCJoZWFkZXJFbWFpbCIsImhlYWRlcnMiLCJ0b0xvd2VyQ2FzZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXMiLCJtZXRob2QiLCJzdGF0dXNDb2RlIiwic2V0SGVhZGVyIiwiZW5kIiwiSlNPTiIsInN0cmluZ2lmeSIsIm1lc3NhZ2UiLCJlbWFpbEZpbHRlciIsInF1ZXJ5IiwiZW1haWwiLCJmcm9tIiwic2VsZWN0Iiwib3JkZXIiLCJhc2NlbmRpbmciLCJsaW1pdCIsImVxIiwicmVzdWx0IiwiZXJyb3IiLCJib29raW5ncyIsImRhdGEiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./api/booking.js\n");

/***/ }),

/***/ "(api)/./pages/api/bookings.js":
/*!*******************************!*\
  !*** ./pages/api/bookings.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst bookingsHandler = __webpack_require__(/*! ../../api/booking */ \"(api)/./api/booking.js\");\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (bookingsHandler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYm9va2luZ3MuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU1BLGtCQUFrQkMsbUJBQU9BLENBQUM7QUFFaEMsaUVBQWVELGVBQWVBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vcGFnZXMvYXBpL2Jvb2tpbmdzLmpzPzcxNTciXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYm9va2luZ3NIYW5kbGVyID0gcmVxdWlyZSgnLi4vLi4vYXBpL2Jvb2tpbmcnKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGJvb2tpbmdzSGFuZGxlcjsiXSwibmFtZXMiOlsiYm9va2luZ3NIYW5kbGVyIiwicmVxdWlyZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/bookings.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbookings&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbookings.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();