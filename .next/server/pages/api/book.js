"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/book";
exports.ids = ["pages/api/book"];
exports.modules = {

/***/ "luxon":
/*!************************!*\
  !*** external "luxon" ***!
  \************************/
/***/ ((module) => {

module.exports = require("luxon");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\book.js */ \"(api)/./pages/api/book.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/book\",\n        pathname: \"/api/book\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJvb2smcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2Jvb2suanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDa0Q7QUFDbEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLz8xNmMwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcYm9vay5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Jvb2tcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ib29rXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./api/_lib/auth.js":
/*!**************************!*\
  !*** ./api/_lib/auth.js ***!
  \**************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst TOKEN_COOKIE = \"msTokens\";\nconst SCOPES = [\n    \"offline_access\",\n    \"Calendars.ReadWrite\"\n];\nconst requiredEnv = [\n    \"AZURE_CLIENT_ID\",\n    \"AZURE_CLIENT_SECRET\",\n    \"AZURE_TENANT_ID\",\n    \"BACKEND_BASE_URL\"\n];\nrequiredEnv.forEach((key)=>{\n    if (!process.env[key]) {\n        console.warn(`Missing env var ${key}`);\n    }\n});\nconst authority = `https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0`;\nconst redirectUri = process.env.AZURE_REDIRECT_URI || `${process.env.BACKEND_BASE_URL}/api/auth/microsoft/callback`;\nconst encryptionKey = crypto.createHash(\"sha256\").update(process.env.TOKEN_ENCRYPTION_KEY || process.env.AZURE_CLIENT_SECRET).digest();\nconst serializeCookie = (name, value, options = {})=>{\n    const segments = [\n        `${name}=${value}`\n    ];\n    if (options.maxAge) segments.push(`Max-Age=${options.maxAge}`);\n    if (options.domain) segments.push(`Domain=${options.domain}`);\n    if (options.path) segments.push(`Path=${options.path}`);\n    if (options.secure) segments.push(\"Secure\");\n    if (options.httpOnly) segments.push(\"HttpOnly\");\n    if (options.sameSite) segments.push(`SameSite=${options.sameSite}`);\n    return segments.join(\"; \");\n};\nconst parseCookieHeader = (header)=>{\n    if (!header) return {};\n    return header.split(/; */).reduce((acc, part)=>{\n        const [key, ...rest] = part.split(\"=\");\n        if (!key) return acc;\n        acc[key.trim()] = decodeURIComponent(rest.join(\"=\"));\n        return acc;\n    }, {});\n};\nconst encrypt = (data)=>{\n    const iv = crypto.randomBytes(16);\n    const cipher = crypto.createCipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    const encrypted = Buffer.concat([\n        cipher.update(JSON.stringify(data), \"utf8\"),\n        cipher.final()\n    ]);\n    const authTag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        authTag,\n        encrypted\n    ]).toString(\"base64\");\n};\nconst decrypt = (payload)=>{\n    const buffer = Buffer.from(payload, \"base64\");\n    const iv = buffer.subarray(0, 16);\n    const tag = buffer.subarray(16, 32);\n    const encrypted = buffer.subarray(32);\n    const decipher = crypto.createDecipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    decipher.setAuthTag(tag);\n    const decrypted = Buffer.concat([\n        decipher.update(encrypted),\n        decipher.final()\n    ]).toString(\"utf8\");\n    return JSON.parse(decrypted);\n};\nconst serializeTokens = (res, tokens)=>{\n    const encoded = encrypt(tokens);\n    const secure = \"development\" === \"production\";\n    const cookieString = serializeCookie(TOKEN_COOKIE, encoded, {\n        httpOnly: true,\n        secure,\n        sameSite: \"lax\",\n        path: \"/\",\n        maxAge: 60 * 60 * 24 * 30\n    });\n    res.setHeader(\"Set-Cookie\", cookieString);\n};\nconst parseTokens = (req)=>{\n    if (!req.headers.cookie) return null;\n    const cookies = parseCookieHeader(req.headers.cookie || \"\");\n    if (!cookies[TOKEN_COOKIE]) return null;\n    try {\n        return decrypt(cookies[TOKEN_COOKIE]);\n    } catch (error) {\n        console.error(\"Failed to decrypt token cookie\", error);\n        return null;\n    }\n};\nconst buildAuthUrl = async ()=>{\n    const params = new URLSearchParams({\n        client_id: process.env.AZURE_CLIENT_ID,\n        response_type: \"code\",\n        redirect_uri: redirectUri,\n        response_mode: \"query\",\n        scope: SCOPES.join(\" \"),\n        prompt: \"select_account\"\n    });\n    return `${authority}/authorize?${params.toString()}`;\n};\nconst tokenRequest = async (formData, { includeRedirect = true } = {})=>{\n    const response = await fetch(`${authority}/token`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n        },\n        body: new URLSearchParams({\n            client_id: process.env.AZURE_CLIENT_ID,\n            client_secret: process.env.AZURE_CLIENT_SECRET,\n            ...includeRedirect ? {\n                redirect_uri: redirectUri\n            } : {},\n            ...formData\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Token endpoint error: ${response.status} ${error}`);\n    }\n    const data = await response.json();\n    return {\n        accessToken: data.access_token,\n        refreshToken: data.refresh_token,\n        expiresAt: new Date(Date.now() + data.expires_in * 1000).toISOString()\n    };\n};\nconst exchangeCodeForTokens = async (code)=>tokenRequest({\n        grant_type: \"authorization_code\",\n        code,\n        scope: SCOPES.join(\" \")\n    });\nconst refreshTokens = async (stored)=>{\n    if (!stored?.refreshToken) return null;\n    return tokenRequest({\n        grant_type: \"refresh_token\",\n        refresh_token: stored.refreshToken,\n        scope: SCOPES.join(\" \")\n    });\n};\nlet cachedAppToken = null;\nconst appTokenRequest = async ()=>{\n    const token = await tokenRequest({\n        grant_type: \"client_credentials\",\n        scope: \"https://graph.microsoft.com/.default\"\n    }, {\n        includeRedirect: false\n    });\n    cachedAppToken = {\n        accessToken: token.accessToken,\n        expiresAt: token.expiresAt\n    };\n    return cachedAppToken;\n};\nconst hasValidAppToken = ()=>{\n    if (!cachedAppToken?.expiresAt) return false;\n    const expiresAt = new Date(cachedAppToken.expiresAt);\n    return expiresAt.getTime() > Date.now() + 60 * 1000;\n};\nconst getAppOnlyAccessToken = async ()=>{\n    if (hasValidAppToken()) {\n        return cachedAppToken.accessToken;\n    }\n    const freshToken = await appTokenRequest();\n    return freshToken.accessToken;\n};\nconst needsRefresh = (tokens)=>{\n    if (!tokens?.expiresAt) return true;\n    const expiresAt = new Date(tokens.expiresAt);\n    const refreshThreshold = Date.now() + 5 * 60 * 1000;\n    return expiresAt.getTime() <= refreshThreshold;\n};\nconst ensureTokens = async (req, res)=>{\n    const stored = parseTokens(req);\n    if (!stored) return null;\n    if (!needsRefresh(stored)) {\n        return stored;\n    }\n    const refreshed = await refreshTokens(stored);\n    if (refreshed) {\n        serializeTokens(res, refreshed);\n        return refreshed;\n    }\n    return null;\n};\nmodule.exports = {\n    buildAuthUrl,\n    ensureTokens,\n    exchangeCodeForTokens,\n    getAppOnlyAccessToken,\n    parseTokens,\n    serializeTokens\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFVYyxPQUFPLE1BQU1JO0FBQ2hDO0FBRUEsTUFBTUMsZUFBZSxPQUFPbkQsS0FBS047SUFDL0IsTUFBTStDLFNBQVMxQyxZQUFZQztJQUMzQixJQUFJLENBQUN5QyxRQUFRLE9BQU87SUFFcEIsSUFBSSxDQUFDUSxhQUFhUixTQUFTO1FBQ3pCLE9BQU9BO0lBQ1Q7SUFFQSxNQUFNVyxZQUFZLE1BQU1aLGNBQWNDO0lBQ3RDLElBQUlXLFdBQVc7UUFDYjNELGdCQUFnQkMsS0FBSzBEO1FBQ3JCLE9BQU9BO0lBQ1Q7SUFFQSxPQUFPO0FBQ1Q7QUFFQUMsT0FBT0MsT0FBTyxHQUFHO0lBQ2ZqRDtJQUNBOEM7SUFDQWQ7SUFDQVU7SUFDQWhEO0lBQ0FOO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vYXBpL19saWIvYXV0aC5qcz83NjI0Il0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNyeXB0byA9IHJlcXVpcmUoXCJjcnlwdG9cIik7XHJcblxyXG5jb25zdCBUT0tFTl9DT09LSUUgPSBcIm1zVG9rZW5zXCI7XHJcbmNvbnN0IFNDT1BFUyA9IFtcIm9mZmxpbmVfYWNjZXNzXCIsIFwiQ2FsZW5kYXJzLlJlYWRXcml0ZVwiXTtcclxuXHJcbmNvbnN0IHJlcXVpcmVkRW52ID0gW1xyXG4gIFwiQVpVUkVfQ0xJRU5UX0lEXCIsXHJcbiAgXCJBWlVSRV9DTElFTlRfU0VDUkVUXCIsXHJcbiAgXCJBWlVSRV9URU5BTlRfSURcIixcclxuICBcIkJBQ0tFTkRfQkFTRV9VUkxcIixcclxuXTtcclxuXHJcbnJlcXVpcmVkRW52LmZvckVhY2goKGtleSkgPT4ge1xyXG4gIGlmICghcHJvY2Vzcy5lbnZba2V5XSkge1xyXG4gICAgY29uc29sZS53YXJuKGBNaXNzaW5nIGVudiB2YXIgJHtrZXl9YCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmNvbnN0IGF1dGhvcml0eSA9IGBodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vJHtwcm9jZXNzLmVudi5BWlVSRV9URU5BTlRfSUR9L29hdXRoMi92Mi4wYDtcclxuY29uc3QgcmVkaXJlY3RVcmkgPVxyXG4gIHByb2Nlc3MuZW52LkFaVVJFX1JFRElSRUNUX1VSSSB8fFxyXG4gIGAke3Byb2Nlc3MuZW52LkJBQ0tFTkRfQkFTRV9VUkx9L2FwaS9hdXRoL21pY3Jvc29mdC9jYWxsYmFja2A7XHJcblxyXG5jb25zdCBlbmNyeXB0aW9uS2V5ID0gY3J5cHRvXHJcbiAgLmNyZWF0ZUhhc2goXCJzaGEyNTZcIilcclxuICAudXBkYXRlKHByb2Nlc3MuZW52LlRPS0VOX0VOQ1JZUFRJT05fS0VZIHx8IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9TRUNSRVQpXHJcbiAgLmRpZ2VzdCgpO1xyXG5cclxuY29uc3Qgc2VyaWFsaXplQ29va2llID0gKG5hbWUsIHZhbHVlLCBvcHRpb25zID0ge30pID0+IHtcclxuICBjb25zdCBzZWdtZW50cyA9IFtgJHtuYW1lfT0ke3ZhbHVlfWBdO1xyXG4gIGlmIChvcHRpb25zLm1heEFnZSkgc2VnbWVudHMucHVzaChgTWF4LUFnZT0ke29wdGlvbnMubWF4QWdlfWApO1xyXG4gIGlmIChvcHRpb25zLmRvbWFpbikgc2VnbWVudHMucHVzaChgRG9tYWluPSR7b3B0aW9ucy5kb21haW59YCk7XHJcbiAgaWYgKG9wdGlvbnMucGF0aCkgc2VnbWVudHMucHVzaChgUGF0aD0ke29wdGlvbnMucGF0aH1gKTtcclxuICBpZiAob3B0aW9ucy5zZWN1cmUpIHNlZ21lbnRzLnB1c2goXCJTZWN1cmVcIik7XHJcbiAgaWYgKG9wdGlvbnMuaHR0cE9ubHkpIHNlZ21lbnRzLnB1c2goXCJIdHRwT25seVwiKTtcclxuICBpZiAob3B0aW9ucy5zYW1lU2l0ZSkgc2VnbWVudHMucHVzaChgU2FtZVNpdGU9JHtvcHRpb25zLnNhbWVTaXRlfWApO1xyXG4gIHJldHVybiBzZWdtZW50cy5qb2luKFwiOyBcIik7XHJcbn07XHJcblxyXG5jb25zdCBwYXJzZUNvb2tpZUhlYWRlciA9IChoZWFkZXIpID0+IHtcclxuICBpZiAoIWhlYWRlcikgcmV0dXJuIHt9O1xyXG4gIHJldHVybiBoZWFkZXIuc3BsaXQoLzsgKi8pLnJlZHVjZSgoYWNjLCBwYXJ0KSA9PiB7XHJcbiAgICBjb25zdCBba2V5LCAuLi5yZXN0XSA9IHBhcnQuc3BsaXQoXCI9XCIpO1xyXG4gICAgaWYgKCFrZXkpIHJldHVybiBhY2M7XHJcbiAgICBhY2Nba2V5LnRyaW0oKV0gPSBkZWNvZGVVUklDb21wb25lbnQocmVzdC5qb2luKFwiPVwiKSk7XHJcbiAgICByZXR1cm4gYWNjO1xyXG4gIH0sIHt9KTtcclxufTtcclxuXHJcbmNvbnN0IGVuY3J5cHQgPSAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KTtcclxuICBjb25zdCBjaXBoZXIgPSBjcnlwdG8uY3JlYXRlQ2lwaGVyaXYoXCJhZXMtMjU2LWdjbVwiLCBlbmNyeXB0aW9uS2V5LCBpdik7XHJcbiAgY29uc3QgZW5jcnlwdGVkID0gQnVmZmVyLmNvbmNhdChbXHJcbiAgICBjaXBoZXIudXBkYXRlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBcInV0ZjhcIiksXHJcbiAgICBjaXBoZXIuZmluYWwoKSxcclxuICBdKTtcclxuICBjb25zdCBhdXRoVGFnID0gY2lwaGVyLmdldEF1dGhUYWcoKTtcclxuICByZXR1cm4gQnVmZmVyLmNvbmNhdChbaXYsIGF1dGhUYWcsIGVuY3J5cHRlZF0pLnRvU3RyaW5nKFwiYmFzZTY0XCIpO1xyXG59O1xyXG5cclxuY29uc3QgZGVjcnlwdCA9IChwYXlsb2FkKSA9PiB7XHJcbiAgY29uc3QgYnVmZmVyID0gQnVmZmVyLmZyb20ocGF5bG9hZCwgXCJiYXNlNjRcIik7XHJcbiAgY29uc3QgaXYgPSBidWZmZXIuc3ViYXJyYXkoMCwgMTYpO1xyXG4gIGNvbnN0IHRhZyA9IGJ1ZmZlci5zdWJhcnJheSgxNiwgMzIpO1xyXG4gIGNvbnN0IGVuY3J5cHRlZCA9IGJ1ZmZlci5zdWJhcnJheSgzMik7XHJcbiAgY29uc3QgZGVjaXBoZXIgPSBjcnlwdG8uY3JlYXRlRGVjaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIGVuY3J5cHRpb25LZXksIGl2KTtcclxuICBkZWNpcGhlci5zZXRBdXRoVGFnKHRhZyk7XHJcbiAgY29uc3QgZGVjcnlwdGVkID0gQnVmZmVyLmNvbmNhdChbXHJcbiAgICBkZWNpcGhlci51cGRhdGUoZW5jcnlwdGVkKSxcclxuICAgIGRlY2lwaGVyLmZpbmFsKCksXHJcbiAgXSkudG9TdHJpbmcoXCJ1dGY4XCIpO1xyXG4gIHJldHVybiBKU09OLnBhcnNlKGRlY3J5cHRlZCk7XHJcbn07XHJcblxyXG5jb25zdCBzZXJpYWxpemVUb2tlbnMgPSAocmVzLCB0b2tlbnMpID0+IHtcclxuICBjb25zdCBlbmNvZGVkID0gZW5jcnlwdCh0b2tlbnMpO1xyXG4gIGNvbnN0IHNlY3VyZSA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIjtcclxuICBjb25zdCBjb29raWVTdHJpbmcgPSBzZXJpYWxpemVDb29raWUoVE9LRU5fQ09PS0lFLCBlbmNvZGVkLCB7XHJcbiAgICBodHRwT25seTogdHJ1ZSxcclxuICAgIHNlY3VyZSxcclxuICAgIHNhbWVTaXRlOiBcImxheFwiLFxyXG4gICAgcGF0aDogXCIvXCIsXHJcbiAgICBtYXhBZ2U6IDYwICogNjAgKiAyNCAqIDMwLFxyXG4gIH0pO1xyXG4gIHJlcy5zZXRIZWFkZXIoXCJTZXQtQ29va2llXCIsIGNvb2tpZVN0cmluZyk7XHJcbn07XHJcblxyXG5jb25zdCBwYXJzZVRva2VucyA9IChyZXEpID0+IHtcclxuICBpZiAoIXJlcS5oZWFkZXJzLmNvb2tpZSkgcmV0dXJuIG51bGw7XHJcbiAgY29uc3QgY29va2llcyA9IHBhcnNlQ29va2llSGVhZGVyKHJlcS5oZWFkZXJzLmNvb2tpZSB8fCBcIlwiKTtcclxuICBpZiAoIWNvb2tpZXNbVE9LRU5fQ09PS0lFXSkgcmV0dXJuIG51bGw7XHJcbiAgdHJ5IHtcclxuICAgIHJldHVybiBkZWNyeXB0KGNvb2tpZXNbVE9LRU5fQ09PS0lFXSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZGVjcnlwdCB0b2tlbiBjb29raWVcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59O1xyXG5cclxuY29uc3QgYnVpbGRBdXRoVXJsID0gYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xyXG4gICAgY2xpZW50X2lkOiBwcm9jZXNzLmVudi5BWlVSRV9DTElFTlRfSUQsXHJcbiAgICByZXNwb25zZV90eXBlOiBcImNvZGVcIixcclxuICAgIHJlZGlyZWN0X3VyaTogcmVkaXJlY3RVcmksXHJcbiAgICByZXNwb25zZV9tb2RlOiBcInF1ZXJ5XCIsXHJcbiAgICBzY29wZTogU0NPUEVTLmpvaW4oXCIgXCIpLFxyXG4gICAgcHJvbXB0OiBcInNlbGVjdF9hY2NvdW50XCIsXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBgJHthdXRob3JpdHl9L2F1dGhvcml6ZT8ke3BhcmFtcy50b1N0cmluZygpfWA7XHJcbn07XHJcblxyXG5jb25zdCB0b2tlblJlcXVlc3QgPSBhc3luYyAoZm9ybURhdGEsIHsgaW5jbHVkZVJlZGlyZWN0ID0gdHJ1ZSB9ID0ge30pID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke2F1dGhvcml0eX0vdG9rZW5gLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiIH0sXHJcbiAgICBib2R5OiBuZXcgVVJMU2VhcmNoUGFyYW1zKHtcclxuICAgICAgY2xpZW50X2lkOiBwcm9jZXNzLmVudi5BWlVSRV9DTElFTlRfSUQsXHJcbiAgICAgIGNsaWVudF9zZWNyZXQ6IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9TRUNSRVQsXHJcbiAgICAgIC4uLihpbmNsdWRlUmVkaXJlY3QgPyB7IHJlZGlyZWN0X3VyaTogcmVkaXJlY3RVcmkgfSA6IHt9KSxcclxuICAgICAgLi4uZm9ybURhdGEsXHJcbiAgICB9KSxcclxuICB9KTtcclxuXHJcbiAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRva2VuIGVuZHBvaW50IGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtlcnJvcn1gKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgcmV0dXJuIHtcclxuICAgIGFjY2Vzc1Rva2VuOiBkYXRhLmFjY2Vzc190b2tlbixcclxuICAgIHJlZnJlc2hUb2tlbjogZGF0YS5yZWZyZXNoX3Rva2VuLFxyXG4gICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgZGF0YS5leHBpcmVzX2luICogMTAwMCkudG9JU09TdHJpbmcoKSxcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgZXhjaGFuZ2VDb2RlRm9yVG9rZW5zID0gYXN5bmMgKGNvZGUpID0+XHJcbiAgdG9rZW5SZXF1ZXN0KHtcclxuICAgIGdyYW50X3R5cGU6IFwiYXV0aG9yaXphdGlvbl9jb2RlXCIsXHJcbiAgICBjb2RlLFxyXG4gICAgc2NvcGU6IFNDT1BFUy5qb2luKFwiIFwiKSxcclxuICB9KTtcclxuXHJcbmNvbnN0IHJlZnJlc2hUb2tlbnMgPSBhc3luYyAoc3RvcmVkKSA9PiB7XHJcbiAgaWYgKCFzdG9yZWQ/LnJlZnJlc2hUb2tlbikgcmV0dXJuIG51bGw7XHJcbiAgcmV0dXJuIHRva2VuUmVxdWVzdCh7XHJcbiAgICBncmFudF90eXBlOiBcInJlZnJlc2hfdG9rZW5cIixcclxuICAgIHJlZnJlc2hfdG9rZW46IHN0b3JlZC5yZWZyZXNoVG9rZW4sXHJcbiAgICBzY29wZTogU0NPUEVTLmpvaW4oXCIgXCIpLFxyXG4gIH0pO1xyXG59O1xyXG5cclxubGV0IGNhY2hlZEFwcFRva2VuID0gbnVsbDtcclxuXHJcbmNvbnN0IGFwcFRva2VuUmVxdWVzdCA9IGFzeW5jICgpID0+IHtcclxuICBjb25zdCB0b2tlbiA9IGF3YWl0IHRva2VuUmVxdWVzdChcclxuICAgIHtcclxuICAgICAgZ3JhbnRfdHlwZTogXCJjbGllbnRfY3JlZGVudGlhbHNcIixcclxuICAgICAgc2NvcGU6IFwiaHR0cHM6Ly9ncmFwaC5taWNyb3NvZnQuY29tLy5kZWZhdWx0XCIsXHJcbiAgICB9LFxyXG4gICAgeyBpbmNsdWRlUmVkaXJlY3Q6IGZhbHNlIH1cclxuICApO1xyXG5cclxuICBjYWNoZWRBcHBUb2tlbiA9IHtcclxuICAgIGFjY2Vzc1Rva2VuOiB0b2tlbi5hY2Nlc3NUb2tlbixcclxuICAgIGV4cGlyZXNBdDogdG9rZW4uZXhwaXJlc0F0LFxyXG4gIH07XHJcblxyXG4gIHJldHVybiBjYWNoZWRBcHBUb2tlbjtcclxufTtcclxuXHJcbmNvbnN0IGhhc1ZhbGlkQXBwVG9rZW4gPSAoKSA9PiB7XHJcbiAgaWYgKCFjYWNoZWRBcHBUb2tlbj8uZXhwaXJlc0F0KSByZXR1cm4gZmFsc2U7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoY2FjaGVkQXBwVG9rZW4uZXhwaXJlc0F0KTtcclxuICByZXR1cm4gZXhwaXJlc0F0LmdldFRpbWUoKSA+IERhdGUubm93KCkgKyA2MCAqIDEwMDA7XHJcbn07XHJcblxyXG5jb25zdCBnZXRBcHBPbmx5QWNjZXNzVG9rZW4gPSBhc3luYyAoKSA9PiB7XHJcbiAgaWYgKGhhc1ZhbGlkQXBwVG9rZW4oKSkge1xyXG4gICAgcmV0dXJuIGNhY2hlZEFwcFRva2VuLmFjY2Vzc1Rva2VuO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZnJlc2hUb2tlbiA9IGF3YWl0IGFwcFRva2VuUmVxdWVzdCgpO1xyXG4gIHJldHVybiBmcmVzaFRva2VuLmFjY2Vzc1Rva2VuO1xyXG59O1xyXG5cclxuY29uc3QgbmVlZHNSZWZyZXNoID0gKHRva2VucykgPT4ge1xyXG4gIGlmICghdG9rZW5zPy5leHBpcmVzQXQpIHJldHVybiB0cnVlO1xyXG4gIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKHRva2Vucy5leHBpcmVzQXQpO1xyXG4gIGNvbnN0IHJlZnJlc2hUaHJlc2hvbGQgPSBEYXRlLm5vdygpICsgNSAqIDYwICogMTAwMDtcclxuICByZXR1cm4gZXhwaXJlc0F0LmdldFRpbWUoKSA8PSByZWZyZXNoVGhyZXNob2xkO1xyXG59O1xyXG5cclxuY29uc3QgZW5zdXJlVG9rZW5zID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgY29uc3Qgc3RvcmVkID0gcGFyc2VUb2tlbnMocmVxKTtcclxuICBpZiAoIXN0b3JlZCkgcmV0dXJuIG51bGw7XHJcblxyXG4gIGlmICghbmVlZHNSZWZyZXNoKHN0b3JlZCkpIHtcclxuICAgIHJldHVybiBzdG9yZWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdCByZWZyZXNoZWQgPSBhd2FpdCByZWZyZXNoVG9rZW5zKHN0b3JlZCk7XHJcbiAgaWYgKHJlZnJlc2hlZCkge1xyXG4gICAgc2VyaWFsaXplVG9rZW5zKHJlcywgcmVmcmVzaGVkKTtcclxuICAgIHJldHVybiByZWZyZXNoZWQ7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbnVsbDtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIGJ1aWxkQXV0aFVybCxcclxuICBlbnN1cmVUb2tlbnMsXHJcbiAgZXhjaGFuZ2VDb2RlRm9yVG9rZW5zLFxyXG4gIGdldEFwcE9ubHlBY2Nlc3NUb2tlbixcclxuICBwYXJzZVRva2VucyxcclxuICBzZXJpYWxpemVUb2tlbnMsXHJcbn07Il0sIm5hbWVzIjpbImNyeXB0byIsInJlcXVpcmUiLCJUT0tFTl9DT09LSUUiLCJTQ09QRVMiLCJyZXF1aXJlZEVudiIsImZvckVhY2giLCJrZXkiLCJwcm9jZXNzIiwiZW52IiwiY29uc29sZSIsIndhcm4iLCJhdXRob3JpdHkiLCJBWlVSRV9URU5BTlRfSUQiLCJyZWRpcmVjdFVyaSIsIkFaVVJFX1JFRElSRUNUX1VSSSIsIkJBQ0tFTkRfQkFTRV9VUkwiLCJlbmNyeXB0aW9uS2V5IiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsIlRPS0VOX0VOQ1JZUFRJT05fS0VZIiwiQVpVUkVfQ0xJRU5UX1NFQ1JFVCIsImRpZ2VzdCIsInNlcmlhbGl6ZUNvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJzZWdtZW50cyIsIm1heEFnZSIsInB1c2giLCJkb21haW4iLCJwYXRoIiwic2VjdXJlIiwiaHR0cE9ubHkiLCJzYW1lU2l0ZSIsImpvaW4iLCJwYXJzZUNvb2tpZUhlYWRlciIsImhlYWRlciIsInNwbGl0IiwicmVkdWNlIiwiYWNjIiwicGFydCIsInJlc3QiLCJ0cmltIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZW5jcnlwdCIsImRhdGEiLCJpdiIsInJhbmRvbUJ5dGVzIiwiY2lwaGVyIiwiY3JlYXRlQ2lwaGVyaXYiLCJlbmNyeXB0ZWQiLCJCdWZmZXIiLCJjb25jYXQiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluYWwiLCJhdXRoVGFnIiwiZ2V0QXV0aFRhZyIsInRvU3RyaW5nIiwiZGVjcnlwdCIsInBheWxvYWQiLCJidWZmZXIiLCJmcm9tIiwic3ViYXJyYXkiLCJ0YWciLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyaXYiLCJzZXRBdXRoVGFnIiwiZGVjcnlwdGVkIiwicGFyc2UiLCJzZXJpYWxpemVUb2tlbnMiLCJyZXMiLCJ0b2tlbnMiLCJlbmNvZGVkIiwiY29va2llU3RyaW5nIiwic2V0SGVhZGVyIiwicGFyc2VUb2tlbnMiLCJyZXEiLCJoZWFkZXJzIiwiY29va2llIiwiY29va2llcyIsImVycm9yIiwiYnVpbGRBdXRoVXJsIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiY2xpZW50X2lkIiwiQVpVUkVfQ0xJRU5UX0lEIiwicmVzcG9uc2VfdHlwZSIsInJlZGlyZWN0X3VyaSIsInJlc3BvbnNlX21vZGUiLCJzY29wZSIsInByb21wdCIsInRva2VuUmVxdWVzdCIsImZvcm1EYXRhIiwiaW5jbHVkZVJlZGlyZWN0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJjbGllbnRfc2VjcmV0Iiwib2siLCJ0ZXh0IiwiRXJyb3IiLCJzdGF0dXMiLCJqc29uIiwiYWNjZXNzVG9rZW4iLCJhY2Nlc3NfdG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJyZWZyZXNoX3Rva2VuIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsImV4cGlyZXNfaW4iLCJ0b0lTT1N0cmluZyIsImV4Y2hhbmdlQ29kZUZvclRva2VucyIsImNvZGUiLCJncmFudF90eXBlIiwicmVmcmVzaFRva2VucyIsInN0b3JlZCIsImNhY2hlZEFwcFRva2VuIiwiYXBwVG9rZW5SZXF1ZXN0IiwidG9rZW4iLCJoYXNWYWxpZEFwcFRva2VuIiwiZ2V0VGltZSIsImdldEFwcE9ubHlBY2Nlc3NUb2tlbiIsImZyZXNoVG9rZW4iLCJuZWVkc1JlZnJlc2giLCJyZWZyZXNoVGhyZXNob2xkIiwiZW5zdXJlVG9rZW5zIiwicmVmcmVzaGVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./api/_lib/auth.js\n");

/***/ }),

/***/ "(api)/./api/_lib/graph.js":
/*!***************************!*\
  !*** ./api/_lib/graph.js ***!
  \***************************/
/***/ ((module) => {

eval("\nconst GRAPH_BASE = \"https://graph.microsoft.com/v1.0\";\nconst MAX_GRAPH_WINDOW_DAYS = 62;\nconst mapBusyIntervals = (items)=>items.map((item)=>({\n            start: new Date(item.start.dateTime),\n            end: new Date(item.end.dateTime)\n        }));\nconst overlaps = (start, end, busy)=>{\n    return busy.some((interval)=>start < interval.end && end > interval.start);\n};\nconst buildSlots = (startDate, days, intervalMinutes, busy)=>{\n    const slotsByDate = {};\n    const workingDayStart = 9;\n    const workingDayEnd = 17;\n    for(let i = 0; i < days; i += 1){\n        const date = new Date(startDate);\n        date.setDate(date.getDate() + i);\n        const currentDate = date.toISOString().slice(0, 10);\n        slotsByDate[currentDate] = [];\n        for(let hour = workingDayStart; hour <= workingDayEnd; hour += 1){\n            for(let minute = 0; minute < 60; minute += intervalMinutes){\n                const slotStart = new Date(date);\n                slotStart.setUTCHours(hour, minute, 0, 0);\n                const slotEnd = new Date(slotStart);\n                slotEnd.setMinutes(slotEnd.getMinutes() + intervalMinutes);\n                const time = slotStart.toISOString().slice(11, 16);\n                const available = !overlaps(slotStart, slotEnd, busy);\n                slotsByDate[currentDate].push({\n                    time,\n                    available\n                });\n            }\n        }\n    }\n    return slotsByDate;\n};\nconst buildPrincipalPath = (calendarId)=>calendarId ? `/users/${encodeURIComponent(calendarId)}` : \"/me\";\nconst postScheduleRequest = async ({ accessToken, calendarId, startTime, endTime })=>{\n    const principalPath = buildPrincipalPath(calendarId);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/calendar/getSchedule`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            schedules: [\n                calendarId || \"me\"\n            ],\n            startTime: {\n                dateTime: startTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            endTime: {\n                dateTime: endTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            availabilityViewInterval: 30\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph schedule error: ${response.status} ${error}`);\n    }\n    return response.json();\n};\nconst getSchedule = async ({ accessToken, calendarId, windowDays = 7 })=>{\n    const totalDays = Math.max(windowDays, 1);\n    const startTime = new Date();\n    const busy = [];\n    let timeZone = \"UTC\";\n    for(let offset = 0; offset < totalDays; offset += MAX_GRAPH_WINDOW_DAYS){\n        const chunkStart = new Date(startTime);\n        chunkStart.setDate(chunkStart.getDate() + offset);\n        const chunkDays = Math.min(MAX_GRAPH_WINDOW_DAYS, totalDays - offset);\n        const chunkEnd = new Date(chunkStart);\n        chunkEnd.setDate(chunkEnd.getDate() + chunkDays);\n        const data = await postScheduleRequest({\n            accessToken,\n            calendarId,\n            startTime: chunkStart,\n            endTime: chunkEnd\n        });\n        const schedule = data.value?.[0];\n        if (schedule?.workingHours?.timeZone?.name) {\n            timeZone = schedule.workingHours.timeZone.name;\n        }\n        busy.push(...mapBusyIntervals(schedule?.scheduleItems || []));\n    }\n    const slotsByDate = buildSlots(startTime, totalDays, 30, busy);\n    const dates = Object.keys(slotsByDate).map((date)=>({\n            date,\n            slots: slotsByDate[date]\n        }));\n    return {\n        timeZone,\n        dates\n    };\n};\nconst createEvent = async ({ accessToken, calendarId, subject, body, start, bodyContentType = \"Text\", end, attendeeEmail, attendeeEmails = [], timeZone = \"UTC\" })=>{\n    const principalPath = buildPrincipalPath(calendarId);\n    const attendees = [\n        ...Array.isArray(attendeeEmails) ? attendeeEmails : [],\n        attendeeEmail\n    ].filter(Boolean).map((address)=>address.trim()).filter(Boolean).reduce((list, address)=>{\n        const key = address.toLowerCase();\n        if (list.some((attendee)=>attendee.emailAddress.address.toLowerCase() === key)) {\n            return list;\n        }\n        return [\n            ...list,\n            {\n                emailAddress: {\n                    address\n                },\n                type: \"required\"\n            }\n        ];\n    }, []);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/events`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            subject,\n            body: {\n                contentType: bodyContentType,\n                content: body\n            },\n            start: {\n                dateTime: start,\n                timeZone\n            },\n            end: {\n                dateTime: end,\n                timeZone\n            },\n            attendees,\n            isReminderOn: true,\n            reminderMinutesBeforeStart: 15\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph create event error: ${response.status} ${error}`);\n    }\n    return response.json();\n};\nconst sendMail = async ({ accessToken, fromCalendarId, to, subject, body, contentType = \"HTML\", from, replyTo })=>{\n    if (!to) {\n        throw new Error(\"sendMail called without recipient email address\");\n    }\n    const recipients = Array.isArray(to) ? to.filter(Boolean).map((address)=>({\n            emailAdress: {\n                address\n            }\n        })) : [\n        {\n            emailAddress: {\n                address: to\n            }\n        }\n    ];\n    const replyToEntries = Array.isArray(replyTo) ? replyTo.filter(Boolean).map((address)=>({\n            emailAddress: {\n                address\n            }\n        })) : replyTo ? [\n        {\n            emailAdress: {\n                address: replyTo\n            }\n        }\n    ] : undefined;\n    const principalPath = buildPrincipalPath(fromCalendarId);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/sendMail`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            message: {\n                ...from ? {\n                    from: {\n                        emailAddress: {\n                            address: from\n                        }\n                    }\n                } : {},\n                subject,\n                body: {\n                    contentType,\n                    content: body\n                },\n                toRecipients: recipients,\n                ...replyToEntriews ? {\n                    replyTo: replyToEntries\n                } : {}\n            },\n            saveToSentItems: false\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph send mail error: ${response.status} ${error}`);\n    }\n};\nmodule.exports = {\n    createEvent,\n    getSchedule,\n    sendMail\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUMsT0FBTyxFQUFFUixZQUFZLENBQUM7WUFDdEMsZ0JBQWdCO1FBQ2xCO1FBQ0FTLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztZQUNuQjhELFNBQVM7Z0JBQ1AsR0FBSU4sT0FBTztvQkFBRUEsTUFBTTt3QkFBRVQsY0FBYzs0QkFBRVAsU0FBU2dCO3dCQUFLO29CQUFFO2dCQUFFLElBQUksQ0FBQyxDQUFDO2dCQUM3RHpCO2dCQUNBakMsTUFBTTtvQkFDSm1EO29CQUNBQyxTQUFTcEQ7Z0JBQ1g7Z0JBQ0FpRSxjQUFjTDtnQkFDZCxHQUFJTSxrQkFBa0I7b0JBQUVQLFNBQVNHO2dCQUFlLElBQUksQ0FBQyxDQUFDO1lBQ3hEO1lBQ0FLLGlCQUFpQjtRQUNuQjtJQUNGO0lBRUEsSUFBSSxDQUFDeEUsU0FBU1csRUFBRSxFQUFFO1FBQ2hCLE1BQU1DLFFBQVEsTUFBTVosU0FBU2EsSUFBSTtRQUNqQyxNQUFNLElBQUlDLE1BQU0sQ0FBQyx1QkFBdUIsRUFBRWQsU0FBU2UsTUFBTSxDQUFDLENBQUMsRUFBRUgsTUFBTSxDQUFDO0lBQ3RFO0FBQ0Y7QUFFQTZELE9BQU9DLE9BQU8sR0FBRztJQUFFckM7SUFBYXBCO0lBQWEyQztBQUFTIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL2FwaS9fbGliL2dyYXBoLmpzPzY4ZDAiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgR1JBUEhfQkFTRSA9IFwiaHR0cHM6Ly9ncmFwaC5taWNyb3NvZnQuY29tL3YxLjBcIjtcclxuXHJcbmNvbnN0IE1BWF9HUkFQSF9XSU5ET1dfREFZUyA9IDYyO1xyXG5cclxuY29uc3QgbWFwQnVzeUludGVydmFscyA9IChpdGVtcykgPT5cclxuICBpdGVtcy5tYXAoKGl0ZW0pID0+ICh7XHJcbiAgICBzdGFydDogbmV3IERhdGUoaXRlbS5zdGFydC5kYXRlVGltZSksXHJcbiAgICBlbmQ6IG5ldyBEYXRlKGl0ZW0uZW5kLmRhdGVUaW1lKSxcclxuICB9KSk7XHJcblxyXG5jb25zdCBvdmVybGFwcyA9IChzdGFydCwgZW5kLCBidXN5KSA9PiB7XHJcbiAgcmV0dXJuIGJ1c3kuc29tZSgoaW50ZXJ2YWwpID0+IHN0YXJ0IDwgaW50ZXJ2YWwuZW5kICYmIGVuZCA+IGludGVydmFsLnN0YXJ0KTtcclxufTtcclxuXHJcbmNvbnN0IGJ1aWxkU2xvdHMgPSAoc3RhcnREYXRlLCBkYXlzLCBpbnRlcnZhbE1pbnV0ZXMsIGJ1c3kpID0+IHtcclxuICBjb25zdCBzbG90c0J5RGF0ZSA9IHt9O1xyXG4gIGNvbnN0IHdvcmtpbmdEYXlTdGFydCA9IDk7XHJcbiAgY29uc3Qgd29ya2luZ0RheUVuZCA9IDE3O1xyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IGRheXM7IGkgKz0gMSkge1xyXG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHN0YXJ0RGF0ZSk7XHJcbiAgICBkYXRlLnNldERhdGUoZGF0ZS5nZXREYXRlKCkgKyBpKTtcclxuXHJcbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IGRhdGUudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7XHJcbiAgICBzbG90c0J5RGF0ZVtjdXJyZW50RGF0ZV0gPSBbXTtcclxuXHJcbiAgICBmb3IgKGxldCBob3VyID0gd29ya2luZ0RheVN0YXJ0OyBob3VyIDw9IHdvcmtpbmdEYXlFbmQ7IGhvdXIgKz0gMSkge1xyXG4gICAgICBmb3IgKGxldCBtaW51dGUgPSAwOyBtaW51dGUgPCA2MDsgbWludXRlICs9IGludGVydmFsTWludXRlcykge1xyXG4gICAgICAgIGNvbnN0IHNsb3RTdGFydCA9IG5ldyBEYXRlKGRhdGUpO1xyXG4gICAgICAgIHNsb3RTdGFydC5zZXRVVENIb3Vycyhob3VyLCBtaW51dGUsIDAsIDApO1xyXG4gICAgICAgIGNvbnN0IHNsb3RFbmQgPSBuZXcgRGF0ZShzbG90U3RhcnQpO1xyXG4gICAgICAgIHNsb3RFbmQuc2V0TWludXRlcyhzbG90RW5kLmdldE1pbnV0ZXMoKSArIGludGVydmFsTWludXRlcyk7XHJcbiAgICAgICAgY29uc3QgdGltZSA9IHNsb3RTdGFydC50b0lTT1N0cmluZygpLnNsaWNlKDExLCAxNik7XHJcblxyXG4gICAgICAgIGNvbnN0IGF2YWlsYWJsZSA9ICFvdmVybGFwcyhzbG90U3RhcnQsIHNsb3RFbmQsIGJ1c3kpO1xyXG4gICAgICAgIHNsb3RzQnlEYXRlW2N1cnJlbnREYXRlXS5wdXNoKHsgdGltZSwgYXZhaWxhYmxlIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gc2xvdHNCeURhdGU7XHJcbn07XHJcblxyXG5jb25zdCBidWlsZFByaW5jaXBhbFBhdGggPSAoY2FsZW5kYXJJZCkgPT5cclxuICBjYWxlbmRhcklkID8gYC91c2Vycy8ke2VuY29kZVVSSUNvbXBvbmVudChjYWxlbmRhcklkKX1gIDogXCIvbWVcIjtcclxuXHJcbmNvbnN0IHBvc3RTY2hlZHVsZVJlcXVlc3QgPSBhc3luYyAoe1xyXG4gIGFjY2Vzc1Rva2VuLFxyXG4gIGNhbGVuZGFySWQsXHJcbiAgc3RhcnRUaW1lLFxyXG4gIGVuZFRpbWUsXHJcbn0pID0+IHtcclxuICBjb25zdCBwcmluY2lwYWxQYXRoID0gYnVpbGRQcmluY2lwYWxQYXRoKGNhbGVuZGFySWQpO1xyXG5cclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0dSQVBIX0JBU0V9JHtwcmluY2lwYWxQYXRofS9jYWxlbmRhci9nZXRTY2hlZHVsZWAsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIHNjaGVkdWxlczogW2NhbGVuZGFySWQgfHwgXCJtZVwiXSxcclxuICAgICAgc3RhcnRUaW1lOiB7IGRhdGVUaW1lOiBzdGFydFRpbWUudG9JU09TdHJpbmcoKSwgdGltZVpvbmU6IFwiVVRDXCIgfSxcclxuICAgICAgZW5kVGltZTogeyBkYXRlVGltZTogZW5kVGltZS50b0lTT1N0cmluZygpLCB0aW1lWm9uZTogXCJVVENcIiB9LFxyXG4gICAgICBhdmFpbGFiaWxpdHlWaWV3SW50ZXJ2YWw6IDMwLFxyXG4gICAgfSksXHJcbiAgfSk7XHJcblxyXG4gIGlmICghcmVzcG9uc2Uub2spIHtcclxuICAgIGNvbnN0IGVycm9yID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKGBHcmFwaCBzY2hlZHVsZSBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7ZXJyb3J9YCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0U2NoZWR1bGUgPSBhc3luYyAoeyBhY2Nlc3NUb2tlbiwgY2FsZW5kYXJJZCwgd2luZG93RGF5cyA9IDcgfSkgPT4ge1xyXG4gIGNvbnN0IHRvdGFsRGF5cyA9IE1hdGgubWF4KHdpbmRvd0RheXMsIDEpO1xyXG4gIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgY29uc3QgYnVzeSA9IFtdO1xyXG4gIGxldCB0aW1lWm9uZSA9IFwiVVRDXCI7XHJcblxyXG4gIGZvciAobGV0IG9mZnNldCA9IDA7IG9mZnNldCA8IHRvdGFsRGF5czsgb2Zmc2V0ICs9IE1BWF9HUkFQSF9XSU5ET1dfREFZUykge1xyXG4gICAgY29uc3QgY2h1bmtTdGFydCA9IG5ldyBEYXRlKHN0YXJ0VGltZSk7XHJcbiAgICBjaHVua1N0YXJ0LnNldERhdGUoY2h1bmtTdGFydC5nZXREYXRlKCkgKyBvZmZzZXQpO1xyXG5cclxuICAgIGNvbnN0IGNodW5rRGF5cyA9IE1hdGgubWluKE1BWF9HUkFQSF9XSU5ET1dfREFZUywgdG90YWxEYXlzIC0gb2Zmc2V0KTtcclxuICAgIGNvbnN0IGNodW5rRW5kID0gbmV3IERhdGUoY2h1bmtTdGFydCk7XHJcbiAgICBjaHVua0VuZC5zZXREYXRlKGNodW5rRW5kLmdldERhdGUoKSArIGNodW5rRGF5cyk7XHJcblxyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHBvc3RTY2hlZHVsZVJlcXVlc3Qoe1xyXG4gICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgY2FsZW5kYXJJZCxcclxuICAgICAgc3RhcnRUaW1lOiBjaHVua1N0YXJ0LFxyXG4gICAgICBlbmRUaW1lOiBjaHVua0VuZCxcclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IHNjaGVkdWxlID0gZGF0YS52YWx1ZT8uWzBdO1xyXG4gICAgaWYgKHNjaGVkdWxlPy53b3JraW5nSG91cnM/LnRpbWVab25lPy5uYW1lKSB7XHJcbiAgICAgIHRpbWVab25lID0gc2NoZWR1bGUud29ya2luZ0hvdXJzLnRpbWVab25lLm5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgYnVzeS5wdXNoKC4uLm1hcEJ1c3lJbnRlcnZhbHMoc2NoZWR1bGU/LnNjaGVkdWxlSXRlbXMgfHwgW10pKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHNsb3RzQnlEYXRlID0gYnVpbGRTbG90cyhzdGFydFRpbWUsIHRvdGFsRGF5cywgMzAsIGJ1c3kpO1xyXG4gIFxyXG4gIGNvbnN0IGRhdGVzID0gT2JqZWN0LmtleXMoc2xvdHNCeURhdGUpLm1hcCgoZGF0ZSkgPT4gKHtcclxuICAgIGRhdGUsXHJcbiAgICBzbG90czogc2xvdHNCeURhdGVbZGF0ZV0sXHJcbiAgfSkpO1xyXG5cclxuICByZXR1cm4geyB0aW1lWm9uZSwgZGF0ZXMgfTtcclxufTtcclxuXHJcbmNvbnN0IGNyZWF0ZUV2ZW50ID0gYXN5bmMgKHtcclxuICBhY2Nlc3NUb2tlbixcclxuICBjYWxlbmRhcklkLFxyXG4gIHN1YmplY3QsXHJcbiAgYm9keSxcclxuICBzdGFydCxcclxuICBib2R5Q29udGVudFR5cGUgPSBcIlRleHRcIixcclxuICBlbmQsXHJcbiAgYXR0ZW5kZWVFbWFpbCxcclxuICBhdHRlbmRlZUVtYWlscyA9IFtdLFxyXG4gIHRpbWVab25lID0gXCJVVENcIixcclxufSkgPT4ge1xyXG4gIGNvbnN0IHByaW5jaXBhbFBhdGggPSBidWlsZFByaW5jaXBhbFBhdGgoY2FsZW5kYXJJZCk7XHJcblxyXG4gIGNvbnN0IGF0dGVuZGVlcyA9IFtcclxuICAgIC4uLihBcnJheS5pc0FycmF5KGF0dGVuZGVlRW1haWxzKSA/IGF0dGVuZGVlRW1haWxzIDogW10pLFxyXG4gICAgYXR0ZW5kZWVFbWFpbCxcclxuICBdXHJcbiAgICAuZmlsdGVyKEJvb2xlYW4pXHJcbiAgICAubWFwKChhZGRyZXNzKSA9PiBhZGRyZXNzLnRyaW0oKSlcclxuICAgIC5maWx0ZXIoQm9vbGVhbilcclxuICAgIC5yZWR1Y2UoKGxpc3QsIGFkZHJlc3MpID0+IHtcclxuICAgICAgY29uc3Qga2V5ID0gYWRkcmVzcy50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICBpZiAobGlzdC5zb21lKChhdHRlbmRlZSkgPT4gYXR0ZW5kZWUuZW1haWxBZGRyZXNzLmFkZHJlc3MudG9Mb3dlckNhc2UoKSA9PT0ga2V5KSkge1xyXG4gICAgICAgIHJldHVybiBsaXN0O1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBbXHJcbiAgICAgICAgLi4ubGlzdCxcclxuICAgICAgICB7XHJcbiAgICAgICAgICBlbWFpbEFkZHJlc3M6IHsgYWRkcmVzcyB9LFxyXG4gICAgICAgICAgdHlwZTogXCJyZXF1aXJlZFwiLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIF07XHJcbiAgICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7R1JBUEhfQkFTRX0ke3ByaW5jaXBhbFBhdGh9L2V2ZW50c2AsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthY2Nlc3NUb2tlbn1gLFxyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIHN1YmplY3QsXHJcbiAgICAgIGJvZHk6IHtcclxuICAgICAgICBjb250ZW50VHlwZTogYm9keUNvbnRlbnRUeXBlLFxyXG4gICAgICAgIGNvbnRlbnQ6IGJvZHksXHJcbiAgICAgIH0sXHJcbiAgICAgIHN0YXJ0OiB7IGRhdGVUaW1lOiBzdGFydCwgdGltZVpvbmUgfSxcclxuICAgICAgZW5kOiB7IGRhdGVUaW1lOiBlbmQsIHRpbWVab25lIH0sXHJcbiAgICAgIGF0dGVuZGVlcyxcclxuICAgICAgaXNSZW1pbmRlck9uOiB0cnVlLFxyXG4gICAgICByZW1pbmRlck1pbnV0ZXNCZWZvcmVTdGFydDogMTUsXHJcbiAgICB9KSxcclxuICB9KTtcclxuXHJcbiAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEdyYXBoIGNyZWF0ZSBldmVudCBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7ZXJyb3J9YCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuY29uc3Qgc2VuZE1haWwgPSBhc3luYyAoe1xyXG4gIGFjY2Vzc1Rva2VuLFxyXG4gIGZyb21DYWxlbmRhcklkLFxyXG4gIHRvLFxyXG4gIHN1YmplY3QsXHJcbiAgYm9keSxcclxuICBjb250ZW50VHlwZSA9IFwiSFRNTFwiLFxyXG4gIGZyb20sXHJcbiAgcmVwbHlUbyxcclxufSkgPT4ge1xyXG4gIGlmICghdG8pIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcInNlbmRNYWlsIGNhbGxlZCB3aXRob3V0IHJlY2lwaWVudCBlbWFpbCBhZGRyZXNzXCIpO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVjaXBpZW50cyA9IEFycmF5LmlzQXJyYXkodG8pXHJcbiAgICA/IHRvLmZpbHRlcihCb29sZWFuKS5tYXAoKGFkZHJlc3MpID0+ICh7XHJcbiAgICAgIGVtYWlsQWRyZXNzOiB7IGFkZHJlc3MgfSxcclxuICAgIH0pKVxyXG4gICAgOiBbe1xyXG4gICAgICBlbWFpbEFkZHJlc3M6IHtcclxuICAgICAgICBhZGRyZXNzOiB0byxcclxuICAgICAgfSxcclxuICAgIH1dO1xyXG5cclxuICBjb25zdCByZXBseVRvRW50cmllcyA9IEFycmF5LmlzQXJyYXkocmVwbHlUbylcclxuICAgID8gcmVwbHlUby5maWx0ZXIoQm9vbGVhbikubWFwKChhZGRyZXNzKSA9PiAoe1xyXG4gICAgICBlbWFpbEFkZHJlc3M6IHsgYWRkcmVzcyB9LFxyXG4gICAgfSkpXHJcbiAgICA6IHJlcGx5VG9cclxuICAgID8gW3sgZW1haWxBZHJlc3M6IHsgYWRkcmVzczogcmVwbHlUbyB9IH1dXHJcbiAgICA6IHVuZGVmaW5lZDtcclxuXHJcbiAgY29uc3QgcHJpbmNpcGFsUGF0aCA9IGJ1aWxkUHJpbmNpcGFsUGF0aChmcm9tQ2FsZW5kYXJJZCk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7R1JBUEhfQkFTRX0ke3ByaW5jaXBhbFBhdGh9L3NlbmRNYWlsYCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAsXHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbWVzc2FnZToge1xyXG4gICAgICAgIC4uLihmcm9tID8geyBmcm9tOiB7IGVtYWlsQWRkcmVzczogeyBhZGRyZXNzOiBmcm9tIH0gfSB9IDoge30pLFxyXG4gICAgICAgIHN1YmplY3QsXHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgY29udGVudFR5cGUsXHJcbiAgICAgICAgICBjb250ZW50OiBib2R5LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG9SZWNpcGllbnRzOiByZWNpcGllbnRzLFxyXG4gICAgICAgIC4uLihyZXBseVRvRW50cmlld3MgPyB7IHJlcGx5VG86IHJlcGx5VG9FbnRyaWVzIH0gOiB7fSksXHJcbiAgICAgIH0sXHJcbiAgICAgIHNhdmVUb1NlbnRJdGVtczogZmFsc2UsXHJcbiAgICB9KSxcclxuICB9KTtcclxuXHJcbiAgaWYgKCFyZXNwb25zZS5vaykge1xyXG4gICAgY29uc3QgZXJyb3IgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEdyYXBoIHNlbmQgbWFpbCBlcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7ZXJyb3J9YCk7XHJcbiAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7IGNyZWF0ZUV2ZW50LCBnZXRTY2hlZHVsZSwgc2VuZE1haWwgfTsiXSwibmFtZXMiOlsiR1JBUEhfQkFTRSIsIk1BWF9HUkFQSF9XSU5ET1dfREFZUyIsIm1hcEJ1c3lJbnRlcnZhbHMiLCJpdGVtcyIsIm1hcCIsIml0ZW0iLCJzdGFydCIsIkRhdGUiLCJkYXRlVGltZSIsImVuZCIsIm92ZXJsYXBzIiwiYnVzeSIsInNvbWUiLCJpbnRlcnZhbCIsImJ1aWxkU2xvdHMiLCJzdGFydERhdGUiLCJkYXlzIiwiaW50ZXJ2YWxNaW51dGVzIiwic2xvdHNCeURhdGUiLCJ3b3JraW5nRGF5U3RhcnQiLCJ3b3JraW5nRGF5RW5kIiwiaSIsImRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImN1cnJlbnREYXRlIiwidG9JU09TdHJpbmciLCJzbGljZSIsImhvdXIiLCJtaW51dGUiLCJzbG90U3RhcnQiLCJzZXRVVENIb3VycyIsInNsb3RFbmQiLCJzZXRNaW51dGVzIiwiZ2V0TWludXRlcyIsInRpbWUiLCJhdmFpbGFibGUiLCJwdXNoIiwiYnVpbGRQcmluY2lwYWxQYXRoIiwiY2FsZW5kYXJJZCIsImVuY29kZVVSSUNvbXBvbmVudCIsInBvc3RTY2hlZHVsZVJlcXVlc3QiLCJhY2Nlc3NUb2tlbiIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJwcmluY2lwYWxQYXRoIiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzY2hlZHVsZXMiLCJ0aW1lWm9uZSIsImF2YWlsYWJpbGl0eVZpZXdJbnRlcnZhbCIsIm9rIiwiZXJyb3IiLCJ0ZXh0IiwiRXJyb3IiLCJzdGF0dXMiLCJqc29uIiwiZ2V0U2NoZWR1bGUiLCJ3aW5kb3dEYXlzIiwidG90YWxEYXlzIiwiTWF0aCIsIm1heCIsIm9mZnNldCIsImNodW5rU3RhcnQiLCJjaHVua0RheXMiLCJtaW4iLCJjaHVua0VuZCIsImRhdGEiLCJzY2hlZHVsZSIsInZhbHVlIiwid29ya2luZ0hvdXJzIiwibmFtZSIsInNjaGVkdWxlSXRlbXMiLCJkYXRlcyIsIk9iamVjdCIsImtleXMiLCJzbG90cyIsImNyZWF0ZUV2ZW50Iiwic3ViamVjdCIsImJvZHlDb250ZW50VHlwZSIsImF0dGVuZGVlRW1haWwiLCJhdHRlbmRlZUVtYWlscyIsImF0dGVuZGVlcyIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlciIsIkJvb2xlYW4iLCJhZGRyZXNzIiwidHJpbSIsInJlZHVjZSIsImxpc3QiLCJrZXkiLCJ0b0xvd2VyQ2FzZSIsImF0dGVuZGVlIiwiZW1haWxBZGRyZXNzIiwidHlwZSIsImNvbnRlbnRUeXBlIiwiY29udGVudCIsImlzUmVtaW5kZXJPbiIsInJlbWluZGVyTWludXRlc0JlZm9yZVN0YXJ0Iiwic2VuZE1haWwiLCJmcm9tQ2FsZW5kYXJJZCIsInRvIiwiZnJvbSIsInJlcGx5VG8iLCJyZWNpcGllbnRzIiwiZW1haWxBZHJlc3MiLCJyZXBseVRvRW50cmllcyIsInVuZGVmaW5lZCIsIm1lc3NhZ2UiLCJ0b1JlY2lwaWVudHMiLCJyZXBseVRvRW50cmlld3MiLCJzYXZlVG9TZW50SXRlbXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./api/_lib/graph.js\n");

/***/ }),

/***/ "(api)/./api/book.js":
/*!*********************!*\
  !*** ./api/book.js ***!
  \*********************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { DateTime } = __webpack_require__(/*! luxon */ \"luxon\");\nconst { getAppOnlyAccessToken } = __webpack_require__(/*! ./_lib/auth */ \"(api)/./api/_lib/auth.js\");\nconst { createEvent, sendMail } = __webpack_require__(/*! ./_lib/graph */ \"(api)/./api/_lib/graph.js\");\nconst parseBody = async (req)=>{\n    const chunks = [];\n    for await (const chunk of req){\n        chunks.push(chunk);\n    }\n    const body = Buffer.concat(chunks).toString(\"utf8\");\n    return body ? JSON.parse(body) : {};\n};\nconst addMinutesToDateTime = (date, time, minutes)=>{\n    const start = new Date(`${date}T${time}:00Z`);\n    start.setUTCMinutes(start.getUTCMinutes() + minutes);\n    return start.toISOString().slice(0, 19);\n};\nconst escapeHtml = (value = \"\")=>String(value).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\");\nconst buildFriendlyTiming = ({ date, time, durationMinutes, timeZone = \"UTC\" })=>{\n    const zone = timeZone || \"UTC\";\n    const start = DateTime.fromISO(`${date}T${time}`, {\n        zone\n    });\n    const safeStart = start.isValid ? start : DateTime.fromISO(`${date}T${time}`, {\n        zone: \"UTC\"\n    });\n    const end = safeStart.plus({\n        minutes: durationMinutes\n    });\n    const format = \"cccc, LLLL d, yyyy 'at' t ZZZZ\";\n    return {\n        start: safeStart.toFormat(format),\n        end: end.toFormat(format)\n    };\n};\nconst buildConfirmationBody = ({ clientName, serviceId, serviceTitle, timing, notes, dogs, dogCount, timeZone })=>{\n    const readableService = serviceTitle || `Training booking (${serviceId || \"custom\"})`;\n    const dogEntries = Array.isArray(dogs) ? dogs : [];\n    const hasDogs = dogEntries.length > 0;\n    const dogDetails = hasDogs ? `<ol style=\"margin: 0; padding-left: 20px;\">\r\n        ${dogEntries.map((dog, index)=>{\n        const name = escapeHtml(dog?.name || \"Name pending\");\n        const breed = escapeHtml(dog?.breed || \"Breed pending\");\n        const photoName = escapeHtml(dog?.photoName || \"Uploaded photo\");\n        const hasPhoto = Boolean(dog?.photoDataUrl);\n        return `<li><strong>Dog ${index + 1}:</strong> ${name} (${breed})${hasPhoto ? `  Photo: ${photoName}` : \"\"}</li>`;\n    }).join(\"\")}\r\n      </ol>` : `<p style=\"margin: 8px 0 0;\"><strong>Dogs:</strong> ${dogCount ?? dogEntries.length ?? 0} (details pending)</p>`;\n    const notesBlock = notes ? `<p style=\"margin: 16px 0 0;\"><strong>Notes from you:</strong><br>${escapeHtml(notes)}</p>` : \"\";\n    return `\r\n    <div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #111;\">\r\n      <p style=\"margin: 0 0 12px;\">Hi ${escapeHtml(clientName || \"there\")},</p>\r\n      <p style=\"margin: 0 0 12px;\">\r\n        Thank you for booking <strong>${escapeHtml(readableService)}</strong>. Here are your appointment details:\r\n      </p>\r\n      <ul style=\"padding-left: 20px; margin: 0 0 12px;\">\r\n        <li><strong>Starts:</strong> ${escapeHtml(timing.start)}</li>\r\n        <li><strong>Ends:</strong> ${escapeHtml(timing.end)}</li>\r\n        <li><strong>Time zone:</strong> ${escapeHtml(timeZone || \"UTC\")}</li>\r\n      </ul>\r\n      ${dogDetails}\r\n      ${notesBlock}\r\n      <p style=\"margin: 16px 0 0;\">\r\n        If you need to reschedule or have questions, just reply to this email and we'll be happy to help.\r\n      </p>\r\n      <p style=\"margin: 8px 0 0;\">Looking forward to seeing you soon!</p>\r\n    </div>\r\n  `;\n};\nconst buildNotificationBody = ({ serviceTitle, serviceId, clientName, clientEmail, timing, timeZone, notes, dogs, dogCount })=>{\n    const readableService = serviceTitle || `Training booking (${serviceId || \"custom\"})`;\n    const dogEntries = Array.isArray(dogs) ? dogs : [];\n    const hasDogs = dogEntries.length > 0;\n    const dogDetails = hasDogs ? `<ol style=\"margin: 0; padding-left: 20px;\">\r\n        ${dogEntries.map((dog, index)=>{\n        const name = escapeHtml(dog?.name || \"Name pending\");\n        const breed = escapeHtml(dog?.breed || \"Breed pending\");\n        const hasPhoto = Boolean(dog?.photoDataUrl);\n        return `<li><strong>Dog ${index + 1}:</strong> ${name} (${breed})${hasPhoto ? \"  photo uploaded\" : \"\"}</li>`;\n    }).join(\"\")}\r\n      </ol>` : `<p style=\"margin: 8px 0 0;\"><strong>Dogs:</strong> ${dogCount ?? dogEntries.length ?? 0} (details pending)</p>`;\n    const notesBlock = notes ? `<p style=\"margin: 16px 0 0;\"><strong>Client notes:</strong><br>${escapeHtml(notes)}</p>` : \"\";\n    const clientLine = clientName || clientEmail ? `${escapeHtml(clientName || \"Client\")} (${escapeHtml(clientEmail || \"email missing\")})` : \"Unknown client\";\n    return `\r\n    <div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #111;\">\r\n      <p style=\"margin: 0 0 12px;\">New booking received:</p>\r\n      <ul style=\"padding-left: 20px; margin: 0 0 12px;\">\r\n        <li><strong>Client:</strong> ${clientLine}</li>\r\n        <li><strong>Service:</strong> ${escapeHtml(readableService)}</li>\r\n        <li><strong>Starts:</strong> ${escapeHtml(timing.start)}</li>\r\n        <li><strong>Ends:</strong> ${escapeHtml(timing.end)}</li>\r\n        <li><strong>Time zone:</strong> ${escapeHtml(timeZone || \"UTC\")}</li>\r\n      </ul>\r\n      ${dogDetails}\r\n      ${notesBlock}\r\n      <p style=\"margin: 16px 0 0;\">This is an internal notification for Jeroen & Paws.</p>\r\n    </div>\r\n  `;\n};\nmodule.exports = async (req, res)=>{\n    if (req.method !== \"POST\") {\n        res.statusCode = 405;\n        res.setHeader(\"Allow\", \"POST\");\n        res.end(\"Method Not Allowed\");\n        return;\n    }\n    try {\n        const calendarId = process.env.OUTLOOK_CALENDAR_ID;\n        if (!calendarId) {\n            throw new Error(\"Missing OUTLOOK_CALENDAR_ID env var\");\n        }\n        const accessToken = await getAppOnlyAccessToken();\n        const body = await parseBody(req);\n        const { date, time, durationMinutes = 60, serviceId, serviceTitle, clientName, clientEmail, notes, timeZone = \"UTC\", dogs = [], dogCount } = body;\n        const teamEmail = process.env.BOOKING_NOTIFICATION_EMAIL || process.env.NOTIFY_EMAIL || process.env.JEROEN_AND_PAWS_EMAIL;\n        const bookingFromEmail = process.env.BOOKING_SENDER_EMAIL || \"booking@jeroenandpaws.com\";\n        const ownerNotificationEmail = \"jeroen@jeroenandpaws.com\";\n        if (!date || !time) {\n            res.statusCode = 400;\n            res.end(JSON.stringify({\n                message: \"Missing date or time\"\n            }));\n            return;\n        }\n        const startDateTime = `${date}T${time}:00`;\n        const endDateTime = addMinutesToDateTime(date, time, durationMinutes);\n        const subject = serviceTitle || `Training booking (${serviceId || \"custom\"})`;\n        const timing = buildFriendlyTiming({\n            date,\n            time,\n            durationMinutes,\n            timeZone\n        });\n        const confirmationBody = buildConfirmationBody({\n            clientName,\n            serviceId,\n            serviceTitle,\n            timing,\n            notes,\n            dogs,\n            dogCount,\n            timeZone\n        });\n        const event = await createEvent({\n            accessToken,\n            calendarId,\n            subject,\n            body: confirmationBody,\n            bodyContentType: \"HTML\",\n            start: startDateTime,\n            end: endDateTime,\n            attendeeEmail: clientEmail,\n            attendeeEmails: [],\n            timeZone\n        });\n        const notificationBody = buildNotificationBody({\n            serviceTitle,\n            serviceId,\n            clientName,\n            clientEmail,\n            timing,\n            timeZone,\n            notes,\n            dogs,\n            dogCount\n        });\n        const notificationRecipients = [\n            teamEmail,\n            ownerNotificationEmail\n        ].filter(Boolean);\n        if (notificationRecipients.length) {\n            await sendMail({\n                accessToken,\n                fromCalendarId: calendarId,\n                to: notificationRecipients,\n                subject: `New booking: ${subject}`,\n                body: notificationBody,\n                contentType: \"HTML\",\n                from: bookingFromEmail,\n                replyTo: bookingFromEmail\n            });\n        }\n        await sendMail({\n            accessToken,\n            fromCalendarId: calendarId,\n            to: clientEmail,\n            subject,\n            body: confirmationBody,\n            contentType: \"HTML\",\n            from: bookingFromEmail,\n            replyTo: bookingFromEmail\n        });\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify({\n            id: event.id,\n            webLink: event.webLink,\n            subject,\n            start: event.start,\n            end: event.end\n        }));\n    } catch (error) {\n        console.error(\"Booking error\", error);\n        res.statusCode = 500;\n        res.end(JSON.stringify({\n            message: \"Failed to book event\"\n        }));\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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bnRlbnQiOlsiY29uc3QgeyBEYXRlVGltZSB9ID0gcmVxdWlyZShcImx1eG9uXCIpO1xyXG5jb25zdCB7IGdldEFwcE9ubHlBY2Nlc3NUb2tlbiB9ID0gcmVxdWlyZShcIi4vX2xpYi9hdXRoXCIpO1xyXG5jb25zdCB7IGNyZWF0ZUV2ZW50LCBzZW5kTWFpbCB9ID0gcmVxdWlyZShcIi4vX2xpYi9ncmFwaFwiKTtcclxuXHJcbmNvbnN0IHBhcnNlQm9keSA9IGFzeW5jIChyZXEpID0+IHtcclxuICBjb25zdCBjaHVua3MgPSBbXTtcclxuICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlcSkge1xyXG4gICAgY2h1bmtzLnB1c2goY2h1bmspO1xyXG4gIH1cclxuICBjb25zdCBib2R5ID0gQnVmZmVyLmNvbmNhdChjaHVua3MpLnRvU3RyaW5nKFwidXRmOFwiKTtcclxuICByZXR1cm4gYm9keSA/IEpTT04ucGFyc2UoYm9keSkgOiB7fTtcclxufTtcclxuXHJcbmNvbnN0IGFkZE1pbnV0ZXNUb0RhdGVUaW1lID0gKGRhdGUsIHRpbWUsIG1pbnV0ZXMpID0+IHtcclxuICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKGAke2RhdGV9VCR7dGltZX06MDBaYCk7XHJcbiAgc3RhcnQuc2V0VVRDTWludXRlcyhzdGFydC5nZXRVVENNaW51dGVzKCkgKyBtaW51dGVzKTtcclxuICByZXR1cm4gc3RhcnQudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxOSk7XHJcbn07XHJcblxyXG5jb25zdCBlc2NhcGVIdG1sID0gKHZhbHVlID0gXCJcIikgPT5cclxuICBTdHJpbmcodmFsdWUpXHJcbiAgICAucmVwbGFjZSgvJi9nLCBcIiZhbXA7XCIpXHJcbiAgICAucmVwbGFjZSgvPC9nLCBcIiZsdDtcIilcclxuICAgIC5yZXBsYWNlKC8+L2csIFwiJmd0O1wiKVxyXG4gICAgLnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpXHJcbiAgICAucmVwbGFjZSgvJy9nLCBcIiYjMzk7XCIpO1xyXG5cclxuY29uc3QgYnVpbGRGcmllbmRseVRpbWluZyA9ICh7IGRhdGUsIHRpbWUsIGR1cmF0aW9uTWludXRlcywgdGltZVpvbmUgPSBcIlVUQ1wiIH0pID0+IHtcclxuICBjb25zdCB6b25lID0gdGltZVpvbmUgfHwgXCJVVENcIjtcclxuICBjb25zdCBzdGFydCA9IERhdGVUaW1lLmZyb21JU08oYCR7ZGF0ZX1UJHt0aW1lfWAsIHsgem9uZSB9KTtcclxuICBjb25zdCBzYWZlU3RhcnQgPSBzdGFydC5pc1ZhbGlkXHJcbiAgICA/IHN0YXJ0XHJcbiAgICA6IERhdGVUaW1lLmZyb21JU08oYCR7ZGF0ZX1UJHt0aW1lfWAsIHsgem9uZTogXCJVVENcIiB9KTtcclxuXHJcbiAgY29uc3QgZW5kID0gc2FmZVN0YXJ0LnBsdXMoeyBtaW51dGVzOiBkdXJhdGlvbk1pbnV0ZXMgfSk7XHJcbiAgY29uc3QgZm9ybWF0ID0gXCJjY2NjLCBMTExMIGQsIHl5eXkgJ2F0JyB0IFpaWlpcIjtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHN0YXJ0OiBzYWZlU3RhcnQudG9Gb3JtYXQoZm9ybWF0KSxcclxuICAgIGVuZDogZW5kLnRvRm9ybWF0KGZvcm1hdCksXHJcbiAgfTtcclxufTtcclxuXHJcbmNvbnN0IGJ1aWxkQ29uZmlybWF0aW9uQm9keSA9ICh7XHJcbiAgY2xpZW50TmFtZSxcclxuICBzZXJ2aWNlSWQsXHJcbiAgc2VydmljZVRpdGxlLFxyXG4gIHRpbWluZyxcclxuICBub3RlcyxcclxuICBkb2dzLFxyXG4gIGRvZ0NvdW50LFxyXG4gIHRpbWVab25lLFxyXG59KSA9PiB7XHJcbiAgY29uc3QgcmVhZGFibGVTZXJ2aWNlID0gc2VydmljZVRpdGxlIHx8IGBUcmFpbmluZyBib29raW5nICgke3NlcnZpY2VJZCB8fCBcImN1c3RvbVwifSlgO1xyXG4gIGNvbnN0IGRvZ0VudHJpZXMgPSBBcnJheS5pc0FycmF5KGRvZ3MpID8gZG9ncyA6IFtdO1xyXG4gIGNvbnN0IGhhc0RvZ3MgPSBkb2dFbnRyaWVzLmxlbmd0aCA+IDA7XHJcblxyXG4gIGNvbnN0IGRvZ0RldGFpbHMgPSBoYXNEb2dzXHJcbiAgICA/IGA8b2wgc3R5bGU9XCJtYXJnaW46IDA7IHBhZGRpbmctbGVmdDogMjBweDtcIj5cclxuICAgICAgICAke2RvZ0VudHJpZXNcclxuICAgICAgICAgIC5tYXAoKGRvZywgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGVzY2FwZUh0bWwoZG9nPy5uYW1lIHx8IFwiTmFtZSBwZW5kaW5nXCIpO1xyXG4gICAgICAgICAgICBjb25zdCBicmVlZCA9IGVzY2FwZUh0bWwoZG9nPy5icmVlZCB8fCBcIkJyZWVkIHBlbmRpbmdcIik7XHJcbiAgICAgICAgICAgIGNvbnN0IHBob3RvTmFtZSA9IGVzY2FwZUh0bWwoZG9nPy5waG90b05hbWUgfHwgXCJVcGxvYWRlZCBwaG90b1wiKTtcclxuICAgICAgICAgICAgY29uc3QgaGFzUGhvdG8gPSBCb29sZWFuKGRvZz8ucGhvdG9EYXRhVXJsKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBgPGxpPjxzdHJvbmc+RG9nICR7aW5kZXggKyAxfTo8L3N0cm9uZz4gJHtuYW1lfSAoJHticmVlZH0pJHtcclxuICAgICAgICAgICAgICBoYXNQaG90byA/IGAg4oCUIFBob3RvOiAke3Bob3RvTmFtZX1gIDogXCJcIlxyXG4gICAgICAgICAgICB9PC9saT5gO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIC5qb2luKFwiXCIpfVxyXG4gICAgICA8L29sPmBcclxuICAgIDogYDxwIHN0eWxlPVwibWFyZ2luOiA4cHggMCAwO1wiPjxzdHJvbmc+RG9nczo8L3N0cm9uZz4gJHtcclxuICAgICAgICBkb2dDb3VudCA/PyBkb2dFbnRyaWVzLmxlbmd0aCA/PyAwXHJcbiAgICAgIH0gKGRldGFpbHMgcGVuZGluZyk8L3A+YDtcclxuXHJcbiAgY29uc3Qgbm90ZXNCbG9jayA9IG5vdGVzXHJcbiAgICA/IGA8cCBzdHlsZT1cIm1hcmdpbjogMTZweCAwIDA7XCI+PHN0cm9uZz5Ob3RlcyBmcm9tIHlvdTo8L3N0cm9uZz48YnI+JHtlc2NhcGVIdG1sKFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgICl9PC9wPmBcclxuICAgIDogXCJcIjtcclxuXHJcbiAgcmV0dXJuIGBcclxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IGxpbmUtaGVpZ2h0OiAxLjY7IGNvbG9yOiAjMTExO1wiPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDEycHg7XCI+SGkgJHtlc2NhcGVIdG1sKGNsaWVudE5hbWUgfHwgXCJ0aGVyZVwiKX0sPC9wPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDEycHg7XCI+XHJcbiAgICAgICAgVGhhbmsgeW91IGZvciBib29raW5nIDxzdHJvbmc+JHtlc2NhcGVIdG1sKHJlYWRhYmxlU2VydmljZSl9PC9zdHJvbmc+LiBIZXJlIGFyZSB5b3VyIGFwcG9pbnRtZW50IGRldGFpbHM6XHJcbiAgICAgIDwvcD5cclxuICAgICAgPHVsIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAyMHB4OyBtYXJnaW46IDAgMCAxMnB4O1wiPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPlN0YXJ0czo8L3N0cm9uZz4gJHtlc2NhcGVIdG1sKHRpbWluZy5zdGFydCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5FbmRzOjwvc3Ryb25nPiAke2VzY2FwZUh0bWwodGltaW5nLmVuZCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5UaW1lIHpvbmU6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbCh0aW1lWm9uZSB8fCBcIlVUQ1wiKX08L2xpPlxyXG4gICAgICA8L3VsPlxyXG4gICAgICAke2RvZ0RldGFpbHN9XHJcbiAgICAgICR7bm90ZXNCbG9ja31cclxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDE2cHggMCAwO1wiPlxyXG4gICAgICAgIElmIHlvdSBuZWVkIHRvIHJlc2NoZWR1bGUgb3IgaGF2ZSBxdWVzdGlvbnMsIGp1c3QgcmVwbHkgdG8gdGhpcyBlbWFpbCBhbmQgd2UnbGwgYmUgaGFwcHkgdG8gaGVscC5cclxuICAgICAgPC9wPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogOHB4IDAgMDtcIj5Mb29raW5nIGZvcndhcmQgdG8gc2VlaW5nIHlvdSBzb29uITwvcD5cclxuICAgIDwvZGl2PlxyXG4gIGA7XHJcbn07XHJcblxyXG5jb25zdCBidWlsZE5vdGlmaWNhdGlvbkJvZHkgPSAoe1xyXG4gIHNlcnZpY2VUaXRsZSxcclxuICBzZXJ2aWNlSWQsXHJcbiAgY2xpZW50TmFtZSxcclxuICBjbGllbnRFbWFpbCxcclxuICB0aW1pbmcsXHJcbiAgdGltZVpvbmUsXHJcbiAgbm90ZXMsXHJcbiAgZG9ncyxcclxuICBkb2dDb3VudCxcclxufSkgPT4ge1xyXG4gIGNvbnN0IHJlYWRhYmxlU2VydmljZSA9IHNlcnZpY2VUaXRsZSB8fCBgVHJhaW5pbmcgYm9va2luZyAoJHtzZXJ2aWNlSWQgfHwgXCJjdXN0b21cIn0pYDtcclxuICBjb25zdCBkb2dFbnRyaWVzID0gQXJyYXkuaXNBcnJheShkb2dzKSA/IGRvZ3MgOiBbXTtcclxuICBjb25zdCBoYXNEb2dzID0gZG9nRW50cmllcy5sZW5ndGggPiAwO1xyXG5cclxuICBjb25zdCBkb2dEZXRhaWxzID0gaGFzRG9nc1xyXG4gICAgPyBgPG9sIHN0eWxlPVwibWFyZ2luOiAwOyBwYWRkaW5nLWxlZnQ6IDIwcHg7XCI+XHJcbiAgICAgICAgJHtkb2dFbnRyaWVzXHJcbiAgICAgICAgICAubWFwKChkb2csIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBlc2NhcGVIdG1sKGRvZz8ubmFtZSB8fCBcIk5hbWUgcGVuZGluZ1wiKTtcclxuICAgICAgICAgICAgY29uc3QgYnJlZWQgPSBlc2NhcGVIdG1sKGRvZz8uYnJlZWQgfHwgXCJCcmVlZCBwZW5kaW5nXCIpO1xyXG4gICAgICAgICAgICBjb25zdCBoYXNQaG90byA9IEJvb2xlYW4oZG9nPy5waG90b0RhdGFVcmwpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGA8bGk+PHN0cm9uZz5Eb2cgJHtpbmRleCArIDF9Ojwvc3Ryb25nPiAke25hbWV9ICgke2JyZWVkfSkke1xyXG4gICAgICAgICAgICAgIGhhc1Bob3RvID8gXCIg4oCUIHBob3RvIHVwbG9hZGVkXCIgOiBcIlwiXHJcbiAgICAgICAgICAgIH08L2xpPmA7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmpvaW4oXCJcIil9XHJcbiAgICAgIDwvb2w+YFxyXG4gICAgOiBgPHAgc3R5bGU9XCJtYXJnaW46IDhweCAwIDA7XCI+PHN0cm9uZz5Eb2dzOjwvc3Ryb25nPiAke1xyXG4gICAgICAgIGRvZ0NvdW50ID8/IGRvZ0VudHJpZXMubGVuZ3RoID8/IDBcclxuICAgICAgfSAoZGV0YWlscyBwZW5kaW5nKTwvcD5gO1xyXG5cclxuICBjb25zdCBub3Rlc0Jsb2NrID0gbm90ZXNcclxuICAgID8gYDxwIHN0eWxlPVwibWFyZ2luOiAxNnB4IDAgMDtcIj48c3Ryb25nPkNsaWVudCBub3Rlczo8L3N0cm9uZz48YnI+JHtlc2NhcGVIdG1sKFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgICl9PC9wPmBcclxuICAgIDogXCJcIjtcclxuXHJcbiAgY29uc3QgY2xpZW50TGluZSA9XHJcbiAgICBjbGllbnROYW1lIHx8IGNsaWVudEVtYWlsXHJcbiAgICAgID8gYCR7ZXNjYXBlSHRtbChjbGllbnROYW1lIHx8IFwiQ2xpZW50XCIpfSAoJHtlc2NhcGVIdG1sKGNsaWVudEVtYWlsIHx8IFwiZW1haWwgbWlzc2luZ1wiKX0pYFxyXG4gICAgICA6IFwiVW5rbm93biBjbGllbnRcIjtcclxuXHJcbiAgcmV0dXJuIGBcclxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IGxpbmUtaGVpZ2h0OiAxLjY7IGNvbG9yOiAjMTExO1wiPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDEycHg7XCI+TmV3IGJvb2tpbmcgcmVjZWl2ZWQ6PC9wPlxyXG4gICAgICA8dWwgc3R5bGU9XCJwYWRkaW5nLWxlZnQ6IDIwcHg7IG1hcmdpbjogMCAwIDEycHg7XCI+XHJcbiAgICAgICAgPGxpPjxzdHJvbmc+Q2xpZW50Ojwvc3Ryb25nPiAke2NsaWVudExpbmV9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5TZXJ2aWNlOjwvc3Ryb25nPiAke2VzY2FwZUh0bWwocmVhZGFibGVTZXJ2aWNlKX08L2xpPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPlN0YXJ0czo8L3N0cm9uZz4gJHtlc2NhcGVIdG1sKHRpbWluZy5zdGFydCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5FbmRzOjwvc3Ryb25nPiAke2VzY2FwZUh0bWwodGltaW5nLmVuZCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5UaW1lIHpvbmU6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbCh0aW1lWm9uZSB8fCBcIlVUQ1wiKX08L2xpPlxyXG4gICAgICA8L3VsPlxyXG4gICAgICAke2RvZ0RldGFpbHN9XHJcbiAgICAgICR7bm90ZXNCbG9ja31cclxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDE2cHggMCAwO1wiPlRoaXMgaXMgYW4gaW50ZXJuYWwgbm90aWZpY2F0aW9uIGZvciBKZXJvZW4gJiBQYXdzLjwvcD5cclxuICAgIDwvZGl2PlxyXG4gIGA7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xyXG4gICAgcmVzLnN0YXR1c0NvZGUgPSA0MDU7XHJcbiAgICByZXMuc2V0SGVhZGVyKFwiQWxsb3dcIiwgXCJQT1NUXCIpO1xyXG4gICAgcmVzLmVuZChcIk1ldGhvZCBOb3QgQWxsb3dlZFwiKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjYWxlbmRhcklkID0gcHJvY2Vzcy5lbnYuT1VUTE9PS19DQUxFTkRBUl9JRDtcclxuICAgIGlmICghY2FsZW5kYXJJZCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIE9VVExPT0tfQ0FMRU5EQVJfSUQgZW52IHZhclwiKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IGF3YWl0IGdldEFwcE9ubHlBY2Nlc3NUb2tlbigpO1xyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHBhcnNlQm9keShyZXEpO1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBkYXRlLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkdXJhdGlvbk1pbnV0ZXMgPSA2MCxcclxuICAgICAgc2VydmljZUlkLFxyXG4gICAgICBzZXJ2aWNlVGl0bGUsXHJcbiAgICAgIGNsaWVudE5hbWUsXHJcbiAgICAgIGNsaWVudEVtYWlsLFxyXG4gICAgICBub3RlcyxcclxuICAgICAgdGltZVpvbmUgPSBcIlVUQ1wiLFxyXG4gICAgICBkb2dzID0gW10sXHJcbiAgICAgIGRvZ0NvdW50LFxyXG4gICAgfSA9IGJvZHk7XHJcblxyXG4gICAgY29uc3QgdGVhbUVtYWlsID1cclxuICAgICAgcHJvY2Vzcy5lbnYuQk9PS0lOR19OT1RJRklDQVRJT05fRU1BSUwgfHxcclxuICAgICAgcHJvY2Vzcy5lbnYuTk9USUZZX0VNQUlMIHx8XHJcbiAgICAgIHByb2Nlc3MuZW52LkpFUk9FTl9BTkRfUEFXU19FTUFJTDtcclxuXHJcbiAgICBjb25zdCBib29raW5nRnJvbUVtYWlsID0gXHJcbiAgICAgIHByb2Nlc3MuZW52LkJPT0tJTkdfU0VOREVSX0VNQUlMIHx8IFwiYm9va2luZ0BqZXJvZW5hbmRwYXdzLmNvbVwiO1xyXG4gICAgY29uc3Qgb3duZXJOb3RpZmljYXRpb25FbWFpbCA9IFwiamVyb2VuQGplcm9lbmFuZHBhd3MuY29tXCI7XHJcblxyXG4gICAgaWYgKCFkYXRlIHx8ICF0aW1lKSB7XHJcbiAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xyXG4gICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogXCJNaXNzaW5nIGRhdGUgb3IgdGltZVwiIH0pKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0YXJ0RGF0ZVRpbWUgPSBgJHtkYXRlfVQke3RpbWV9OjAwYDtcclxuICAgIGNvbnN0IGVuZERhdGVUaW1lID0gYWRkTWludXRlc1RvRGF0ZVRpbWUoZGF0ZSwgdGltZSwgZHVyYXRpb25NaW51dGVzKTtcclxuXHJcbiAgICBjb25zdCBzdWJqZWN0ID0gc2VydmljZVRpdGxlIHx8IGBUcmFpbmluZyBib29raW5nICgke3NlcnZpY2VJZCB8fCBcImN1c3RvbVwifSlgO1xyXG4gICAgY29uc3QgdGltaW5nID0gYnVpbGRGcmllbmRseVRpbWluZyh7XHJcbiAgICAgIGRhdGUsXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIGR1cmF0aW9uTWludXRlcyxcclxuICAgICAgdGltZVpvbmUsXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGNvbmZpcm1hdGlvbkJvZHkgPSBidWlsZENvbmZpcm1hdGlvbkJvZHkoe1xyXG4gICAgICBjbGllbnROYW1lLFxyXG4gICAgICBzZXJ2aWNlSWQsXHJcbiAgICAgIHNlcnZpY2VUaXRsZSxcclxuICAgICAgdGltaW5nLFxyXG4gICAgICBub3RlcyxcclxuICAgICAgZG9ncyxcclxuICAgICAgZG9nQ291bnQsXHJcbiAgICAgIHRpbWVab25lLFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgZXZlbnQgPSBhd2FpdCBjcmVhdGVFdmVudCh7XHJcbiAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICBjYWxlbmRhcklkLFxyXG4gICAgICBzdWJqZWN0LFxyXG4gICAgICBib2R5OiBjb25maXJtYXRpb25Cb2R5LFxyXG4gICAgICBib2R5Q29udGVudFR5cGU6IFwiSFRNTFwiLFxyXG4gICAgICBzdGFydDogc3RhcnREYXRlVGltZSxcclxuICAgICAgZW5kOiBlbmREYXRlVGltZSxcclxuICAgICAgYXR0ZW5kZWVFbWFpbDogY2xpZW50RW1haWwsXHJcbiAgICAgIGF0dGVuZGVlRW1haWxzOiBbXSxcclxuICAgICAgdGltZVpvbmUsXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBub3RpZmljYXRpb25Cb2R5ID0gYnVpbGROb3RpZmljYXRpb25Cb2R5KHtcclxuICAgICAgc2VydmljZVRpdGxlLFxyXG4gICAgICBzZXJ2aWNlSWQsXHJcbiAgICAgIGNsaWVudE5hbWUsXHJcbiAgICAgIGNsaWVudEVtYWlsLFxyXG4gICAgICB0aW1pbmcsXHJcbiAgICAgIHRpbWVab25lLFxyXG4gICAgICBub3RlcyxcclxuICAgICAgZG9ncyxcclxuICAgICAgZG9nQ291bnQsXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBub3RpZmljYXRpb25SZWNpcGllbnRzID0gW3RlYW1FbWFpbCwgb3duZXJOb3RpZmljYXRpb25FbWFpbF0uZmlsdGVyKFxyXG4gICAgICBCb29sZWFuXHJcbiAgICApO1xyXG5cclxuICAgIGlmIChub3RpZmljYXRpb25SZWNpcGllbnRzLmxlbmd0aCkge1xyXG4gICAgICBhd2FpdCBzZW5kTWFpbCh7XHJcbiAgICAgICAgYWNjZXNzVG9rZW4sXHJcbiAgICAgICAgZnJvbUNhbGVuZGFySWQ6IGNhbGVuZGFySWQsXHJcbiAgICAgICAgdG86IG5vdGlmaWNhdGlvblJlY2lwaWVudHMsXHJcbiAgICAgICAgc3ViamVjdDogYE5ldyBib29raW5nOiAke3N1YmplY3R9YCxcclxuICAgICAgICBib2R5OiBub3RpZmljYXRpb25Cb2R5LFxyXG4gICAgICAgIGNvbnRlbnRUeXBlOiBcIkhUTUxcIixcclxuICAgICAgICBmcm9tOiBib29raW5nRnJvbUVtYWlsLFxyXG4gICAgICAgIHJlcGx5VG86IGJvb2tpbmdGcm9tRW1haWwsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBhd2FpdCBzZW5kTWFpbCh7XHJcbiAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICBmcm9tQ2FsZW5kYXJJZDogY2FsZW5kYXJJZCxcclxuICAgICAgdG86IGNsaWVudEVtYWlsLFxyXG4gICAgICBzdWJqZWN0LFxyXG4gICAgICBib2R5OiBjb25maXJtYXRpb25Cb2R5LFxyXG4gICAgICBjb250ZW50VHlwZTogXCJIVE1MXCIsXHJcbiAgICAgIGZyb206IGJvb2tpbmdGcm9tRW1haWwsXHJcbiAgICAgIHJlcGx5VG86IGJvb2tpbmdGcm9tRW1haWwsXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XHJcbiAgICByZXMuZW5kKFxyXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgaWQ6IGV2ZW50LmlkLFxyXG4gICAgICAgIHdlYkxpbms6IGV2ZW50LndlYkxpbmssXHJcbiAgICAgICAgc3ViamVjdCxcclxuICAgICAgICBzdGFydDogZXZlbnQuc3RhcnQsXHJcbiAgICAgICAgZW5kOiBldmVudC5lbmQsXHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiQm9va2luZyBlcnJvclwiLCBlcnJvcik7XHJcbiAgICByZXMuc3RhdHVzQ29kZSA9IDUwMDtcclxuICAgIHJlcy5lbmQoSlNPTi5zdHJpbmdpZnkoeyBtZXNzYWdlOiBcIkZhaWxlZCB0byBib29rIGV2ZW50XCIgfSkpO1xyXG4gIH1cclxufTsiXSwibmFtZXMiOlsiRGF0ZVRpbWUiLCJyZXF1aXJlIiwiZ2V0QXBwT25seUFjY2Vzc1Rva2VuIiwiY3JlYXRlRXZlbnQiLCJzZW5kTWFpbCIsInBhcnNlQm9keSIsInJlcSIsImNodW5rcyIsImNodW5rIiwicHVzaCIsImJvZHkiLCJCdWZmZXIiLCJjb25jYXQiLCJ0b1N0cmluZyIsIkpTT04iLCJwYXJzZSIsImFkZE1pbnV0ZXNUb0RhdGVUaW1lIiwiZGF0ZSIsInRpbWUiLCJtaW51dGVzIiwic3RhcnQiLCJEYXRlIiwic2V0VVRDTWludXRlcyIsImdldFVUQ01pbnV0ZXMiLCJ0b0lTT1N0cmluZyIsInNsaWNlIiwiZXNjYXBlSHRtbCIsInZhbHVlIiwiU3RyaW5nIiwicmVwbGFjZSIsImJ1aWxkRnJpZW5kbHlUaW1pbmciLCJkdXJhdGlvbk1pbnV0ZXMiLCJ0aW1lWm9uZSIsInpvbmUiLCJmcm9tSVNPIiwic2FmZVN0YXJ0IiwiaXNWYWxpZCIsImVuZCIsInBsdXMiLCJmb3JtYXQiLCJ0b0Zvcm1hdCIsImJ1aWxkQ29uZmlybWF0aW9uQm9keSIsImNsaWVudE5hbWUiLCJzZXJ2aWNlSWQiLCJzZXJ2aWNlVGl0bGUiLCJ0aW1pbmciLCJub3RlcyIsImRvZ3MiLCJkb2dDb3VudCIsInJlYWRhYmxlU2VydmljZSIsImRvZ0VudHJpZXMiLCJBcnJheSIsImlzQXJyYXkiLCJoYXNEb2dzIiwibGVuZ3RoIiwiZG9nRGV0YWlscyIsIm1hcCIsImRvZyIsImluZGV4IiwibmFtZSIsImJyZWVkIiwicGhvdG9OYW1lIiwiaGFzUGhvdG8iLCJCb29sZWFuIiwicGhvdG9EYXRhVXJsIiwiam9pbiIsIm5vdGVzQmxvY2siLCJidWlsZE5vdGlmaWNhdGlvbkJvZHkiLCJjbGllbnRFbWFpbCIsImNsaWVudExpbmUiLCJtb2R1bGUiLCJleHBvcnRzIiwicmVzIiwibWV0aG9kIiwic3RhdHVzQ29kZSIsInNldEhlYWRlciIsImNhbGVuZGFySWQiLCJwcm9jZXNzIiwiZW52IiwiT1VUTE9PS19DQUxFTkRBUl9JRCIsIkVycm9yIiwiYWNjZXNzVG9rZW4iLCJ0ZWFtRW1haWwiLCJCT09LSU5HX05PVElGSUNBVElPTl9FTUFJTCIsIk5PVElGWV9FTUFJTCIsIkpFUk9FTl9BTkRfUEFXU19FTUFJTCIsImJvb2tpbmdGcm9tRW1haWwiLCJCT09LSU5HX1NFTkRFUl9FTUFJTCIsIm93bmVyTm90aWZpY2F0aW9uRW1haWwiLCJzdHJpbmdpZnkiLCJtZXNzYWdlIiwic3RhcnREYXRlVGltZSIsImVuZERhdGVUaW1lIiwic3ViamVjdCIsImNvbmZpcm1hdGlvbkJvZHkiLCJldmVudCIsImJvZHlDb250ZW50VHlwZSIsImF0dGVuZGVlRW1haWwiLCJhdHRlbmRlZUVtYWlscyIsIm5vdGlmaWNhdGlvbkJvZHkiLCJub3RpZmljYXRpb25SZWNpcGllbnRzIiwiZmlsdGVyIiwiZnJvbUNhbGVuZGFySWQiLCJ0byIsImNvbnRlbnRUeXBlIiwiZnJvbSIsInJlcGx5VG8iLCJpZCIsIndlYkxpbmsiLCJlcnJvciIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./api/book.js\n");

/***/ }),

/***/ "(api)/./pages/api/book.js":
/*!***************************!*\
  !*** ./pages/api/book.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst bookHandler = __webpack_require__(/*! ../../api/book */ \"(api)/./api/book.js\");\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (bookHandler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYm9vay5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLE1BQU1BLGNBQWNDLG1CQUFPQSxDQUFDO0FBRXJCLE1BQU1DLFNBQVM7SUFDcEJDLEtBQUs7UUFDSEMsWUFBWTtJQUNkO0FBQ0YsRUFBRTtBQUVGLGlFQUFlSixXQUFXQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL3BhZ2VzL2FwaS9ib29rLmpzPzI5MDMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYm9va0hhbmRsZXIgPSByZXF1aXJlKCcuLi8uLi9hcGkvYm9vaycpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBhcGk6IHtcclxuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxyXG4gIH0sXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBib29rSGFuZGxlcjsiXSwibmFtZXMiOlsiYm9va0hhbmRsZXIiLCJyZXF1aXJlIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/book.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();