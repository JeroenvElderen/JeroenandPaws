"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/book";
exports.ids = ["pages/api/book"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "luxon":
/*!************************!*\
  !*** external "luxon" ***!
  \************************/
/***/ ((module) => {

module.exports = require("luxon");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\book.js */ \"(api)/./pages/api/book.js\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/book\",\n        pathname: \"/api/book\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_book_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmJvb2smcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2Jvb2suanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDa0Q7QUFDbEQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtDQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrQ0FBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLz8xNmMwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcYm9vay5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2Jvb2tcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ib29rXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./api/_lib/auth.js":
/*!**************************!*\
  !*** ./api/_lib/auth.js ***!
  \**************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst TOKEN_COOKIE = \"msTokens\";\nconst SCOPES = [\n    \"offline_access\",\n    \"Calendars.ReadWrite\"\n];\nconst requiredEnv = [\n    \"AZURE_CLIENT_ID\",\n    \"AZURE_CLIENT_SECRET\",\n    \"AZURE_TENANT_ID\",\n    \"BACKEND_BASE_URL\"\n];\nrequiredEnv.forEach((key)=>{\n    if (!process.env[key]) {\n        console.warn(`Missing env var ${key}`);\n    }\n});\nconst authority = `https://login.microsoftonline.com/${process.env.AZURE_TENANT_ID}/oauth2/v2.0`;\nconst redirectUri = process.env.AZURE_REDIRECT_URI || `${process.env.BACKEND_BASE_URL}/api/auth/microsoft/callback`;\nconst encryptionSecret = process.env.TOKEN_ENCRYPTION_KEY || process.env.AZURE_CLIENT_SECRET || \"development-token-key\";\nif (!process.env.TOKEN_ENCRYPTION_KEY && !process.env.AZURE_CLIENT_SECRET) {\n    console.warn(\"Missing TOKEN_ENCRYPTION_KEY and AZURE_CLIENT_SECRET; using fallback encryption key\");\n}\nconst encryptionKey = crypto.createHash(\"sha256\").update(encryptionSecret).digest();\nconst serializeCookie = (name, value, options = {})=>{\n    const segments = [\n        `${name}=${value}`\n    ];\n    if (options.maxAge) segments.push(`Max-Age=${options.maxAge}`);\n    if (options.domain) segments.push(`Domain=${options.domain}`);\n    if (options.path) segments.push(`Path=${options.path}`);\n    if (options.secure) segments.push(\"Secure\");\n    if (options.httpOnly) segments.push(\"HttpOnly\");\n    if (options.sameSite) segments.push(`SameSite=${options.sameSite}`);\n    return segments.join(\"; \");\n};\nconst parseCookieHeader = (header)=>{\n    if (!header) return {};\n    return header.split(/; */).reduce((acc, part)=>{\n        const [key, ...rest] = part.split(\"=\");\n        if (!key) return acc;\n        acc[key.trim()] = decodeURIComponent(rest.join(\"=\"));\n        return acc;\n    }, {});\n};\nconst encrypt = (data)=>{\n    const iv = crypto.randomBytes(16);\n    const cipher = crypto.createCipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    const encrypted = Buffer.concat([\n        cipher.update(JSON.stringify(data), \"utf8\"),\n        cipher.final()\n    ]);\n    const authTag = cipher.getAuthTag();\n    return Buffer.concat([\n        iv,\n        authTag,\n        encrypted\n    ]).toString(\"base64\");\n};\nconst decrypt = (payload)=>{\n    const buffer = Buffer.from(payload, \"base64\");\n    const iv = buffer.subarray(0, 16);\n    const tag = buffer.subarray(16, 32);\n    const encrypted = buffer.subarray(32);\n    const decipher = crypto.createDecipheriv(\"aes-256-gcm\", encryptionKey, iv);\n    decipher.setAuthTag(tag);\n    const decrypted = Buffer.concat([\n        decipher.update(encrypted),\n        decipher.final()\n    ]).toString(\"utf8\");\n    return JSON.parse(decrypted);\n};\nconst serializeTokens = (res, tokens)=>{\n    const encoded = encrypt(tokens);\n    const secure = \"development\" === \"production\";\n    const cookieString = serializeCookie(TOKEN_COOKIE, encoded, {\n        httpOnly: true,\n        secure,\n        sameSite: \"lax\",\n        path: \"/\",\n        maxAge: 60 * 60 * 24 * 30\n    });\n    res.setHeader(\"Set-Cookie\", cookieString);\n};\nconst parseTokens = (req)=>{\n    if (!req.headers.cookie) return null;\n    const cookies = parseCookieHeader(req.headers.cookie || \"\");\n    if (!cookies[TOKEN_COOKIE]) return null;\n    try {\n        return decrypt(cookies[TOKEN_COOKIE]);\n    } catch (error) {\n        console.error(\"Failed to decrypt token cookie\", error);\n        return null;\n    }\n};\nconst buildAuthUrl = async ()=>{\n    const params = new URLSearchParams({\n        client_id: process.env.AZURE_CLIENT_ID,\n        response_type: \"code\",\n        redirect_uri: redirectUri,\n        response_mode: \"query\",\n        scope: SCOPES.join(\" \"),\n        prompt: \"select_account\"\n    });\n    return `${authority}/authorize?${params.toString()}`;\n};\nconst tokenRequest = async (formData, { includeRedirect = true } = {})=>{\n    const response = await fetch(`${authority}/token`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/x-www-form-urlencoded\"\n        },\n        body: new URLSearchParams({\n            client_id: process.env.AZURE_CLIENT_ID,\n            client_secret: process.env.AZURE_CLIENT_SECRET,\n            ...includeRedirect ? {\n                redirect_uri: redirectUri\n            } : {},\n            ...formData\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Token endpoint error: ${response.status} ${error}`);\n    }\n    const data = await response.json();\n    return {\n        accessToken: data.access_token,\n        refreshToken: data.refresh_token,\n        expiresAt: new Date(Date.now() + data.expires_in * 1000).toISOString()\n    };\n};\nconst exchangeCodeForTokens = async (code)=>tokenRequest({\n        grant_type: \"authorization_code\",\n        code,\n        scope: SCOPES.join(\" \")\n    });\nconst refreshTokens = async (stored)=>{\n    if (!stored?.refreshToken) return null;\n    return tokenRequest({\n        grant_type: \"refresh_token\",\n        refresh_token: stored.refreshToken,\n        scope: SCOPES.join(\" \")\n    });\n};\nlet cachedAppToken = null;\nconst appTokenRequest = async ()=>{\n    const token = await tokenRequest({\n        grant_type: \"client_credentials\",\n        scope: \"https://graph.microsoft.com/.default\"\n    }, {\n        includeRedirect: false\n    });\n    cachedAppToken = {\n        accessToken: token.accessToken,\n        expiresAt: token.expiresAt\n    };\n    return cachedAppToken;\n};\nconst hasValidAppToken = ()=>{\n    if (!cachedAppToken?.expiresAt) return false;\n    const expiresAt = new Date(cachedAppToken.expiresAt);\n    return expiresAt.getTime() > Date.now() + 60 * 1000;\n};\nconst getAppOnlyAccessToken = async ()=>{\n    if (hasValidAppToken()) {\n        return cachedAppToken.accessToken;\n    }\n    const freshToken = await appTokenRequest();\n    return freshToken.accessToken;\n};\nconst needsRefresh = (tokens)=>{\n    if (!tokens?.expiresAt) return true;\n    const expiresAt = new Date(tokens.expiresAt);\n    const refreshThreshold = Date.now() + 5 * 60 * 1000;\n    return expiresAt.getTime() <= refreshThreshold;\n};\nconst ensureTokens = async (req, res)=>{\n    const stored = parseTokens(req);\n    if (!stored) return null;\n    if (!needsRefresh(stored)) {\n        return stored;\n    }\n    const refreshed = await refreshTokens(stored);\n    if (refreshed) {\n        serializeTokens(res, refreshed);\n        return refreshed;\n    }\n    return null;\n};\nmodule.exports = {\n    buildAuthUrl,\n    ensureTokens,\n    exchangeCodeForTokens,\n    getAppOnlyAccessToken,\n    parseTokens,\n    serializeTokens\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9hcGkvX2xpYi9hdXRoLmpzIiwibWFwcGluZ3MiOiI7QUFBQSxNQUFNQSxTQUFTQyxtQkFBT0EsQ0FBQyxzQkFBUTtBQUUvQixNQUFNQyxlQUFlO0FBQ3JCLE1BQU1DLFNBQVM7SUFBQztJQUFrQjtDQUFzQjtBQUV4RCxNQUFNQyxjQUFjO0lBQ2xCO0lBQ0E7SUFDQTtJQUNBO0NBQ0Q7QUFFREEsWUFBWUMsT0FBTyxDQUFDLENBQUNDO0lBQ25CLElBQUksQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDRixJQUFJLEVBQUU7UUFDckJHLFFBQVFDLElBQUksQ0FBQyxDQUFDLGdCQUFnQixFQUFFSixJQUFJLENBQUM7SUFDdkM7QUFDRjtBQUVBLE1BQU1LLFlBQVksQ0FBQyxrQ0FBa0MsRUFBRUosUUFBUUMsR0FBRyxDQUFDSSxlQUFlLENBQUMsWUFBWSxDQUFDO0FBQ2hHLE1BQU1DLGNBQ0pOLFFBQVFDLEdBQUcsQ0FBQ00sa0JBQWtCLElBQzlCLENBQUMsRUFBRVAsUUFBUUMsR0FBRyxDQUFDTyxnQkFBZ0IsQ0FBQyw0QkFBNEIsQ0FBQztBQUU3RCxNQUFNQyxtQkFDTlQsUUFBUUMsR0FBRyxDQUFDUyxvQkFBb0IsSUFDaENWLFFBQVFDLEdBQUcsQ0FBQ1UsbUJBQW1CLElBQy9CO0FBRUYsSUFBSSxDQUFDWCxRQUFRQyxHQUFHLENBQUNTLG9CQUFvQixJQUFJLENBQUNWLFFBQVFDLEdBQUcsQ0FBQ1UsbUJBQW1CLEVBQUU7SUFDekVULFFBQVFDLElBQUksQ0FDVjtBQUVKO0FBRUEsTUFBTVMsZ0JBQWdCbkIsT0FDbkJvQixVQUFVLENBQUMsVUFDWEMsTUFBTSxDQUFDTCxrQkFDUE0sTUFBTTtBQUVULE1BQU1DLGtCQUFrQixDQUFDQyxNQUFNQyxPQUFPQyxVQUFVLENBQUMsQ0FBQztJQUNoRCxNQUFNQyxXQUFXO1FBQUMsQ0FBQyxFQUFFSCxLQUFLLENBQUMsRUFBRUMsTUFBTSxDQUFDO0tBQUM7SUFDckMsSUFBSUMsUUFBUUUsTUFBTSxFQUFFRCxTQUFTRSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUVILFFBQVFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdELElBQUlGLFFBQVFJLE1BQU0sRUFBRUgsU0FBU0UsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFSCxRQUFRSSxNQUFNLENBQUMsQ0FBQztJQUM1RCxJQUFJSixRQUFRSyxJQUFJLEVBQUVKLFNBQVNFLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRUgsUUFBUUssSUFBSSxDQUFDLENBQUM7SUFDdEQsSUFBSUwsUUFBUU0sTUFBTSxFQUFFTCxTQUFTRSxJQUFJLENBQUM7SUFDbEMsSUFBSUgsUUFBUU8sUUFBUSxFQUFFTixTQUFTRSxJQUFJLENBQUM7SUFDcEMsSUFBSUgsUUFBUVEsUUFBUSxFQUFFUCxTQUFTRSxJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUVILFFBQVFRLFFBQVEsQ0FBQyxDQUFDO0lBQ2xFLE9BQU9QLFNBQVNRLElBQUksQ0FBQztBQUN2QjtBQUVBLE1BQU1DLG9CQUFvQixDQUFDQztJQUN6QixJQUFJLENBQUNBLFFBQVEsT0FBTyxDQUFDO0lBQ3JCLE9BQU9BLE9BQU9DLEtBQUssQ0FBQyxPQUFPQyxNQUFNLENBQUMsQ0FBQ0MsS0FBS0M7UUFDdEMsTUFBTSxDQUFDbkMsS0FBSyxHQUFHb0MsS0FBSyxHQUFHRCxLQUFLSCxLQUFLLENBQUM7UUFDbEMsSUFBSSxDQUFDaEMsS0FBSyxPQUFPa0M7UUFDakJBLEdBQUcsQ0FBQ2xDLElBQUlxQyxJQUFJLEdBQUcsR0FBR0MsbUJBQW1CRixLQUFLUCxJQUFJLENBQUM7UUFDL0MsT0FBT0s7SUFDVCxHQUFHLENBQUM7QUFDTjtBQUVBLE1BQU1LLFVBQVUsQ0FBQ0M7SUFDZixNQUFNQyxLQUFLL0MsT0FBT2dELFdBQVcsQ0FBQztJQUM5QixNQUFNQyxTQUFTakQsT0FBT2tELGNBQWMsQ0FBQyxlQUFlL0IsZUFBZTRCO0lBQ25FLE1BQU1JLFlBQVlDLE9BQU9DLE1BQU0sQ0FBQztRQUM5QkosT0FBTzVCLE1BQU0sQ0FBQ2lDLEtBQUtDLFNBQVMsQ0FBQ1QsT0FBTztRQUNwQ0csT0FBT08sS0FBSztLQUNiO0lBQ0QsTUFBTUMsVUFBVVIsT0FBT1MsVUFBVTtJQUNqQyxPQUFPTixPQUFPQyxNQUFNLENBQUM7UUFBQ047UUFBSVU7UUFBU047S0FBVSxFQUFFUSxRQUFRLENBQUM7QUFDMUQ7QUFFQSxNQUFNQyxVQUFVLENBQUNDO0lBQ2YsTUFBTUMsU0FBU1YsT0FBT1csSUFBSSxDQUFDRixTQUFTO0lBQ3BDLE1BQU1kLEtBQUtlLE9BQU9FLFFBQVEsQ0FBQyxHQUFHO0lBQzlCLE1BQU1DLE1BQU1ILE9BQU9FLFFBQVEsQ0FBQyxJQUFJO0lBQ2hDLE1BQU1iLFlBQVlXLE9BQU9FLFFBQVEsQ0FBQztJQUNsQyxNQUFNRSxXQUFXbEUsT0FBT21FLGdCQUFnQixDQUFDLGVBQWVoRCxlQUFlNEI7SUFDdkVtQixTQUFTRSxVQUFVLENBQUNIO0lBQ3BCLE1BQU1JLFlBQVlqQixPQUFPQyxNQUFNLENBQUM7UUFDOUJhLFNBQVM3QyxNQUFNLENBQUM4QjtRQUNoQmUsU0FBU1YsS0FBSztLQUNmLEVBQUVHLFFBQVEsQ0FBQztJQUNaLE9BQU9MLEtBQUtnQixLQUFLLENBQUNEO0FBQ3BCO0FBRUEsTUFBTUUsa0JBQWtCLENBQUNDLEtBQUtDO0lBQzVCLE1BQU1DLFVBQVU3QixRQUFRNEI7SUFDeEIsTUFBTXpDLFNBQVN6QixrQkFBeUI7SUFDeEMsTUFBTW9FLGVBQWVwRCxnQkFBZ0JyQixjQUFjd0UsU0FBUztRQUMxRHpDLFVBQVU7UUFDVkQ7UUFDQUUsVUFBVTtRQUNWSCxNQUFNO1FBQ05ILFFBQVEsS0FBSyxLQUFLLEtBQUs7SUFDekI7SUFDQTRDLElBQUlJLFNBQVMsQ0FBQyxjQUFjRDtBQUM5QjtBQUVBLE1BQU1FLGNBQWMsQ0FBQ0M7SUFDbkIsSUFBSSxDQUFDQSxJQUFJQyxPQUFPLENBQUNDLE1BQU0sRUFBRSxPQUFPO0lBQ2hDLE1BQU1DLFVBQVU3QyxrQkFBa0IwQyxJQUFJQyxPQUFPLENBQUNDLE1BQU0sSUFBSTtJQUN4RCxJQUFJLENBQUNDLE9BQU8sQ0FBQy9FLGFBQWEsRUFBRSxPQUFPO0lBQ25DLElBQUk7UUFDRixPQUFPMEQsUUFBUXFCLE9BQU8sQ0FBQy9FLGFBQWE7SUFDdEMsRUFBRSxPQUFPZ0YsT0FBTztRQUNkekUsUUFBUXlFLEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU87SUFDVDtBQUNGO0FBRUEsTUFBTUMsZUFBZTtJQUNuQixNQUFNQyxTQUFTLElBQUlDLGdCQUFnQjtRQUNqQ0MsV0FBVy9FLFFBQVFDLEdBQUcsQ0FBQytFLGVBQWU7UUFDdENDLGVBQWU7UUFDZkMsY0FBYzVFO1FBQ2Q2RSxlQUFlO1FBQ2ZDLE9BQU94RixPQUFPZ0MsSUFBSSxDQUFDO1FBQ25CeUQsUUFBUTtJQUNWO0lBRUEsT0FBTyxDQUFDLEVBQUVqRixVQUFVLFdBQVcsRUFBRXlFLE9BQU96QixRQUFRLEdBQUcsQ0FBQztBQUN0RDtBQUVBLE1BQU1rQyxlQUFlLE9BQU9DLFVBQVUsRUFBRUMsa0JBQWtCLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNuRSxNQUFNQyxXQUFXLE1BQU1DLE1BQU0sQ0FBQyxFQUFFdEYsVUFBVSxNQUFNLENBQUMsRUFBRTtRQUNqRHVGLFFBQVE7UUFDUm5CLFNBQVM7WUFBRSxnQkFBZ0I7UUFBb0M7UUFDL0RvQixNQUFNLElBQUlkLGdCQUFnQjtZQUN4QkMsV0FBVy9FLFFBQVFDLEdBQUcsQ0FBQytFLGVBQWU7WUFDdENhLGVBQWU3RixRQUFRQyxHQUFHLENBQUNVLG1CQUFtQjtZQUM5QyxHQUFJNkUsa0JBQWtCO2dCQUFFTixjQUFjNUU7WUFBWSxJQUFJLENBQUMsQ0FBQztZQUN4RCxHQUFHaUYsUUFBUTtRQUNiO0lBQ0Y7SUFFQSxJQUFJLENBQUNFLFNBQVNLLEVBQUUsRUFBRTtRQUNoQixNQUFNbkIsUUFBUSxNQUFNYyxTQUFTTSxJQUFJO1FBQ2pDLE1BQU0sSUFBSUMsTUFBTSxDQUFDLHNCQUFzQixFQUFFUCxTQUFTUSxNQUFNLENBQUMsQ0FBQyxFQUFFdEIsTUFBTSxDQUFDO0lBQ3JFO0lBRUEsTUFBTXBDLE9BQU8sTUFBTWtELFNBQVNTLElBQUk7SUFDaEMsT0FBTztRQUNMQyxhQUFhNUQsS0FBSzZELFlBQVk7UUFDOUJDLGNBQWM5RCxLQUFLK0QsYUFBYTtRQUNoQ0MsV0FBVyxJQUFJQyxLQUFLQSxLQUFLQyxHQUFHLEtBQUtsRSxLQUFLbUUsVUFBVSxHQUFHLE1BQU1DLFdBQVc7SUFDdEU7QUFDRjtBQUVBLE1BQU1DLHdCQUF3QixPQUFPQyxPQUNuQ3ZCLGFBQWE7UUFDWHdCLFlBQVk7UUFDWkQ7UUFDQXpCLE9BQU94RixPQUFPZ0MsSUFBSSxDQUFDO0lBQ3JCO0FBRUYsTUFBTW1GLGdCQUFnQixPQUFPQztJQUMzQixJQUFJLENBQUNBLFFBQVFYLGNBQWMsT0FBTztJQUNsQyxPQUFPZixhQUFhO1FBQ2xCd0IsWUFBWTtRQUNaUixlQUFlVSxPQUFPWCxZQUFZO1FBQ2xDakIsT0FBT3hGLE9BQU9nQyxJQUFJLENBQUM7SUFDckI7QUFDRjtBQUVBLElBQUlxRixpQkFBaUI7QUFFckIsTUFBTUMsa0JBQWtCO0lBQ3RCLE1BQU1DLFFBQVEsTUFBTTdCLGFBQ2xCO1FBQ0V3QixZQUFZO1FBQ1oxQixPQUFPO0lBQ1QsR0FDQTtRQUFFSSxpQkFBaUI7SUFBTTtJQUczQnlCLGlCQUFpQjtRQUNmZCxhQUFhZ0IsTUFBTWhCLFdBQVc7UUFDOUJJLFdBQVdZLE1BQU1aLFNBQVM7SUFDNUI7SUFFQSxPQUFPVTtBQUNUO0FBRUEsTUFBTUcsbUJBQW1CO0lBQ3ZCLElBQUksQ0FBQ0gsZ0JBQWdCVixXQUFXLE9BQU87SUFDdkMsTUFBTUEsWUFBWSxJQUFJQyxLQUFLUyxlQUFlVixTQUFTO0lBQ25ELE9BQU9BLFVBQVVjLE9BQU8sS0FBS2IsS0FBS0MsR0FBRyxLQUFLLEtBQUs7QUFDakQ7QUFFQSxNQUFNYSx3QkFBd0I7SUFDNUIsSUFBSUYsb0JBQW9CO1FBQ3RCLE9BQU9ILGVBQWVkLFdBQVc7SUFDbkM7SUFFQSxNQUFNb0IsYUFBYSxNQUFNTDtJQUN6QixPQUFPSyxXQUFXcEIsV0FBVztBQUMvQjtBQUVBLE1BQU1xQixlQUFlLENBQUN0RDtJQUNwQixJQUFJLENBQUNBLFFBQVFxQyxXQUFXLE9BQU87SUFDL0IsTUFBTUEsWUFBWSxJQUFJQyxLQUFLdEMsT0FBT3FDLFNBQVM7SUFDM0MsTUFBTWtCLG1CQUFtQmpCLEtBQUtDLEdBQUcsS0FBSyxJQUFJLEtBQUs7SUFDL0MsT0FBT0YsVUFBVWMsT0FBTyxNQUFNSTtBQUNoQztBQUVBLE1BQU1DLGVBQWUsT0FBT25ELEtBQUtOO0lBQy9CLE1BQU0rQyxTQUFTMUMsWUFBWUM7SUFDM0IsSUFBSSxDQUFDeUMsUUFBUSxPQUFPO0lBRXBCLElBQUksQ0FBQ1EsYUFBYVIsU0FBUztRQUN6QixPQUFPQTtJQUNUO0lBRUEsTUFBTVcsWUFBWSxNQUFNWixjQUFjQztJQUN0QyxJQUFJVyxXQUFXO1FBQ2IzRCxnQkFBZ0JDLEtBQUswRDtRQUNyQixPQUFPQTtJQUNUO0lBRUEsT0FBTztBQUNUO0FBRUFDLE9BQU9DLE9BQU8sR0FBRztJQUNmakQ7SUFDQThDO0lBQ0FkO0lBQ0FVO0lBQ0FoRDtJQUNBTjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL2FwaS9fbGliL2F1dGguanM/NzYyNCJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjcnlwdG8gPSByZXF1aXJlKFwiY3J5cHRvXCIpO1xyXG5cclxuY29uc3QgVE9LRU5fQ09PS0lFID0gXCJtc1Rva2Vuc1wiO1xyXG5jb25zdCBTQ09QRVMgPSBbXCJvZmZsaW5lX2FjY2Vzc1wiLCBcIkNhbGVuZGFycy5SZWFkV3JpdGVcIl07XHJcblxyXG5jb25zdCByZXF1aXJlZEVudiA9IFtcclxuICBcIkFaVVJFX0NMSUVOVF9JRFwiLFxyXG4gIFwiQVpVUkVfQ0xJRU5UX1NFQ1JFVFwiLFxyXG4gIFwiQVpVUkVfVEVOQU5UX0lEXCIsXHJcbiAgXCJCQUNLRU5EX0JBU0VfVVJMXCIsXHJcbl07XHJcblxyXG5yZXF1aXJlZEVudi5mb3JFYWNoKChrZXkpID0+IHtcclxuICBpZiAoIXByb2Nlc3MuZW52W2tleV0pIHtcclxuICAgIGNvbnNvbGUud2FybihgTWlzc2luZyBlbnYgdmFyICR7a2V5fWApO1xyXG4gIH1cclxufSk7XHJcblxyXG5jb25zdCBhdXRob3JpdHkgPSBgaHR0cHM6Ly9sb2dpbi5taWNyb3NvZnRvbmxpbmUuY29tLyR7cHJvY2Vzcy5lbnYuQVpVUkVfVEVOQU5UX0lEfS9vYXV0aDIvdjIuMGA7XHJcbmNvbnN0IHJlZGlyZWN0VXJpID1cclxuICBwcm9jZXNzLmVudi5BWlVSRV9SRURJUkVDVF9VUkkgfHxcclxuICBgJHtwcm9jZXNzLmVudi5CQUNLRU5EX0JBU0VfVVJMfS9hcGkvYXV0aC9taWNyb3NvZnQvY2FsbGJhY2tgO1xyXG5cclxuICBjb25zdCBlbmNyeXB0aW9uU2VjcmV0ID1cclxuICBwcm9jZXNzLmVudi5UT0tFTl9FTkNSWVBUSU9OX0tFWSB8fFxyXG4gIHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9TRUNSRVQgfHxcclxuICBcImRldmVsb3BtZW50LXRva2VuLWtleVwiO1xyXG5cclxuaWYgKCFwcm9jZXNzLmVudi5UT0tFTl9FTkNSWVBUSU9OX0tFWSAmJiAhcHJvY2Vzcy5lbnYuQVpVUkVfQ0xJRU5UX1NFQ1JFVCkge1xyXG4gIGNvbnNvbGUud2FybihcclxuICAgIFwiTWlzc2luZyBUT0tFTl9FTkNSWVBUSU9OX0tFWSBhbmQgQVpVUkVfQ0xJRU5UX1NFQ1JFVDsgdXNpbmcgZmFsbGJhY2sgZW5jcnlwdGlvbiBrZXlcIlxyXG4gICk7XHJcbn1cclxuXHJcbmNvbnN0IGVuY3J5cHRpb25LZXkgPSBjcnlwdG9cclxuICAuY3JlYXRlSGFzaChcInNoYTI1NlwiKVxyXG4gIC51cGRhdGUoZW5jcnlwdGlvblNlY3JldClcclxuICAuZGlnZXN0KCk7XHJcblxyXG5jb25zdCBzZXJpYWxpemVDb29raWUgPSAobmFtZSwgdmFsdWUsIG9wdGlvbnMgPSB7fSkgPT4ge1xyXG4gIGNvbnN0IHNlZ21lbnRzID0gW2Ake25hbWV9PSR7dmFsdWV9YF07XHJcbiAgaWYgKG9wdGlvbnMubWF4QWdlKSBzZWdtZW50cy5wdXNoKGBNYXgtQWdlPSR7b3B0aW9ucy5tYXhBZ2V9YCk7XHJcbiAgaWYgKG9wdGlvbnMuZG9tYWluKSBzZWdtZW50cy5wdXNoKGBEb21haW49JHtvcHRpb25zLmRvbWFpbn1gKTtcclxuICBpZiAob3B0aW9ucy5wYXRoKSBzZWdtZW50cy5wdXNoKGBQYXRoPSR7b3B0aW9ucy5wYXRofWApO1xyXG4gIGlmIChvcHRpb25zLnNlY3VyZSkgc2VnbWVudHMucHVzaChcIlNlY3VyZVwiKTtcclxuICBpZiAob3B0aW9ucy5odHRwT25seSkgc2VnbWVudHMucHVzaChcIkh0dHBPbmx5XCIpO1xyXG4gIGlmIChvcHRpb25zLnNhbWVTaXRlKSBzZWdtZW50cy5wdXNoKGBTYW1lU2l0ZT0ke29wdGlvbnMuc2FtZVNpdGV9YCk7XHJcbiAgcmV0dXJuIHNlZ21lbnRzLmpvaW4oXCI7IFwiKTtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlQ29va2llSGVhZGVyID0gKGhlYWRlcikgPT4ge1xyXG4gIGlmICghaGVhZGVyKSByZXR1cm4ge307XHJcbiAgcmV0dXJuIGhlYWRlci5zcGxpdCgvOyAqLykucmVkdWNlKChhY2MsIHBhcnQpID0+IHtcclxuICAgIGNvbnN0IFtrZXksIC4uLnJlc3RdID0gcGFydC5zcGxpdChcIj1cIik7XHJcbiAgICBpZiAoIWtleSkgcmV0dXJuIGFjYztcclxuICAgIGFjY1trZXkudHJpbSgpXSA9IGRlY29kZVVSSUNvbXBvbmVudChyZXN0LmpvaW4oXCI9XCIpKTtcclxuICAgIHJldHVybiBhY2M7XHJcbiAgfSwge30pO1xyXG59O1xyXG5cclxuY29uc3QgZW5jcnlwdCA9IChkYXRhKSA9PiB7XHJcbiAgY29uc3QgaXYgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpO1xyXG4gIGNvbnN0IGNpcGhlciA9IGNyeXB0by5jcmVhdGVDaXBoZXJpdihcImFlcy0yNTYtZ2NtXCIsIGVuY3J5cHRpb25LZXksIGl2KTtcclxuICBjb25zdCBlbmNyeXB0ZWQgPSBCdWZmZXIuY29uY2F0KFtcclxuICAgIGNpcGhlci51cGRhdGUoSlNPTi5zdHJpbmdpZnkoZGF0YSksIFwidXRmOFwiKSxcclxuICAgIGNpcGhlci5maW5hbCgpLFxyXG4gIF0pO1xyXG4gIGNvbnN0IGF1dGhUYWcgPSBjaXBoZXIuZ2V0QXV0aFRhZygpO1xyXG4gIHJldHVybiBCdWZmZXIuY29uY2F0KFtpdiwgYXV0aFRhZywgZW5jcnlwdGVkXSkudG9TdHJpbmcoXCJiYXNlNjRcIik7XHJcbn07XHJcblxyXG5jb25zdCBkZWNyeXB0ID0gKHBheWxvYWQpID0+IHtcclxuICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShwYXlsb2FkLCBcImJhc2U2NFwiKTtcclxuICBjb25zdCBpdiA9IGJ1ZmZlci5zdWJhcnJheSgwLCAxNik7XHJcbiAgY29uc3QgdGFnID0gYnVmZmVyLnN1YmFycmF5KDE2LCAzMik7XHJcbiAgY29uc3QgZW5jcnlwdGVkID0gYnVmZmVyLnN1YmFycmF5KDMyKTtcclxuICBjb25zdCBkZWNpcGhlciA9IGNyeXB0by5jcmVhdGVEZWNpcGhlcml2KFwiYWVzLTI1Ni1nY21cIiwgZW5jcnlwdGlvbktleSwgaXYpO1xyXG4gIGRlY2lwaGVyLnNldEF1dGhUYWcodGFnKTtcclxuICBjb25zdCBkZWNyeXB0ZWQgPSBCdWZmZXIuY29uY2F0KFtcclxuICAgIGRlY2lwaGVyLnVwZGF0ZShlbmNyeXB0ZWQpLFxyXG4gICAgZGVjaXBoZXIuZmluYWwoKSxcclxuICBdKS50b1N0cmluZyhcInV0ZjhcIik7XHJcbiAgcmV0dXJuIEpTT04ucGFyc2UoZGVjcnlwdGVkKTtcclxufTtcclxuXHJcbmNvbnN0IHNlcmlhbGl6ZVRva2VucyA9IChyZXMsIHRva2VucykgPT4ge1xyXG4gIGNvbnN0IGVuY29kZWQgPSBlbmNyeXB0KHRva2Vucyk7XHJcbiAgY29uc3Qgc2VjdXJlID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiO1xyXG4gIGNvbnN0IGNvb2tpZVN0cmluZyA9IHNlcmlhbGl6ZUNvb2tpZShUT0tFTl9DT09LSUUsIGVuY29kZWQsIHtcclxuICAgIGh0dHBPbmx5OiB0cnVlLFxyXG4gICAgc2VjdXJlLFxyXG4gICAgc2FtZVNpdGU6IFwibGF4XCIsXHJcbiAgICBwYXRoOiBcIi9cIixcclxuICAgIG1heEFnZTogNjAgKiA2MCAqIDI0ICogMzAsXHJcbiAgfSk7XHJcbiAgcmVzLnNldEhlYWRlcihcIlNldC1Db29raWVcIiwgY29va2llU3RyaW5nKTtcclxufTtcclxuXHJcbmNvbnN0IHBhcnNlVG9rZW5zID0gKHJlcSkgPT4ge1xyXG4gIGlmICghcmVxLmhlYWRlcnMuY29va2llKSByZXR1cm4gbnVsbDtcclxuICBjb25zdCBjb29raWVzID0gcGFyc2VDb29raWVIZWFkZXIocmVxLmhlYWRlcnMuY29va2llIHx8IFwiXCIpO1xyXG4gIGlmICghY29va2llc1tUT0tFTl9DT09LSUVdKSByZXR1cm4gbnVsbDtcclxuICB0cnkge1xyXG4gICAgcmV0dXJuIGRlY3J5cHQoY29va2llc1tUT0tFTl9DT09LSUVdKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBkZWNyeXB0IHRva2VuIGNvb2tpZVwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBidWlsZEF1dGhVcmwgPSBhc3luYyAoKSA9PiB7XHJcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XHJcbiAgICBjbGllbnRfaWQ6IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9JRCxcclxuICAgIHJlc3BvbnNlX3R5cGU6IFwiY29kZVwiLFxyXG4gICAgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSxcclxuICAgIHJlc3BvbnNlX21vZGU6IFwicXVlcnlcIixcclxuICAgIHNjb3BlOiBTQ09QRVMuam9pbihcIiBcIiksXHJcbiAgICBwcm9tcHQ6IFwic2VsZWN0X2FjY291bnRcIixcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGAke2F1dGhvcml0eX0vYXV0aG9yaXplPyR7cGFyYW1zLnRvU3RyaW5nKCl9YDtcclxufTtcclxuXHJcbmNvbnN0IHRva2VuUmVxdWVzdCA9IGFzeW5jIChmb3JtRGF0YSwgeyBpbmNsdWRlUmVkaXJlY3QgPSB0cnVlIH0gPSB7fSkgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7YXV0aG9yaXR5fS90b2tlbmAsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIgfSxcclxuICAgIGJvZHk6IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xyXG4gICAgICBjbGllbnRfaWQ6IHByb2Nlc3MuZW52LkFaVVJFX0NMSUVOVF9JRCxcclxuICAgICAgY2xpZW50X3NlY3JldDogcHJvY2Vzcy5lbnYuQVpVUkVfQ0xJRU5UX1NFQ1JFVCxcclxuICAgICAgLi4uKGluY2x1ZGVSZWRpcmVjdCA/IHsgcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaSB9IDoge30pLFxyXG4gICAgICAuLi5mb3JtRGF0YSxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgVG9rZW4gZW5kcG9pbnQgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke2Vycm9yfWApO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICByZXR1cm4ge1xyXG4gICAgYWNjZXNzVG9rZW46IGRhdGEuYWNjZXNzX3Rva2VuLFxyXG4gICAgcmVmcmVzaFRva2VuOiBkYXRhLnJlZnJlc2hfdG9rZW4sXHJcbiAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyBkYXRhLmV4cGlyZXNfaW4gKiAxMDAwKS50b0lTT1N0cmluZygpLFxyXG4gIH07XHJcbn07XHJcblxyXG5jb25zdCBleGNoYW5nZUNvZGVGb3JUb2tlbnMgPSBhc3luYyAoY29kZSkgPT5cclxuICB0b2tlblJlcXVlc3Qoe1xyXG4gICAgZ3JhbnRfdHlwZTogXCJhdXRob3JpemF0aW9uX2NvZGVcIixcclxuICAgIGNvZGUsXHJcbiAgICBzY29wZTogU0NPUEVTLmpvaW4oXCIgXCIpLFxyXG4gIH0pO1xyXG5cclxuY29uc3QgcmVmcmVzaFRva2VucyA9IGFzeW5jIChzdG9yZWQpID0+IHtcclxuICBpZiAoIXN0b3JlZD8ucmVmcmVzaFRva2VuKSByZXR1cm4gbnVsbDtcclxuICByZXR1cm4gdG9rZW5SZXF1ZXN0KHtcclxuICAgIGdyYW50X3R5cGU6IFwicmVmcmVzaF90b2tlblwiLFxyXG4gICAgcmVmcmVzaF90b2tlbjogc3RvcmVkLnJlZnJlc2hUb2tlbixcclxuICAgIHNjb3BlOiBTQ09QRVMuam9pbihcIiBcIiksXHJcbiAgfSk7XHJcbn07XHJcblxyXG5sZXQgY2FjaGVkQXBwVG9rZW4gPSBudWxsO1xyXG5cclxuY29uc3QgYXBwVG9rZW5SZXF1ZXN0ID0gYXN5bmMgKCkgPT4ge1xyXG4gIGNvbnN0IHRva2VuID0gYXdhaXQgdG9rZW5SZXF1ZXN0KFxyXG4gICAge1xyXG4gICAgICBncmFudF90eXBlOiBcImNsaWVudF9jcmVkZW50aWFsc1wiLFxyXG4gICAgICBzY29wZTogXCJodHRwczovL2dyYXBoLm1pY3Jvc29mdC5jb20vLmRlZmF1bHRcIixcclxuICAgIH0sXHJcbiAgICB7IGluY2x1ZGVSZWRpcmVjdDogZmFsc2UgfVxyXG4gICk7XHJcblxyXG4gIGNhY2hlZEFwcFRva2VuID0ge1xyXG4gICAgYWNjZXNzVG9rZW46IHRva2VuLmFjY2Vzc1Rva2VuLFxyXG4gICAgZXhwaXJlc0F0OiB0b2tlbi5leHBpcmVzQXQsXHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIGNhY2hlZEFwcFRva2VuO1xyXG59O1xyXG5cclxuY29uc3QgaGFzVmFsaWRBcHBUb2tlbiA9ICgpID0+IHtcclxuICBpZiAoIWNhY2hlZEFwcFRva2VuPy5leHBpcmVzQXQpIHJldHVybiBmYWxzZTtcclxuICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShjYWNoZWRBcHBUb2tlbi5leHBpcmVzQXQpO1xyXG4gIHJldHVybiBleHBpcmVzQXQuZ2V0VGltZSgpID4gRGF0ZS5ub3coKSArIDYwICogMTAwMDtcclxufTtcclxuXHJcbmNvbnN0IGdldEFwcE9ubHlBY2Nlc3NUb2tlbiA9IGFzeW5jICgpID0+IHtcclxuICBpZiAoaGFzVmFsaWRBcHBUb2tlbigpKSB7XHJcbiAgICByZXR1cm4gY2FjaGVkQXBwVG9rZW4uYWNjZXNzVG9rZW47XHJcbiAgfVxyXG5cclxuICBjb25zdCBmcmVzaFRva2VuID0gYXdhaXQgYXBwVG9rZW5SZXF1ZXN0KCk7XHJcbiAgcmV0dXJuIGZyZXNoVG9rZW4uYWNjZXNzVG9rZW47XHJcbn07XHJcblxyXG5jb25zdCBuZWVkc1JlZnJlc2ggPSAodG9rZW5zKSA9PiB7XHJcbiAgaWYgKCF0b2tlbnM/LmV4cGlyZXNBdCkgcmV0dXJuIHRydWU7XHJcbiAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUodG9rZW5zLmV4cGlyZXNBdCk7XHJcbiAgY29uc3QgcmVmcmVzaFRocmVzaG9sZCA9IERhdGUubm93KCkgKyA1ICogNjAgKiAxMDAwO1xyXG4gIHJldHVybiBleHBpcmVzQXQuZ2V0VGltZSgpIDw9IHJlZnJlc2hUaHJlc2hvbGQ7XHJcbn07XHJcblxyXG5jb25zdCBlbnN1cmVUb2tlbnMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICBjb25zdCBzdG9yZWQgPSBwYXJzZVRva2VucyhyZXEpO1xyXG4gIGlmICghc3RvcmVkKSByZXR1cm4gbnVsbDtcclxuXHJcbiAgaWYgKCFuZWVkc1JlZnJlc2goc3RvcmVkKSkge1xyXG4gICAgcmV0dXJuIHN0b3JlZDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHJlZnJlc2hlZCA9IGF3YWl0IHJlZnJlc2hUb2tlbnMoc3RvcmVkKTtcclxuICBpZiAocmVmcmVzaGVkKSB7XHJcbiAgICBzZXJpYWxpemVUb2tlbnMocmVzLCByZWZyZXNoZWQpO1xyXG4gICAgcmV0dXJuIHJlZnJlc2hlZDtcclxuICB9XHJcblxyXG4gIHJldHVybiBudWxsO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgYnVpbGRBdXRoVXJsLFxyXG4gIGVuc3VyZVRva2VucyxcclxuICBleGNoYW5nZUNvZGVGb3JUb2tlbnMsXHJcbiAgZ2V0QXBwT25seUFjY2Vzc1Rva2VuLFxyXG4gIHBhcnNlVG9rZW5zLFxyXG4gIHNlcmlhbGl6ZVRva2VucyxcclxufTsiXSwibmFtZXMiOlsiY3J5cHRvIiwicmVxdWlyZSIsIlRPS0VOX0NPT0tJRSIsIlNDT1BFUyIsInJlcXVpcmVkRW52IiwiZm9yRWFjaCIsImtleSIsInByb2Nlc3MiLCJlbnYiLCJjb25zb2xlIiwid2FybiIsImF1dGhvcml0eSIsIkFaVVJFX1RFTkFOVF9JRCIsInJlZGlyZWN0VXJpIiwiQVpVUkVfUkVESVJFQ1RfVVJJIiwiQkFDS0VORF9CQVNFX1VSTCIsImVuY3J5cHRpb25TZWNyZXQiLCJUT0tFTl9FTkNSWVBUSU9OX0tFWSIsIkFaVVJFX0NMSUVOVF9TRUNSRVQiLCJlbmNyeXB0aW9uS2V5IiwiY3JlYXRlSGFzaCIsInVwZGF0ZSIsImRpZ2VzdCIsInNlcmlhbGl6ZUNvb2tpZSIsIm5hbWUiLCJ2YWx1ZSIsIm9wdGlvbnMiLCJzZWdtZW50cyIsIm1heEFnZSIsInB1c2giLCJkb21haW4iLCJwYXRoIiwic2VjdXJlIiwiaHR0cE9ubHkiLCJzYW1lU2l0ZSIsImpvaW4iLCJwYXJzZUNvb2tpZUhlYWRlciIsImhlYWRlciIsInNwbGl0IiwicmVkdWNlIiwiYWNjIiwicGFydCIsInJlc3QiLCJ0cmltIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZW5jcnlwdCIsImRhdGEiLCJpdiIsInJhbmRvbUJ5dGVzIiwiY2lwaGVyIiwiY3JlYXRlQ2lwaGVyaXYiLCJlbmNyeXB0ZWQiLCJCdWZmZXIiLCJjb25jYXQiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluYWwiLCJhdXRoVGFnIiwiZ2V0QXV0aFRhZyIsInRvU3RyaW5nIiwiZGVjcnlwdCIsInBheWxvYWQiLCJidWZmZXIiLCJmcm9tIiwic3ViYXJyYXkiLCJ0YWciLCJkZWNpcGhlciIsImNyZWF0ZURlY2lwaGVyaXYiLCJzZXRBdXRoVGFnIiwiZGVjcnlwdGVkIiwicGFyc2UiLCJzZXJpYWxpemVUb2tlbnMiLCJyZXMiLCJ0b2tlbnMiLCJlbmNvZGVkIiwiY29va2llU3RyaW5nIiwic2V0SGVhZGVyIiwicGFyc2VUb2tlbnMiLCJyZXEiLCJoZWFkZXJzIiwiY29va2llIiwiY29va2llcyIsImVycm9yIiwiYnVpbGRBdXRoVXJsIiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwiY2xpZW50X2lkIiwiQVpVUkVfQ0xJRU5UX0lEIiwicmVzcG9uc2VfdHlwZSIsInJlZGlyZWN0X3VyaSIsInJlc3BvbnNlX21vZGUiLCJzY29wZSIsInByb21wdCIsInRva2VuUmVxdWVzdCIsImZvcm1EYXRhIiwiaW5jbHVkZVJlZGlyZWN0IiwicmVzcG9uc2UiLCJmZXRjaCIsIm1ldGhvZCIsImJvZHkiLCJjbGllbnRfc2VjcmV0Iiwib2siLCJ0ZXh0IiwiRXJyb3IiLCJzdGF0dXMiLCJqc29uIiwiYWNjZXNzVG9rZW4iLCJhY2Nlc3NfdG9rZW4iLCJyZWZyZXNoVG9rZW4iLCJyZWZyZXNoX3Rva2VuIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsImV4cGlyZXNfaW4iLCJ0b0lTT1N0cmluZyIsImV4Y2hhbmdlQ29kZUZvclRva2VucyIsImNvZGUiLCJncmFudF90eXBlIiwicmVmcmVzaFRva2VucyIsInN0b3JlZCIsImNhY2hlZEFwcFRva2VuIiwiYXBwVG9rZW5SZXF1ZXN0IiwidG9rZW4iLCJoYXNWYWxpZEFwcFRva2VuIiwiZ2V0VGltZSIsImdldEFwcE9ubHlBY2Nlc3NUb2tlbiIsImZyZXNoVG9rZW4iLCJuZWVkc1JlZnJlc2giLCJyZWZyZXNoVGhyZXNob2xkIiwiZW5zdXJlVG9rZW5zIiwicmVmcmVzaGVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./api/_lib/auth.js\n");

/***/ }),

/***/ "(api)/./api/_lib/graph.js":
/*!***************************!*\
  !*** ./api/_lib/graph.js ***!
  \***************************/
/***/ ((module) => {

eval("\nconst GRAPH_BASE = \"https://graph.microsoft.com/v1.0\";\nconst MAX_GRAPH_WINDOW_DAYS = 62;\nconst mapBusyIntervals = (items)=>items.map((item)=>({\n            start: new Date(item.start.dateTime),\n            end: new Date(item.end.dateTime)\n        }));\nconst overlaps = (start, end, busy)=>{\n    return busy.some((interval)=>start < interval.end && end > interval.start);\n};\nconst buildSlots = (startDate, days, intervalMinutes, busy, serviceDurationMinutes)=>{\n    const slotsByDate = {};\n    const workingDayStart = 9;\n    const workingDayEnd = 17;\n    const durationMinutes = Number.isFinite(serviceDurationMinutes) ? serviceDurationMinutes : intervalMinutes;\n    for(let i = 0; i < days; i += 1){\n        const date = new Date(startDate);\n        date.setDate(date.getDate() + i);\n        const currentDate = date.toISOString().slice(0, 10);\n        slotsByDate[currentDate] = [];\n        for(let hour = workingDayStart; hour <= workingDayEnd; hour += 1){\n            for(let minute = 0; minute < 60; minute += intervalMinutes){\n                const slotStart = new Date(date);\n                slotStart.setUTCHours(hour, minute, 0, 0);\n                const slotEnd = new Date(slotStart);\n                slotEnd.setMinutes(slotEnd.getMinutes() + durationMinutes);\n                const workingEndBoundary = new Date(date);\n                workingEndBoundary.setUTCHours(workingDayEnd, 0, 0, 0);\n                const withinWorkingDay = slotEnd <= workingEndBoundary;\n                const time = slotStart.toISOString().slice(11, 16);\n                const available = withinWorkingDay && !overlaps(slotStart, slotEnd, busy);\n                slotsByDate[currentDate].push({\n                    time,\n                    available\n                });\n            }\n        }\n    }\n    return slotsByDate;\n};\nconst buildPrincipalPath = (calendarId)=>calendarId ? `/users/${encodeURIComponent(calendarId)}` : \"/me\";\nconst postScheduleRequest = async ({ accessToken, calendarId, startTime, endTime })=>{\n    const principalPath = buildPrincipalPath(calendarId);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/calendar/getSchedule`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            schedules: [\n                calendarId || \"me\"\n            ],\n            startTime: {\n                dateTime: startTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            endTime: {\n                dateTime: endTime.toISOString(),\n                timeZone: \"UTC\"\n            },\n            availabilityViewInterval: 30\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph schedule error: ${response.status} ${error}`);\n    }\n    return response.json();\n};\nconst getSchedule = async ({ accessToken, calendarId, windowDays = 7, serviceDurationMinutes })=>{\n    const totalDays = Math.max(windowDays, 1);\n    const startTime = new Date();\n    const busy = [];\n    let timeZone = \"UTC\";\n    for(let offset = 0; offset < totalDays; offset += MAX_GRAPH_WINDOW_DAYS){\n        const chunkStart = new Date(startTime);\n        chunkStart.setDate(chunkStart.getDate() + offset);\n        const chunkDays = Math.min(MAX_GRAPH_WINDOW_DAYS, totalDays - offset);\n        const chunkEnd = new Date(chunkStart);\n        chunkEnd.setDate(chunkEnd.getDate() + chunkDays);\n        const data = await postScheduleRequest({\n            accessToken,\n            calendarId,\n            startTime: chunkStart,\n            endTime: chunkEnd\n        });\n        const schedule = data.value?.[0];\n        if (schedule?.workingHours?.timeZone?.name) {\n            timeZone = schedule.workingHours.timeZone.name;\n        }\n        busy.push(...mapBusyIntervals(schedule?.scheduleItems || []));\n    }\n    const slotsByDate = buildSlots(startTime, totalDays, 30, busy, serviceDurationMinutes);\n    const dates = Object.keys(slotsByDate).map((date)=>({\n            date,\n            slots: slotsByDate[date]\n        }));\n    return {\n        timeZone,\n        dates\n    };\n};\nconst createEvent = async ({ accessToken, calendarId, subject, body, start, bodyContentType = \"Text\", end, attendeeEmail, attendeeEmails = [], timeZone = \"UTC\" })=>{\n    const principalPath = buildPrincipalPath(calendarId);\n    const attendees = [\n        ...Array.isArray(attendeeEmails) ? attendeeEmails : [],\n        attendeeEmail\n    ].filter(Boolean).map((address)=>address.trim()).filter(Boolean).reduce((list, address)=>{\n        const key = address.toLowerCase();\n        if (list.some((attendee)=>attendee.emailAddress.address.toLowerCase() === key)) {\n            return list;\n        }\n        return [\n            ...list,\n            {\n                emailAddress: {\n                    address\n                },\n                type: \"required\"\n            }\n        ];\n    }, []);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/events`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            subject,\n            body: {\n                contentType: bodyContentType,\n                content: body\n            },\n            start: {\n                dateTime: start,\n                timeZone\n            },\n            end: {\n                dateTime: end,\n                timeZone\n            },\n            attendees,\n            isReminderOn: true,\n            reminderMinutesBeforeStart: 15\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph create event error: ${response.status} ${error}`);\n    }\n    return response.json();\n};\nconst sendMail = async ({ accessToken, fromCalendarId, to, subject, body, contentType = \"HTML\", from, replyTo })=>{\n    if (!to) {\n        throw new Error(\"sendMail called without recipient email address\");\n    }\n    const recipients = Array.isArray(to) ? to.filter(Boolean).map((address)=>({\n            emailAddress: {\n                address\n            }\n        })) : [\n        {\n            emailAddress: {\n                address: to\n            }\n        }\n    ];\n    const replyToEntries = Array.isArray(replyTo) ? replyTo.filter(Boolean).map((address)=>({\n            emailAddress: {\n                address\n            }\n        })) : replyTo ? [\n        {\n            emailAdDress: {\n                address: replyTo\n            }\n        }\n    ] : undefined;\n    const principalPath = buildPrincipalPath(fromCalendarId);\n    const response = await fetch(`${GRAPH_BASE}${principalPath}/sendMail`, {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${accessToken}`,\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            message: {\n                ...from ? {\n                    from: {\n                        emailAddress: {\n                            address: from\n                        }\n                    }\n                } : {},\n                subject,\n                body: {\n                    contentType,\n                    content: body\n                },\n                toRecipients: recipients,\n                ...replyToEntries ? {\n                    replyTo: replyToEntries\n                } : {}\n            },\n            saveToSentItems: false\n        })\n    });\n    if (!response.ok) {\n        const error = await response.text();\n        throw new Error(`Graph send mail error: ${response.status} ${error}`);\n    }\n};\nmodule.exports = {\n    createEvent,\n    getSchedule,\n    sendMail\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFDQTtRQUFDO1lBQUVHLGNBQWM7Z0JBQUVwQixTQUFTaUI7WUFBUTtRQUFFO0tBQUUsR0FDeENJO0lBRUosTUFBTXJFLGdCQUFnQlAsbUJBQW1CcUU7SUFFekMsTUFBTTdELFdBQVcsTUFBTUMsTUFBTSxDQUFDLEVBQUVyRCxXQUFXLEVBQUVtRCxjQUFjLFNBQVMsQ0FBQyxFQUFFO1FBQ3JFRyxRQUFRO1FBQ1JDLFNBQVM7WUFDUEMsZUFBZSxDQUFDLE9BQU8sRUFBRVIsWUFBWSxDQUFDO1lBQ3RDLGdCQUFnQjtRQUNsQjtRQUNBUyxNQUFNQyxLQUFLQyxTQUFTLENBQUM7WUFDbkI4RCxTQUFTO2dCQUNQLEdBQUlOLE9BQU87b0JBQUVBLE1BQU07d0JBQUVULGNBQWM7NEJBQUVQLFNBQVNnQjt3QkFBSztvQkFBRTtnQkFBRSxJQUFJLENBQUMsQ0FBQztnQkFDN0R6QjtnQkFDQWpDLE1BQU07b0JBQ0ptRDtvQkFDQUMsU0FBU3BEO2dCQUNYO2dCQUNBaUUsY0FBY0w7Z0JBQ2QsR0FBSUMsaUJBQWlCO29CQUFFRixTQUFTRTtnQkFBZSxJQUFJLENBQUMsQ0FBQztZQUN2RDtZQUNBSyxpQkFBaUI7UUFDbkI7SUFDRjtJQUVBLElBQUksQ0FBQ3ZFLFNBQVNXLEVBQUUsRUFBRTtRQUNoQixNQUFNQyxRQUFRLE1BQU1aLFNBQVNhLElBQUk7UUFDakMsTUFBTSxJQUFJQyxNQUFNLENBQUMsdUJBQXVCLEVBQUVkLFNBQVNlLE1BQU0sQ0FBQyxDQUFDLEVBQUVILE1BQU0sQ0FBQztJQUN0RTtBQUNGO0FBRUE0RCxPQUFPQyxPQUFPLEdBQUc7SUFBRXBDO0lBQWFwQjtJQUFhMkM7QUFBUyIsInNvdXJjZXMiOlsid2VicGFjazovL2plcm9lbmFuZHBhd3MvLi9hcGkvX2xpYi9ncmFwaC5qcz82OGQwIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IEdSQVBIX0JBU0UgPSBcImh0dHBzOi8vZ3JhcGgubWljcm9zb2Z0LmNvbS92MS4wXCI7XHJcblxyXG5jb25zdCBNQVhfR1JBUEhfV0lORE9XX0RBWVMgPSA2MjtcclxuXHJcbmNvbnN0IG1hcEJ1c3lJbnRlcnZhbHMgPSAoaXRlbXMpID0+XHJcbiAgaXRlbXMubWFwKChpdGVtKSA9PiAoe1xyXG4gICAgc3RhcnQ6IG5ldyBEYXRlKGl0ZW0uc3RhcnQuZGF0ZVRpbWUpLFxyXG4gICAgZW5kOiBuZXcgRGF0ZShpdGVtLmVuZC5kYXRlVGltZSksXHJcbiAgfSkpO1xyXG5cclxuY29uc3Qgb3ZlcmxhcHMgPSAoc3RhcnQsIGVuZCwgYnVzeSkgPT4ge1xyXG4gIHJldHVybiBidXN5LnNvbWUoKGludGVydmFsKSA9PiBzdGFydCA8IGludGVydmFsLmVuZCAmJiBlbmQgPiBpbnRlcnZhbC5zdGFydCk7XHJcbn07XHJcblxyXG5jb25zdCBidWlsZFNsb3RzID0gKFxyXG4gIHN0YXJ0RGF0ZSxcclxuICBkYXlzLFxyXG4gIGludGVydmFsTWludXRlcyxcclxuICBidXN5LFxyXG4gIHNlcnZpY2VEdXJhdGlvbk1pbnV0ZXNcclxuKSA9PiB7XHJcbiAgY29uc3Qgc2xvdHNCeURhdGUgPSB7fTtcclxuICBjb25zdCB3b3JraW5nRGF5U3RhcnQgPSA5O1xyXG4gIGNvbnN0IHdvcmtpbmdEYXlFbmQgPSAxNztcclxuICBjb25zdCBkdXJhdGlvbk1pbnV0ZXMgPSBOdW1iZXIuaXNGaW5pdGUoc2VydmljZUR1cmF0aW9uTWludXRlcylcclxuICAgID8gc2VydmljZUR1cmF0aW9uTWludXRlc1xyXG4gICAgOiBpbnRlcnZhbE1pbnV0ZXM7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgZGF5czsgaSArPSAxKSB7XHJcbiAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoc3RhcnREYXRlKTtcclxuICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGkpO1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnREYXRlID0gZGF0ZS50b0lTT1N0cmluZygpLnNsaWNlKDAsIDEwKTtcclxuICAgIHNsb3RzQnlEYXRlW2N1cnJlbnREYXRlXSA9IFtdO1xyXG5cclxuICAgIGZvciAobGV0IGhvdXIgPSB3b3JraW5nRGF5U3RhcnQ7IGhvdXIgPD0gd29ya2luZ0RheUVuZDsgaG91ciArPSAxKSB7XHJcbiAgICAgIGZvciAobGV0IG1pbnV0ZSA9IDA7IG1pbnV0ZSA8IDYwOyBtaW51dGUgKz0gaW50ZXJ2YWxNaW51dGVzKSB7XHJcbiAgICAgICAgY29uc3Qgc2xvdFN0YXJ0ID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgICAgICAgc2xvdFN0YXJ0LnNldFVUQ0hvdXJzKGhvdXIsIG1pbnV0ZSwgMCwgMCk7XHJcbiAgICAgICAgY29uc3Qgc2xvdEVuZCA9IG5ldyBEYXRlKHNsb3RTdGFydCk7XHJcbiAgICAgICAgc2xvdEVuZC5zZXRNaW51dGVzKHNsb3RFbmQuZ2V0TWludXRlcygpICsgZHVyYXRpb25NaW51dGVzKTtcclxuICAgICAgICBjb25zdCB3b3JraW5nRW5kQm91bmRhcnkgPSBuZXcgRGF0ZShkYXRlKTtcclxuICAgICAgICB3b3JraW5nRW5kQm91bmRhcnkuc2V0VVRDSG91cnMod29ya2luZ0RheUVuZCwgMCwgMCwgMCk7XHJcbiAgICAgICAgY29uc3Qgd2l0aGluV29ya2luZ0RheSA9IHNsb3RFbmQgPD0gd29ya2luZ0VuZEJvdW5kYXJ5O1xyXG4gICAgICAgIGNvbnN0IHRpbWUgPSBzbG90U3RhcnQudG9JU09TdHJpbmcoKS5zbGljZSgxMSwgMTYpO1xyXG5cclxuICAgICAgICBjb25zdCBhdmFpbGFibGUgPVxyXG4gICAgICAgICAgd2l0aGluV29ya2luZ0RheSAmJiAhb3ZlcmxhcHMoc2xvdFN0YXJ0LCBzbG90RW5kLCBidXN5KTtcclxuICAgICAgICBzbG90c0J5RGF0ZVtjdXJyZW50RGF0ZV0ucHVzaCh7IHRpbWUsIGF2YWlsYWJsZSB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHNsb3RzQnlEYXRlO1xyXG59O1xyXG5cclxuY29uc3QgYnVpbGRQcmluY2lwYWxQYXRoID0gKGNhbGVuZGFySWQpID0+XHJcbiAgY2FsZW5kYXJJZCA/IGAvdXNlcnMvJHtlbmNvZGVVUklDb21wb25lbnQoY2FsZW5kYXJJZCl9YCA6IFwiL21lXCI7XHJcblxyXG5jb25zdCBwb3N0U2NoZWR1bGVSZXF1ZXN0ID0gYXN5bmMgKHtcclxuICBhY2Nlc3NUb2tlbixcclxuICBjYWxlbmRhcklkLFxyXG4gIHN0YXJ0VGltZSxcclxuICBlbmRUaW1lLFxyXG59KSA9PiB7XHJcbiAgY29uc3QgcHJpbmNpcGFsUGF0aCA9IGJ1aWxkUHJpbmNpcGFsUGF0aChjYWxlbmRhcklkKTtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcclxuICAgIGAke0dSQVBIX0JBU0V9JHtwcmluY2lwYWxQYXRofS9jYWxlbmRhci9nZXRTY2hlZHVsZWAsXHJcbiAgICB7XHJcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCxcclxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgfSxcclxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgIHNjaGVkdWxlczogW2NhbGVuZGFySWQgfHwgXCJtZVwiXSxcclxuICAgICAgICBzdGFydFRpbWU6IHsgZGF0ZVRpbWU6IHN0YXJ0VGltZS50b0lTT1N0cmluZygpLCB0aW1lWm9uZTogXCJVVENcIiB9LFxyXG4gICAgICAgIGVuZFRpbWU6IHsgZGF0ZVRpbWU6IGVuZFRpbWUudG9JU09TdHJpbmcoKSwgdGltZVpvbmU6IFwiVVRDXCIgfSxcclxuICAgICAgICBhdmFpbGFiaWxpdHlWaWV3SW50ZXJ2YWw6IDMwLFxyXG4gICAgICB9KSxcclxuICAgIH1cclxuICApO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR3JhcGggc2NoZWR1bGUgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke2Vycm9yfWApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmNvbnN0IGdldFNjaGVkdWxlID0gYXN5bmMgKHtcclxuICBhY2Nlc3NUb2tlbixcclxuICBjYWxlbmRhcklkLFxyXG4gIHdpbmRvd0RheXMgPSA3LFxyXG4gIHNlcnZpY2VEdXJhdGlvbk1pbnV0ZXMsXHJcbn0pID0+IHtcclxuICBjb25zdCB0b3RhbERheXMgPSBNYXRoLm1heCh3aW5kb3dEYXlzLCAxKTtcclxuICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xyXG4gIGNvbnN0IGJ1c3kgPSBbXTtcclxuICBsZXQgdGltZVpvbmUgPSBcIlVUQ1wiO1xyXG5cclxuICBmb3IgKGxldCBvZmZzZXQgPSAwOyBvZmZzZXQgPCB0b3RhbERheXM7IG9mZnNldCArPSBNQVhfR1JBUEhfV0lORE9XX0RBWVMpIHtcclxuICAgIGNvbnN0IGNodW5rU3RhcnQgPSBuZXcgRGF0ZShzdGFydFRpbWUpO1xyXG4gICAgY2h1bmtTdGFydC5zZXREYXRlKGNodW5rU3RhcnQuZ2V0RGF0ZSgpICsgb2Zmc2V0KTtcclxuXHJcbiAgICBjb25zdCBjaHVua0RheXMgPSBNYXRoLm1pbihNQVhfR1JBUEhfV0lORE9XX0RBWVMsIHRvdGFsRGF5cyAtIG9mZnNldCk7XHJcbiAgICBjb25zdCBjaHVua0VuZCA9IG5ldyBEYXRlKGNodW5rU3RhcnQpO1xyXG4gICAgY2h1bmtFbmQuc2V0RGF0ZShjaHVua0VuZC5nZXREYXRlKCkgKyBjaHVua0RheXMpO1xyXG5cclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwb3N0U2NoZWR1bGVSZXF1ZXN0KHtcclxuICAgICAgYWNjZXNzVG9rZW4sXHJcbiAgICAgIGNhbGVuZGFySWQsXHJcbiAgICAgIHN0YXJ0VGltZTogY2h1bmtTdGFydCxcclxuICAgICAgZW5kVGltZTogY2h1bmtFbmQsXHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zdCBzY2hlZHVsZSA9IGRhdGEudmFsdWU/LlswXTtcclxuICAgIGlmIChzY2hlZHVsZT8ud29ya2luZ0hvdXJzPy50aW1lWm9uZT8ubmFtZSkge1xyXG4gICAgICB0aW1lWm9uZSA9IHNjaGVkdWxlLndvcmtpbmdIb3Vycy50aW1lWm9uZS5uYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGJ1c3kucHVzaCguLi5tYXBCdXN5SW50ZXJ2YWxzKHNjaGVkdWxlPy5zY2hlZHVsZUl0ZW1zIHx8IFtdKSk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBzbG90c0J5RGF0ZSA9IGJ1aWxkU2xvdHMoXHJcbiAgICBzdGFydFRpbWUsXHJcbiAgICB0b3RhbERheXMsXHJcbiAgICAzMCxcclxuICAgIGJ1c3ksXHJcbiAgICBzZXJ2aWNlRHVyYXRpb25NaW51dGVzXHJcbiAgKTtcclxuXHJcbiAgY29uc3QgZGF0ZXMgPSBPYmplY3Qua2V5cyhzbG90c0J5RGF0ZSkubWFwKChkYXRlKSA9PiAoe1xyXG4gICAgZGF0ZSxcclxuICAgIHNsb3RzOiBzbG90c0J5RGF0ZVtkYXRlXSxcclxuICB9KSk7XHJcblxyXG4gIHJldHVybiB7IHRpbWVab25lLCBkYXRlcyB9O1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlRXZlbnQgPSBhc3luYyAoe1xyXG4gIGFjY2Vzc1Rva2VuLFxyXG4gIGNhbGVuZGFySWQsXHJcbiAgc3ViamVjdCxcclxuICBib2R5LFxyXG4gIHN0YXJ0LFxyXG4gIGJvZHlDb250ZW50VHlwZSA9IFwiVGV4dFwiLFxyXG4gIGVuZCxcclxuICBhdHRlbmRlZUVtYWlsLFxyXG4gIGF0dGVuZGVlRW1haWxzID0gW10sXHJcbiAgdGltZVpvbmUgPSBcIlVUQ1wiLFxyXG59KSA9PiB7XHJcbiAgY29uc3QgcHJpbmNpcGFsUGF0aCA9IGJ1aWxkUHJpbmNpcGFsUGF0aChjYWxlbmRhcklkKTtcclxuXHJcbiAgY29uc3QgYXR0ZW5kZWVzID0gW1xyXG4gICAgLi4uKEFycmF5LmlzQXJyYXkoYXR0ZW5kZWVFbWFpbHMpID8gYXR0ZW5kZWVFbWFpbHMgOiBbXSksXHJcbiAgICBhdHRlbmRlZUVtYWlsLFxyXG4gIF1cclxuICAgIC5maWx0ZXIoQm9vbGVhbilcclxuICAgIC5tYXAoKGFkZHJlc3MpID0+IGFkZHJlc3MudHJpbSgpKVxyXG4gICAgLmZpbHRlcihCb29sZWFuKVxyXG4gICAgLnJlZHVjZSgobGlzdCwgYWRkcmVzcykgPT4ge1xyXG4gICAgICBjb25zdCBrZXkgPSBhZGRyZXNzLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGlmIChcclxuICAgICAgICBsaXN0LnNvbWUoXHJcbiAgICAgICAgICAoYXR0ZW5kZWUpID0+IGF0dGVuZGVlLmVtYWlsQWRkcmVzcy5hZGRyZXNzLnRvTG93ZXJDYXNlKCkgPT09IGtleVxyXG4gICAgICAgIClcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuIGxpc3Q7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFtcclxuICAgICAgICAuLi5saXN0LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtYWlsQWRkcmVzczogeyBhZGRyZXNzIH0sXHJcbiAgICAgICAgICB0eXBlOiBcInJlcXVpcmVkXCIsXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuICAgIH0sIFtdKTtcclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtHUkFQSF9CQVNFfSR7cHJpbmNpcGFsUGF0aH0vZXZlbnRzYCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAsXHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgc3ViamVjdCxcclxuICAgICAgYm9keToge1xyXG4gICAgICAgIGNvbnRlbnRUeXBlOiBib2R5Q29udGVudFR5cGUsXHJcbiAgICAgICAgY29udGVudDogYm9keSxcclxuICAgICAgfSxcclxuICAgICAgc3RhcnQ6IHsgZGF0ZVRpbWU6IHN0YXJ0LCB0aW1lWm9uZSB9LFxyXG4gICAgICBlbmQ6IHsgZGF0ZVRpbWU6IGVuZCwgdGltZVpvbmUgfSxcclxuICAgICAgYXR0ZW5kZWVzLFxyXG4gICAgICBpc1JlbWluZGVyT246IHRydWUsXHJcbiAgICAgIHJlbWluZGVyTWludXRlc0JlZm9yZVN0YXJ0OiAxNSxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR3JhcGggY3JlYXRlIGV2ZW50IGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtlcnJvcn1gKTtcclxuICB9XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5jb25zdCBzZW5kTWFpbCA9IGFzeW5jICh7XHJcbiAgYWNjZXNzVG9rZW4sXHJcbiAgZnJvbUNhbGVuZGFySWQsXHJcbiAgdG8sXHJcbiAgc3ViamVjdCxcclxuICBib2R5LFxyXG4gIGNvbnRlbnRUeXBlID0gXCJIVE1MXCIsXHJcbiAgZnJvbSxcclxuICByZXBseVRvLFxyXG59KSA9PiB7XHJcbiAgaWYgKCF0bykge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwic2VuZE1haWwgY2FsbGVkIHdpdGhvdXQgcmVjaXBpZW50IGVtYWlsIGFkZHJlc3NcIik7XHJcbiAgfVxyXG5cclxuICBjb25zdCByZWNpcGllbnRzID0gQXJyYXkuaXNBcnJheSh0bylcclxuICAgID8gdG8uZmlsdGVyKEJvb2xlYW4pLm1hcCgoYWRkcmVzcykgPT4gKHtcclxuICAgICAgICBlbWFpbEFkZHJlc3M6IHsgYWRkcmVzcyB9LFxyXG4gICAgICB9KSlcclxuICAgIDogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIGVtYWlsQWRkcmVzczoge1xyXG4gICAgICAgICAgICBhZGRyZXNzOiB0byxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgXTtcclxuXHJcbiAgY29uc3QgcmVwbHlUb0VudHJpZXMgPSBBcnJheS5pc0FycmF5KHJlcGx5VG8pXHJcbiAgICA/IHJlcGx5VG8uZmlsdGVyKEJvb2xlYW4pLm1hcCgoYWRkcmVzcykgPT4gKHtcclxuICAgICAgICBlbWFpbEFkZHJlc3M6IHsgYWRkcmVzcyB9LFxyXG4gICAgICB9KSlcclxuICAgIDogcmVwbHlUb1xyXG4gICAgPyBbeyBlbWFpbEFkRHJlc3M6IHsgYWRkcmVzczogcmVwbHlUbyB9IH1dXHJcbiAgICA6IHVuZGVmaW5lZDtcclxuXHJcbiAgY29uc3QgcHJpbmNpcGFsUGF0aCA9IGJ1aWxkUHJpbmNpcGFsUGF0aChmcm9tQ2FsZW5kYXJJZCk7XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7R1JBUEhfQkFTRX0ke3ByaW5jaXBhbFBhdGh9L3NlbmRNYWlsYCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAsXHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbWVzc2FnZToge1xyXG4gICAgICAgIC4uLihmcm9tID8geyBmcm9tOiB7IGVtYWlsQWRkcmVzczogeyBhZGRyZXNzOiBmcm9tIH0gfSB9IDoge30pLFxyXG4gICAgICAgIHN1YmplY3QsXHJcbiAgICAgICAgYm9keToge1xyXG4gICAgICAgICAgY29udGVudFR5cGUsXHJcbiAgICAgICAgICBjb250ZW50OiBib2R5LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG9SZWNpcGllbnRzOiByZWNpcGllbnRzLFxyXG4gICAgICAgIC4uLihyZXBseVRvRW50cmllcyA/IHsgcmVwbHlUbzogcmVwbHlUb0VudHJpZXMgfSA6IHt9KSxcclxuICAgICAgfSxcclxuICAgICAgc2F2ZVRvU2VudEl0ZW1zOiBmYWxzZSxcclxuICAgIH0pLFxyXG4gIH0pO1xyXG5cclxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XHJcbiAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcclxuICAgIHRocm93IG5ldyBFcnJvcihgR3JhcGggc2VuZCBtYWlsIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtlcnJvcn1gKTtcclxuICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgY3JlYXRlRXZlbnQsIGdldFNjaGVkdWxlLCBzZW5kTWFpbCB9O1xyXG4iXSwibmFtZXMiOlsiR1JBUEhfQkFTRSIsIk1BWF9HUkFQSF9XSU5ET1dfREFZUyIsIm1hcEJ1c3lJbnRlcnZhbHMiLCJpdGVtcyIsIm1hcCIsIml0ZW0iLCJzdGFydCIsIkRhdGUiLCJkYXRlVGltZSIsImVuZCIsIm92ZXJsYXBzIiwiYnVzeSIsInNvbWUiLCJpbnRlcnZhbCIsImJ1aWxkU2xvdHMiLCJzdGFydERhdGUiLCJkYXlzIiwiaW50ZXJ2YWxNaW51dGVzIiwic2VydmljZUR1cmF0aW9uTWludXRlcyIsInNsb3RzQnlEYXRlIiwid29ya2luZ0RheVN0YXJ0Iiwid29ya2luZ0RheUVuZCIsImR1cmF0aW9uTWludXRlcyIsIk51bWJlciIsImlzRmluaXRlIiwiaSIsImRhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImN1cnJlbnREYXRlIiwidG9JU09TdHJpbmciLCJzbGljZSIsImhvdXIiLCJtaW51dGUiLCJzbG90U3RhcnQiLCJzZXRVVENIb3VycyIsInNsb3RFbmQiLCJzZXRNaW51dGVzIiwiZ2V0TWludXRlcyIsIndvcmtpbmdFbmRCb3VuZGFyeSIsIndpdGhpbldvcmtpbmdEYXkiLCJ0aW1lIiwiYXZhaWxhYmxlIiwicHVzaCIsImJ1aWxkUHJpbmNpcGFsUGF0aCIsImNhbGVuZGFySWQiLCJlbmNvZGVVUklDb21wb25lbnQiLCJwb3N0U2NoZWR1bGVSZXF1ZXN0IiwiYWNjZXNzVG9rZW4iLCJzdGFydFRpbWUiLCJlbmRUaW1lIiwicHJpbmNpcGFsUGF0aCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5Iiwic2NoZWR1bGVzIiwidGltZVpvbmUiLCJhdmFpbGFiaWxpdHlWaWV3SW50ZXJ2YWwiLCJvayIsImVycm9yIiwidGV4dCIsIkVycm9yIiwic3RhdHVzIiwianNvbiIsImdldFNjaGVkdWxlIiwid2luZG93RGF5cyIsInRvdGFsRGF5cyIsIk1hdGgiLCJtYXgiLCJvZmZzZXQiLCJjaHVua1N0YXJ0IiwiY2h1bmtEYXlzIiwibWluIiwiY2h1bmtFbmQiLCJkYXRhIiwic2NoZWR1bGUiLCJ2YWx1ZSIsIndvcmtpbmdIb3VycyIsIm5hbWUiLCJzY2hlZHVsZUl0ZW1zIiwiZGF0ZXMiLCJPYmplY3QiLCJrZXlzIiwic2xvdHMiLCJjcmVhdGVFdmVudCIsInN1YmplY3QiLCJib2R5Q29udGVudFR5cGUiLCJhdHRlbmRlZUVtYWlsIiwiYXR0ZW5kZWVFbWFpbHMiLCJhdHRlbmRlZXMiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJCb29sZWFuIiwiYWRkcmVzcyIsInRyaW0iLCJyZWR1Y2UiLCJsaXN0Iiwia2V5IiwidG9Mb3dlckNhc2UiLCJhdHRlbmRlZSIsImVtYWlsQWRkcmVzcyIsInR5cGUiLCJjb250ZW50VHlwZSIsImNvbnRlbnQiLCJpc1JlbWluZGVyT24iLCJyZW1pbmRlck1pbnV0ZXNCZWZvcmVTdGFydCIsInNlbmRNYWlsIiwiZnJvbUNhbGVuZGFySWQiLCJ0byIsImZyb20iLCJyZXBseVRvIiwicmVjaXBpZW50cyIsInJlcGx5VG9FbnRyaWVzIiwiZW1haWxBZERyZXNzIiwidW5kZWZpbmVkIiwibWVzc2FnZSIsInRvUmVjaXBpZW50cyIsInNhdmVUb1NlbnRJdGVtcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./api/_lib/graph.js\n");

/***/ }),

/***/ "(api)/./api/_lib/supabase.js":
/*!******************************!*\
  !*** ./api/_lib/supabase.js ***!
  \******************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { createClient } = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nconst crypto = __webpack_require__(/*! crypto */ \"crypto\");\nconst { DateTime } = __webpack_require__(/*! luxon */ \"luxon\");\nconst supabaseUrl = \"https://jjsxfzhgyfuigogxzire.supabase.co\";\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nlet supabaseAdmin = null;\nif (!supabaseUrl || !supabaseServiceRoleKey) {\n    console.warn(\"Supabase admin client is missing configuration. Check NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY\");\n} else {\n    supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\nconst createConfigError = ()=>{\n    const error = new Error(\"Supabase admin client is not configured. Please set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY.\");\n    error.statusCode = 503;\n    error.publicMessage = \"Bookings are temporarily unavailable. Please try again later.\";\n    return error;\n};\nconst requireSupabase = ()=>{\n    if (!supabaseAdmin) {\n        throw createConfigError();\n    }\n};\nconst hashPassword = (value)=>crypto.createHash(\"sha256\").update(value || \"\").digest(\"hex\");\nconst ensureClientProfile = async ({ email, fullName, phone })=>{\n    requireSupabase();\n    const normalizedEmail = (email || \"\").trim().toLowerCase();\n    if (!normalizedEmail) {\n        throw new Error(\"Client email is required to create a profile\");\n    }\n    const existingClient = await supabaseAdmin.from(\"clients\").select(\"*\").eq(\"email\", normalizedEmail).maybeSingle();\n    if (existingClient.error) {\n        throw existingClient.error;\n    }\n    if (existingClient.data) {\n        return {\n            client: existingClient.data,\n            created: false\n        };\n    }\n    const temporaryPassword = crypto.randomBytes(9).toString(\"base64\");\n    const passwordSetupToken = crypto.randomUUID();\n    const insertResult = await supabaseAdmin.from(\"clients\").insert({\n        email: normalizedEmail,\n        full_name: fullName || null,\n        phone_number: phone || null,\n        hashed_password: hashPassword(temporaryPassword),\n        password_setup_token: passwordSetupToken\n    }).select(\"*\").single();\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return {\n        client: insertResult.data,\n        created: true,\n        temporaryPassword\n    };\n};\nconst ensurePetProfiles = async (clientId, pets = [])=>{\n    requireSupabase();\n    if (!clientId) return [];\n    const ensuredPets = [];\n    for (const pet of pets){\n        if (pet?.id) {\n            const existing = await supabaseAdmin.from(\"pets\").select(\"*\").eq(\"id\", pet.id).eq(\"owner_id\", clientId).maybeSingle();\n            if (existing.error) {\n                throw existing.error;\n            }\n            if (existing.data) {\n                ensuredPets.push(existing.data);\n                continue;\n            }\n        }\n        const insertResult = await supabaseAdmin.from(\"pets\").insert({\n            owner_id: clientId,\n            name: pet?.name || \"New pet\",\n            breed: pet?.breed || null,\n            notes: pet?.notes || null,\n            photo_data_url: pet?.photoDataUrl || null\n        }).select(\"*\").single();\n        if (insertResult.error) {\n            throw insertResult.error;\n        }\n        ensuredPets.push(insertResult.data);\n    }\n    return ensuredPets;\n};\nconst getServiceByIdentifier = async (serviceIdOrSlug)=>{\n    requireSupabase();\n    if (!serviceIdOrSlug) return null;\n    const query = supabaseAdmin.from(\"services_catalog\").select(\"*\").or(`id.eq.${serviceIdOrSlug},slug.eq.${serviceIdOrSlug}`).limit(1);\n    const result = await query.single();\n    if (result.error) {\n        if (result.error.code === \"PGRST116\") {\n            return null;\n        }\n        throw result.error;\n    }\n    return result.data;\n};\nconst createBookingRecord = async ({ clientId, serviceId, serviceTitle, start, end, timeZone, notes })=>{\n    requireSupabase();\n    const insertResult = await supabaseAdmin.from(\"bookings\").insert({\n        client_id: clientId,\n        service_id: serviceId || null,\n        service_title: serviceTitle || null,\n        start_at: start.toUTC().toISO(),\n        end_at: end.toUTC().toISO(),\n        time_zone: timeZone || \"UTC\",\n        notes: notes || null\n    }).select(\"*\").single();\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return insertResult.data;\n};\nconst linkBookingPets = async (bookingId, pets)=>{\n    requireSupabase();\n    if (!bookingId || pets.length === 0) return [];\n    const records = pets.map((pet)=>({\n            booking_id: bookingId,\n            pet_id: pet.id\n        }));\n    const insertResult = await supabaseAdmin.from(\"booking_pets\").insert(records).select(\"*\");\n    if (insertResult.error) {\n        throw insertResult.error;\n    }\n    return insertResult.data;\n};\nconst createBookingWithProfiles = async ({ date, time, durationMinutes = 60, serviceId, serviceTitle, timeZone = \"UTC\", clientName, clientEmail, notes, pets = [], dogCount })=>{\n    requireSupabase();\n    const service = await getServiceByIdentifier(serviceId);\n    const duration = Number.isFinite(durationMinutes) ? durationMinutes : service?.duration_minutes || 60;\n    const start = DateTime.fromISO(`${date}T${time}`, {\n        zone: timeZone || \"UTC\"\n    });\n    const safeStart = start.isValid ? start : DateTime.fromISO(`${date}T${time}`, {\n        zone: \"UTC\"\n    });\n    const end = safeStart.plus({\n        minutes: duration\n    });\n    const { client, created, temporaryPassword } = await ensureClientProfile({\n        email: clientEmail,\n        fullName: clientName\n    });\n    const ensuredPets = await ensurePetProfiles(client.id, pets);\n    const booking = await createBookingRecord({\n        clientId: client.id,\n        serviceId: service?.id || null,\n        serviceTitle: service?.title || serviceTitle,\n        start: safeStart,\n        end,\n        timeZone,\n        notes\n    });\n    await linkBookingPets(booking.id, ensuredPets);\n    return {\n        booking,\n        client,\n        pets: ensuredPets,\n        service,\n        passwordDelivery: created ? {\n            temporaryPassword,\n            passwordSetupToken: client.password_setup_token\n        } : null,\n        totals: {\n            requestedDogCount: dogCount,\n            storedPetCount: ensuredPets.length\n        }\n    };\n};\nmodule.exports = {\n    createBookingWithProfiles,\n    ensureClientProfile,\n    ensurePetProfiles,\n    getServiceByIdentifier,\n    supabaseAdmin\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NkIsT0FBT0MsT0FBTyxHQUFHO0lBQ2Z6QjtJQUNBckU7SUFDQTJCO0lBQ0FjO0lBQ0ExRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL2FwaS9fbGliL3N1cGFiYXNlLmpzP2UxMGQiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IHJlcXVpcmUoJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcycpO1xyXG5jb25zdCBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTtcclxuY29uc3QgeyBEYXRlVGltZSB9ID0gcmVxdWlyZSgnbHV4b24nKTtcclxuXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMO1xyXG5jb25zdCBzdXBhYmFzZVNlcnZpY2VSb2xlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTtcclxuXHJcbmxldCBzdXBhYmFzZUFkbWluID0gbnVsbDtcclxuXHJcbmlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZVJvbGVLZXkpIHtcclxuICBjb25zb2xlLndhcm4oXHJcbiAgICAnU3VwYWJhc2UgYWRtaW4gY2xpZW50IGlzIG1pc3NpbmcgY29uZmlndXJhdGlvbi4gQ2hlY2sgTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGFuZCBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZJ1xyXG4gICk7XHJcbn0gZWxzZSB7XHJcbiAgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlUm9sZUtleSwge1xyXG4gICAgYXV0aDoge1xyXG4gICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcclxuICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlLFxyXG4gICAgfSxcclxuICB9KTtcclxufVxyXG5cclxuY29uc3QgY3JlYXRlQ29uZmlnRXJyb3IgPSAoKSA9PiB7XHJcbiAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoXHJcbiAgICAnU3VwYWJhc2UgYWRtaW4gY2xpZW50IGlzIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBhbmQgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWS4nXHJcbiAgKTtcclxuICBlcnJvci5zdGF0dXNDb2RlID0gNTAzO1xyXG4gIGVycm9yLnB1YmxpY01lc3NhZ2UgPSAnQm9va2luZ3MgYXJlIHRlbXBvcmFyaWx5IHVuYXZhaWxhYmxlLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XHJcbiAgcmV0dXJuIGVycm9yO1xyXG59O1xyXG5cclxuY29uc3QgcmVxdWlyZVN1cGFiYXNlID0gKCkgPT4ge1xyXG4gIGlmICghc3VwYWJhc2VBZG1pbikge1xyXG4gICAgdGhyb3cgY3JlYXRlQ29uZmlnRXJyb3IoKTtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoYXNoUGFzc3dvcmQgPSAodmFsdWUpID0+XHJcbiAgY3J5cHRvLmNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZSh2YWx1ZSB8fCAnJykuZGlnZXN0KCdoZXgnKTtcclxuXHJcbmNvbnN0IGVuc3VyZUNsaWVudFByb2ZpbGUgPSBhc3luYyAoeyBlbWFpbCwgZnVsbE5hbWUsIHBob25lIH0pID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgY29uc3Qgbm9ybWFsaXplZEVtYWlsID0gKGVtYWlsIHx8ICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgaWYgKCFub3JtYWxpemVkRW1haWwpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignQ2xpZW50IGVtYWlsIGlzIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIHByb2ZpbGUnKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGV4aXN0aW5nQ2xpZW50ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgLmZyb20oJ2NsaWVudHMnKVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuZXEoJ2VtYWlsJywgbm9ybWFsaXplZEVtYWlsKVxyXG4gICAgLm1heWJlU2luZ2xlKCk7XHJcblxyXG4gIGlmIChleGlzdGluZ0NsaWVudC5lcnJvcikge1xyXG4gICAgdGhyb3cgZXhpc3RpbmdDbGllbnQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICBpZiAoZXhpc3RpbmdDbGllbnQuZGF0YSkge1xyXG4gICAgcmV0dXJuIHsgY2xpZW50OiBleGlzdGluZ0NsaWVudC5kYXRhLCBjcmVhdGVkOiBmYWxzZSB9O1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdGVtcG9yYXJ5UGFzc3dvcmQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoOSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xyXG4gIGNvbnN0IHBhc3N3b3JkU2V0dXBUb2tlbiA9IGNyeXB0by5yYW5kb21VVUlEKCk7XHJcblxyXG4gIGNvbnN0IGluc2VydFJlc3VsdCA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdjbGllbnRzJylcclxuICAgIC5pbnNlcnQoe1xyXG4gICAgICBlbWFpbDogbm9ybWFsaXplZEVtYWlsLFxyXG4gICAgICBmdWxsX25hbWU6IGZ1bGxOYW1lIHx8IG51bGwsXHJcbiAgICAgIHBob25lX251bWJlcjogcGhvbmUgfHwgbnVsbCxcclxuICAgICAgaGFzaGVkX3Bhc3N3b3JkOiBoYXNoUGFzc3dvcmQodGVtcG9yYXJ5UGFzc3dvcmQpLFxyXG4gICAgICBwYXNzd29yZF9zZXR1cF90b2tlbjogcGFzc3dvcmRTZXR1cFRva2VuLFxyXG4gICAgfSlcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLnNpbmdsZSgpO1xyXG5cclxuICBpZiAoaW5zZXJ0UmVzdWx0LmVycm9yKSB7XHJcbiAgICB0aHJvdyBpbnNlcnRSZXN1bHQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY2xpZW50OiBpbnNlcnRSZXN1bHQuZGF0YSxcclxuICAgIGNyZWF0ZWQ6IHRydWUsXHJcbiAgICB0ZW1wb3JhcnlQYXNzd29yZCxcclxuICB9O1xyXG59O1xyXG5cclxuY29uc3QgZW5zdXJlUGV0UHJvZmlsZXMgPSBhc3luYyAoY2xpZW50SWQsIHBldHMgPSBbXSkgPT4ge1xyXG4gIHJlcXVpcmVTdXBhYmFzZSgpO1xyXG5cclxuICBpZiAoIWNsaWVudElkKSByZXR1cm4gW107XHJcblxyXG4gIGNvbnN0IGVuc3VyZWRQZXRzID0gW107XHJcblxyXG4gIGZvciAoY29uc3QgcGV0IG9mIHBldHMpIHtcclxuICAgIGlmIChwZXQ/LmlkKSB7XHJcbiAgICAgIGNvbnN0IGV4aXN0aW5nID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCdwZXRzJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ2lkJywgcGV0LmlkKVxyXG4gICAgICAgIC5lcSgnb3duZXJfaWQnLCBjbGllbnRJZClcclxuICAgICAgICAubWF5YmVTaW5nbGUoKTtcclxuXHJcbiAgICAgIGlmIChleGlzdGluZy5lcnJvcikge1xyXG4gICAgICAgIHRocm93IGV4aXN0aW5nLmVycm9yO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoZXhpc3RpbmcuZGF0YSkge1xyXG4gICAgICAgIGVuc3VyZWRQZXRzLnB1c2goZXhpc3RpbmcuZGF0YSk7XHJcbiAgICAgICAgY29udGludWU7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBpbnNlcnRSZXN1bHQgPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCdwZXRzJylcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgb3duZXJfaWQ6IGNsaWVudElkLFxyXG4gICAgICAgIG5hbWU6IHBldD8ubmFtZSB8fCAnTmV3IHBldCcsXHJcbiAgICAgICAgYnJlZWQ6IHBldD8uYnJlZWQgfHwgbnVsbCxcclxuICAgICAgICBub3RlczogcGV0Py5ub3RlcyB8fCBudWxsLFxyXG4gICAgICAgIHBob3RvX2RhdGFfdXJsOiBwZXQ/LnBob3RvRGF0YVVybCB8fCBudWxsLFxyXG4gICAgICB9KVxyXG4gICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgLnNpbmdsZSgpO1xyXG5cclxuICAgIGlmIChpbnNlcnRSZXN1bHQuZXJyb3IpIHtcclxuICAgICAgdGhyb3cgaW5zZXJ0UmVzdWx0LmVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIGVuc3VyZWRQZXRzLnB1c2goaW5zZXJ0UmVzdWx0LmRhdGEpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGVuc3VyZWRQZXRzO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0U2VydmljZUJ5SWRlbnRpZmllciA9IGFzeW5jIChzZXJ2aWNlSWRPclNsdWcpID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgaWYgKCFzZXJ2aWNlSWRPclNsdWcpIHJldHVybiBudWxsO1xyXG5cclxuICBjb25zdCBxdWVyeSA9IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdzZXJ2aWNlc19jYXRhbG9nJylcclxuICAgIC5zZWxlY3QoJyonKVxyXG4gICAgLm9yKGBpZC5lcS4ke3NlcnZpY2VJZE9yU2x1Z30sc2x1Zy5lcS4ke3NlcnZpY2VJZE9yU2x1Z31gKVxyXG4gICAgLmxpbWl0KDEpO1xyXG5cclxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBxdWVyeS5zaW5nbGUoKTtcclxuXHJcbiAgaWYgKHJlc3VsdC5lcnJvcikge1xyXG4gICAgaWYgKHJlc3VsdC5lcnJvci5jb2RlID09PSAnUEdSU1QxMTYnKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgcmVzdWx0LmVycm9yO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdC5kYXRhO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlQm9va2luZ1JlY29yZCA9IGFzeW5jICh7XHJcbiAgY2xpZW50SWQsXHJcbiAgc2VydmljZUlkLFxyXG4gIHNlcnZpY2VUaXRsZSxcclxuICBzdGFydCxcclxuICBlbmQsXHJcbiAgdGltZVpvbmUsXHJcbiAgbm90ZXMsXHJcbn0pID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgY29uc3QgaW5zZXJ0UmVzdWx0ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgLmZyb20oJ2Jvb2tpbmdzJylcclxuICAgIC5pbnNlcnQoe1xyXG4gICAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxyXG4gICAgICBzZXJ2aWNlX2lkOiBzZXJ2aWNlSWQgfHwgbnVsbCxcclxuICAgICAgc2VydmljZV90aXRsZTogc2VydmljZVRpdGxlIHx8IG51bGwsXHJcbiAgICAgIHN0YXJ0X2F0OiBzdGFydC50b1VUQygpLnRvSVNPKCksXHJcbiAgICAgIGVuZF9hdDogZW5kLnRvVVRDKCkudG9JU08oKSxcclxuICAgICAgdGltZV96b25lOiB0aW1lWm9uZSB8fCAnVVRDJyxcclxuICAgICAgbm90ZXM6IG5vdGVzIHx8IG51bGwsXHJcbiAgICB9KVxyXG4gICAgLnNlbGVjdCgnKicpXHJcbiAgICAuc2luZ2xlKCk7XHJcblxyXG4gIGlmIChpbnNlcnRSZXN1bHQuZXJyb3IpIHtcclxuICAgIHRocm93IGluc2VydFJlc3VsdC5lcnJvcjtcclxuICB9XHJcblxyXG4gIHJldHVybiBpbnNlcnRSZXN1bHQuZGF0YTtcclxufTtcclxuXHJcbmNvbnN0IGxpbmtCb29raW5nUGV0cyA9IGFzeW5jIChib29raW5nSWQsIHBldHMpID0+IHtcclxuICByZXF1aXJlU3VwYWJhc2UoKTtcclxuXHJcbiAgaWYgKCFib29raW5nSWQgfHwgcGV0cy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcclxuXHJcbiAgY29uc3QgcmVjb3JkcyA9IHBldHMubWFwKChwZXQpID0+ICh7XHJcbiAgICBib29raW5nX2lkOiBib29raW5nSWQsXHJcbiAgICBwZXRfaWQ6IHBldC5pZCxcclxuICB9KSk7XHJcblxyXG4gIGNvbnN0IGluc2VydFJlc3VsdCA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cclxuICAgIC5mcm9tKCdib29raW5nX3BldHMnKVxyXG4gICAgLmluc2VydChyZWNvcmRzKVxyXG4gICAgLnNlbGVjdCgnKicpO1xyXG5cclxuICBpZiAoaW5zZXJ0UmVzdWx0LmVycm9yKSB7XHJcbiAgICB0aHJvdyBpbnNlcnRSZXN1bHQuZXJyb3I7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaW5zZXJ0UmVzdWx0LmRhdGE7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVCb29raW5nV2l0aFByb2ZpbGVzID0gYXN5bmMgKHtcclxuICBkYXRlLFxyXG4gIHRpbWUsXHJcbiAgZHVyYXRpb25NaW51dGVzID0gNjAsXHJcbiAgc2VydmljZUlkLFxyXG4gIHNlcnZpY2VUaXRsZSxcclxuICB0aW1lWm9uZSA9ICdVVEMnLFxyXG4gIGNsaWVudE5hbWUsXHJcbiAgY2xpZW50RW1haWwsXHJcbiAgbm90ZXMsXHJcbiAgcGV0cyA9IFtdLFxyXG4gIGRvZ0NvdW50LFxyXG59KSA9PiB7XHJcbiAgcmVxdWlyZVN1cGFiYXNlKCk7XHJcbiAgXHJcbiAgY29uc3Qgc2VydmljZSA9IGF3YWl0IGdldFNlcnZpY2VCeUlkZW50aWZpZXIoc2VydmljZUlkKTtcclxuICBjb25zdCBkdXJhdGlvbiA9IE51bWJlci5pc0Zpbml0ZShkdXJhdGlvbk1pbnV0ZXMpXHJcbiAgICA/IGR1cmF0aW9uTWludXRlc1xyXG4gICAgOiBzZXJ2aWNlPy5kdXJhdGlvbl9taW51dGVzIHx8IDYwO1xyXG5cclxuICBjb25zdCBzdGFydCA9IERhdGVUaW1lLmZyb21JU08oYCR7ZGF0ZX1UJHt0aW1lfWAsIHsgem9uZTogdGltZVpvbmUgfHwgJ1VUQycgfSk7XHJcbiAgY29uc3Qgc2FmZVN0YXJ0ID0gc3RhcnQuaXNWYWxpZCA/IHN0YXJ0IDogRGF0ZVRpbWUuZnJvbUlTTyhgJHtkYXRlfVQke3RpbWV9YCwgeyB6b25lOiAnVVRDJyB9KTtcclxuICBjb25zdCBlbmQgPSBzYWZlU3RhcnQucGx1cyh7IG1pbnV0ZXM6IGR1cmF0aW9uIH0pO1xyXG5cclxuICBjb25zdCB7IGNsaWVudCwgY3JlYXRlZCwgdGVtcG9yYXJ5UGFzc3dvcmQgfSA9IGF3YWl0IGVuc3VyZUNsaWVudFByb2ZpbGUoe1xyXG4gICAgZW1haWw6IGNsaWVudEVtYWlsLFxyXG4gICAgZnVsbE5hbWU6IGNsaWVudE5hbWUsXHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGVuc3VyZWRQZXRzID0gYXdhaXQgZW5zdXJlUGV0UHJvZmlsZXMoY2xpZW50LmlkLCBwZXRzKTtcclxuXHJcbiAgY29uc3QgYm9va2luZyA9IGF3YWl0IGNyZWF0ZUJvb2tpbmdSZWNvcmQoe1xyXG4gICAgY2xpZW50SWQ6IGNsaWVudC5pZCxcclxuICAgIHNlcnZpY2VJZDogc2VydmljZT8uaWQgfHwgbnVsbCxcclxuICAgIHNlcnZpY2VUaXRsZTogc2VydmljZT8udGl0bGUgfHwgc2VydmljZVRpdGxlLFxyXG4gICAgc3RhcnQ6IHNhZmVTdGFydCxcclxuICAgIGVuZCxcclxuICAgIHRpbWVab25lLFxyXG4gICAgbm90ZXMsXHJcbiAgfSk7XHJcblxyXG4gIGF3YWl0IGxpbmtCb29raW5nUGV0cyhib29raW5nLmlkLCBlbnN1cmVkUGV0cyk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBib29raW5nLFxyXG4gICAgY2xpZW50LFxyXG4gICAgcGV0czogZW5zdXJlZFBldHMsXHJcbiAgICBzZXJ2aWNlLFxyXG4gICAgcGFzc3dvcmREZWxpdmVyeTogY3JlYXRlZFxyXG4gICAgICA/IHtcclxuICAgICAgICAgIHRlbXBvcmFyeVBhc3N3b3JkLFxyXG4gICAgICAgICAgcGFzc3dvcmRTZXR1cFRva2VuOiBjbGllbnQucGFzc3dvcmRfc2V0dXBfdG9rZW4sXHJcbiAgICAgICAgfVxyXG4gICAgICA6IG51bGwsXHJcbiAgICB0b3RhbHM6IHtcclxuICAgICAgcmVxdWVzdGVkRG9nQ291bnQ6IGRvZ0NvdW50LFxyXG4gICAgICBzdG9yZWRQZXRDb3VudDogZW5zdXJlZFBldHMubGVuZ3RoLFxyXG4gICAgfSxcclxuICB9O1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcbiAgY3JlYXRlQm9va2luZ1dpdGhQcm9maWxlcyxcclxuICBlbnN1cmVDbGllbnRQcm9maWxlLFxyXG4gIGVuc3VyZVBldFByb2ZpbGVzLFxyXG4gIGdldFNlcnZpY2VCeUlkZW50aWZpZXIsXHJcbiAgc3VwYWJhc2VBZG1pbixcclxufTsiXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwicmVxdWlyZSIsImNyeXB0byIsIkRhdGVUaW1lIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlUm9sZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJzdXBhYmFzZUFkbWluIiwiY29uc29sZSIsIndhcm4iLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiY3JlYXRlQ29uZmlnRXJyb3IiLCJlcnJvciIsIkVycm9yIiwic3RhdHVzQ29kZSIsInB1YmxpY01lc3NhZ2UiLCJyZXF1aXJlU3VwYWJhc2UiLCJoYXNoUGFzc3dvcmQiLCJ2YWx1ZSIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJlbnN1cmVDbGllbnRQcm9maWxlIiwiZW1haWwiLCJmdWxsTmFtZSIsInBob25lIiwibm9ybWFsaXplZEVtYWlsIiwidHJpbSIsInRvTG93ZXJDYXNlIiwiZXhpc3RpbmdDbGllbnQiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsImRhdGEiLCJjbGllbnQiLCJjcmVhdGVkIiwidGVtcG9yYXJ5UGFzc3dvcmQiLCJyYW5kb21CeXRlcyIsInRvU3RyaW5nIiwicGFzc3dvcmRTZXR1cFRva2VuIiwicmFuZG9tVVVJRCIsImluc2VydFJlc3VsdCIsImluc2VydCIsImZ1bGxfbmFtZSIsInBob25lX251bWJlciIsImhhc2hlZF9wYXNzd29yZCIsInBhc3N3b3JkX3NldHVwX3Rva2VuIiwic2luZ2xlIiwiZW5zdXJlUGV0UHJvZmlsZXMiLCJjbGllbnRJZCIsInBldHMiLCJlbnN1cmVkUGV0cyIsInBldCIsImlkIiwiZXhpc3RpbmciLCJwdXNoIiwib3duZXJfaWQiLCJuYW1lIiwiYnJlZWQiLCJub3RlcyIsInBob3RvX2RhdGFfdXJsIiwicGhvdG9EYXRhVXJsIiwiZ2V0U2VydmljZUJ5SWRlbnRpZmllciIsInNlcnZpY2VJZE9yU2x1ZyIsInF1ZXJ5Iiwib3IiLCJsaW1pdCIsInJlc3VsdCIsImNvZGUiLCJjcmVhdGVCb29raW5nUmVjb3JkIiwic2VydmljZUlkIiwic2VydmljZVRpdGxlIiwic3RhcnQiLCJlbmQiLCJ0aW1lWm9uZSIsImNsaWVudF9pZCIsInNlcnZpY2VfaWQiLCJzZXJ2aWNlX3RpdGxlIiwic3RhcnRfYXQiLCJ0b1VUQyIsInRvSVNPIiwiZW5kX2F0IiwidGltZV96b25lIiwibGlua0Jvb2tpbmdQZXRzIiwiYm9va2luZ0lkIiwibGVuZ3RoIiwicmVjb3JkcyIsIm1hcCIsImJvb2tpbmdfaWQiLCJwZXRfaWQiLCJjcmVhdGVCb29raW5nV2l0aFByb2ZpbGVzIiwiZGF0ZSIsInRpbWUiLCJkdXJhdGlvbk1pbnV0ZXMiLCJjbGllbnROYW1lIiwiY2xpZW50RW1haWwiLCJkb2dDb3VudCIsInNlcnZpY2UiLCJkdXJhdGlvbiIsIk51bWJlciIsImlzRmluaXRlIiwiZHVyYXRpb25fbWludXRlcyIsImZyb21JU08iLCJ6b25lIiwic2FmZVN0YXJ0IiwiaXNWYWxpZCIsInBsdXMiLCJtaW51dGVzIiwiYm9va2luZyIsInRpdGxlIiwicGFzc3dvcmREZWxpdmVyeSIsInRvdGFscyIsInJlcXVlc3RlZERvZ0NvdW50Iiwic3RvcmVkUGV0Q291bnQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./api/_lib/supabase.js\n");

/***/ }),

/***/ "(api)/./api/book.js":
/*!*********************!*\
  !*** ./api/book.js ***!
  \*********************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("\nconst { DateTime } = __webpack_require__(/*! luxon */ \"luxon\");\nconst { getAppOnlyAccessToken } = __webpack_require__(/*! ./_lib/auth */ \"(api)/./api/_lib/auth.js\");\nconst { sendMail } = __webpack_require__(/*! ./_lib/graph */ \"(api)/./api/_lib/graph.js\");\nconst { createBookingWithProfiles } = __webpack_require__(/*! ./_lib/supabase */ \"(api)/./api/_lib/supabase.js\");\nconst parseBody = async (req)=>{\n    const chunks = [];\n    for await (const chunk of req){\n        chunks.push(chunk);\n    }\n    const body = Buffer.concat(chunks).toString(\"utf8\");\n    return body ? JSON.parse(body) : {};\n};\nconst escapeHtml = (value = \"\")=>String(value).replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\");\nconst buildFriendlyTiming = ({ start, end, timeZone = \"UTC\" })=>{\n    const format = \"cccc, LLLL d, yyyy 'at' t ZZZZ\";\n    const zone = timeZone || \"UTC\";\n    const safeStart = start.setZone(zone, {\n        keepLocalTime: false\n    });\n    const safeEnd = end.setZone(zone, {\n        keepLocalTime: false\n    });\n    return {\n        start: safeStart.toFormat(format),\n        end: safeEnd.toFormat(format),\n        timeZone: zone\n    };\n};\nconst buildConfirmationBody = ({ clientName, timing, service, notes, pets, passwordDelivery })=>{\n    const readableService = service?.title || service?.serviceTitle || \"Training\";\n    const petDetails = (pets || []).map((pet, index)=>{\n        const name = escapeHtml(pet?.name || `Pet ${index + 1}`);\n        const breed = escapeHtml(pet?.breed || \"Breed pending\");\n        return `<li><strong>${name}</strong> (${breed})</li>`;\n    });\n    const passwordBlock = passwordDelivery ? `<p style=\"margin: 16px 0 0;\">An account has been created for you so you can update bookings and pets later. Use this temporary password to sign in: <strong>${escapeHtml(passwordDelivery.temporaryPassword)}</strong>.</p>` : \"\";\n    const notesBlock = notes ? `<p style=\"margin: 16px 0 0;\"><strong>Notes from you:</strong><br>${escapeHtml(notes)}</p>` : \"\";\n    const petsBlock = petDetails.length > 0 ? `<ol style=\"margin: 0; padding-left: 20px;\">${petDetails.join(\"\")}</ol>` : '<p style=\"margin: 8px 0 0;\">No pets were attached yet.</p>';\n    return `\r\n    <div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #111;\">\r\n      <p style=\"margin: 0 0 12px;\">Hi ${escapeHtml(clientName || \"there\")},</p>\r\n      <p style=\"margin: 0 0 12px;\">\r\n        Thank you for booking <strong>${escapeHtml(readableService)}</strong>. Here are your appointment details:\r\n      </p>\r\n      <ul style=\"padding-left: 20px; margin: 0 0 12px;\">\r\n        <li><strong>Starts:</strong> ${escapeHtml(timing.start)}</li>\r\n        <li><strong>Ends:</strong> ${escapeHtml(timing.end)}</li>\r\n        <li><strong>Time zone:</strong> ${escapeHtml(timing.timeZone || \"UTC\")}</li>\r\n      </ul>\r\n      <p style=\"margin: 12px 0 8px;\"><strong>Pets:</strong></p>\r\n      ${petsBlock}\r\n      ${notesBlock}\r\n       ${passwordBlock}\r\n      <p style=\"margin: 16px 0 0;\">If you need to reschedule or have questions, just reply to this email and we'll be happy to help.</p>\r\n      <p style=\"margin: 8px 0 0;\">Looking forward to seeing you soon!</p>\r\n    </div>\r\n  `;\n};\nconst buildNotificationBody = ({ service, client, timing, notes, pets })=>{\n    const readableService = service?.title || service?.serviceTitle || \"Training\";\n    const petDetails = (pets || []).map((pet, index)=>{\n        const name = escapeHtml(pet?.name || `Pet ${index + 1}`);\n        const breed = escapeHtml(pet?.breed || \"Breed pending\");\n        return `<li><strong>${name}</strong> (${breed})</li>`;\n    });\n    const notesBlock = notes ? `<p style=\"margin: 16px 0 0;\"><strong>Client notes:</strong><br>${escapeHtml(notes)}</p>` : \"\";\n    return `\r\n    <div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #111;\">\r\n      <p style=\"margin: 0 0 12px;\">New booking received:</p>\r\n      <ul style=\"padding-left: 20px; margin: 0 0 12px;\">\r\n        <li><strong>Client:</strong> ${escapeHtml(client?.full_name || client?.email)}</li>\r\n        <li><strong>Email:</strong> ${escapeHtml(client?.email)}</li>\r\n        <li><strong>Service:</strong> ${escapeHtml(readableService)}</li>\r\n        <li><strong>Starts:</strong> ${escapeHtml(timing.start)}</li>\r\n        <li><strong>Ends:</strong> ${escapeHtml(timing.end)}</li>\r\n        <li><strong>Time zone:</strong> ${escapeHtml(timing.timeZone || \"UTC\")}</li>\r\n      </ul>\r\n      <p style=\"margin: 12px 0 8px;\"><strong>Pets:</strong></p>\r\n      <ol style=\"margin: 0; padding-left: 20px;\">${petDetails.join(\"\")}</ol>\r\n      ${notesBlock}\r\n      <p style=\"margin: 16px 0 0;\">This is an internal notification for Jeroen & Paws.</p>\r\n    </div>\r\n  `;\n};\nmodule.exports = async (req, res)=>{\n    if (req.method !== \"POST\") {\n        res.statusCode = 405;\n        res.setHeader(\"Allow\", \"POST\");\n        res.end(\"Method Not Allowed\");\n        return;\n    }\n    try {\n        const calendarId = process.env.OUTLOOK_CALENDAR_ID;\n        let accessToken = null;\n        if (calendarId) {\n            try {\n                accessToken = await getAppOnlyAccessToken();\n            } catch (authError) {\n                console.error(\"Booking email auth error\", authError);\n            }\n        }\n        const body = await parseBody(req);\n        const { date, time, durationMinutes = 60, serviceId, serviceTitle, clientName, clientEmail, notes, timeZone = \"UTC\", pets = [], dogs = [], dogCount } = body;\n        if (!date || !time) {\n            res.statusCode = 400;\n            res.end(JSON.stringify({\n                message: \"Missing date or time\"\n            }));\n            return;\n        }\n        const petsFromBody = Array.isArray(pets) && pets.length ? pets : dogs || [];\n        const bookingResult = await createBookingWithProfiles({\n            date,\n            time,\n            durationMinutes,\n            serviceId,\n            serviceTitle,\n            clientName,\n            clientEmail,\n            notes,\n            timeZone,\n            pets: petsFromBody,\n            dogCount\n        });\n        const timing = buildFriendlyTiming({\n            start: DateTime.fromISO(bookingResult.booking.start_at, {\n                zone: \"UTC\"\n            }),\n            end: DateTime.fromISO(bookingResult.booking.end_at, {\n                zone: \"UTC\"\n            }),\n            timeZone\n        });\n        if (accessToken && calendarId && clientEmail) {\n            try {\n                const confirmationBody = buildConfirmationBody({\n                    clientName,\n                    timing,\n                    service: bookingResult.service || {\n                        serviceTitle\n                    },\n                    notes,\n                    pets: bookingResult.pets,\n                    passwordDelivery: bookingResult.passwordDelivery\n                });\n                await sendMail({\n                    accessToken,\n                    fromCalendarId: calendarId,\n                    to: clientEmail,\n                    subject: bookingResult.service?.title || serviceTitle,\n                    body: confirmationBody,\n                    contentType: \"HTML\"\n                });\n                const notificationRecipients = [\n                    process.env.BOOKING_NOTIFICATION_EMAIL,\n                    process.env.NOTIFY_EMAIL,\n                    process.env.JEROEN_AND_PAWS_EMAIL,\n                    \"jeroen@jeroenandpaws.com\"\n                ].filter(Boolean);\n                if (notificationRecipients.length) {\n                    const notificationBody = buildNotificationBody({\n                        service: bookingResult.service || {\n                            serviceTitle\n                        },\n                        client: bookingResult.client,\n                        timing,\n                        notes,\n                        pets: bookingResult.pets\n                    });\n                    await sendMail({\n                        accessToken,\n                        fromCalendarId: calendarId,\n                        to: notificationRecipients,\n                        subject: `New booking: ${bookingResult.service?.title || serviceTitle}`,\n                        body: notificationBody,\n                        contentType: \"HTML\"\n                    });\n                }\n            } catch (emailError) {\n                console.error(\"Booking email delivery failed\", emailError);\n            }\n        }\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify({\n            booking: bookingResult.booking,\n            client: bookingResult.client,\n            pets: bookingResult.pets,\n            passwordDelivery: bookingResult.passwordDelivery,\n            service: bookingResult.service || {\n                title: serviceTitle\n            },\n            totals: bookingResult.totals\n        }));\n    } catch (error) {\n        console.error(\"Booking error\", error);\n        const status = error.statusCode || error.status || 500;\n        const message = error.publicMessage || error.message || \"Failed to book event. Please try again later.\";\n        res.statusCode = status;\n        res.setHeader(\"Content-Type\", \"application/json\");\n        res.end(JSON.stringify({\n            message\n        }));\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWdCO1FBQzlCSCxJQUFJckMsR0FBRyxDQUNMUixLQUFLZ0UsU0FBUyxDQUFDO1lBQ2JPLFNBQVNGLGNBQWNFLE9BQU87WUFDOUIvQixRQUFRNkIsY0FBYzdCLE1BQU07WUFDNUJsQixNQUFNK0MsY0FBYy9DLElBQUk7WUFDeEJDLGtCQUFrQjhDLGNBQWM5QyxnQkFBZ0I7WUFDaERILFNBQVNpRCxjQUFjakQsT0FBTyxJQUFJO2dCQUFFSyxPQUFPQztZQUFhO1lBQ3hENkQsUUFBUWxCLGNBQWNrQixNQUFNO1FBQzlCO0lBRUosRUFBRSxPQUFPL0IsT0FBTztRQUNkRCxRQUFRQyxLQUFLLENBQUMsaUJBQWlCQTtRQUMvQixNQUFNZ0MsU0FBU2hDLE1BQU1ULFVBQVUsSUFBSVMsTUFBTWdDLE1BQU0sSUFBSTtRQUNuRCxNQUFNdkIsVUFDSlQsTUFBTWlDLGFBQWEsSUFDbkJqQyxNQUFNUyxPQUFPLElBQ2I7UUFFRnBCLElBQUlFLFVBQVUsR0FBR3lDO1FBQ2pCM0MsSUFBSUcsU0FBUyxDQUFDLGdCQUFnQjtRQUM5QkgsSUFBSXJDLEdBQUcsQ0FBQ1IsS0FBS2dFLFNBQVMsQ0FBQztZQUFFQztRQUFRO0lBQ25DO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9qZXJvZW5hbmRwYXdzLy4vYXBpL2Jvb2suanM/OWIwYSJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IERhdGVUaW1lIH0gPSByZXF1aXJlKCdsdXhvbicpO1xyXG5jb25zdCB7IGdldEFwcE9ubHlBY2Nlc3NUb2tlbiB9ID0gcmVxdWlyZSgnLi9fbGliL2F1dGgnKTtcclxuY29uc3QgeyBzZW5kTWFpbCB9ID0gcmVxdWlyZSgnLi9fbGliL2dyYXBoJyk7XHJcbmNvbnN0IHsgY3JlYXRlQm9va2luZ1dpdGhQcm9maWxlcyB9ID0gcmVxdWlyZSgnLi9fbGliL3N1cGFiYXNlJyk7XHJcblxyXG5jb25zdCBwYXJzZUJvZHkgPSBhc3luYyAocmVxKSA9PiB7XHJcbiAgY29uc3QgY2h1bmtzID0gW107XHJcbiAgZm9yIGF3YWl0IChjb25zdCBjaHVuayBvZiByZXEpIHtcclxuICAgIGNodW5rcy5wdXNoKGNodW5rKTtcclxuICB9XHJcbiAgY29uc3QgYm9keSA9IEJ1ZmZlci5jb25jYXQoY2h1bmtzKS50b1N0cmluZygndXRmOCcpO1xyXG4gIHJldHVybiBib2R5ID8gSlNPTi5wYXJzZShib2R5KSA6IHt9O1xyXG59O1xyXG5cclxuY29uc3QgZXNjYXBlSHRtbCA9ICh2YWx1ZSA9ICcnKSA9PlxyXG4gIFN0cmluZyh2YWx1ZSlcclxuICAgIC5yZXBsYWNlKC8mL2csICcmYW1wOycpXHJcbiAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXHJcbiAgICAucmVwbGFjZSgvPi9nLCAnJmd0OycpXHJcbiAgICAucmVwbGFjZSgvXCIvZywgJyZxdW90OycpXHJcbiAgICAucmVwbGFjZSgvJy9nLCAnJiMzOTsnKTtcclxuXHJcbmNvbnN0IGJ1aWxkRnJpZW5kbHlUaW1pbmcgPSAoeyBzdGFydCwgZW5kLCB0aW1lWm9uZSA9ICdVVEMnIH0pID0+IHtcclxuICBjb25zdCBmb3JtYXQgPSBcImNjY2MsIExMTEwgZCwgeXl5eSAnYXQnIHQgWlpaWlwiO1xyXG4gIGNvbnN0IHpvbmUgPSB0aW1lWm9uZSB8fCAnVVRDJztcclxuICBjb25zdCBzYWZlU3RhcnQgPSBzdGFydC5zZXRab25lKHpvbmUsIHsga2VlcExvY2FsVGltZTogZmFsc2UgfSk7XHJcbiAgY29uc3Qgc2FmZUVuZCA9IGVuZC5zZXRab25lKHpvbmUsIHsga2VlcExvY2FsVGltZTogZmFsc2UgfSk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBzdGFydDogc2FmZVN0YXJ0LnRvRm9ybWF0KGZvcm1hdCksXHJcbiAgICBlbmQ6IHNhZmVFbmQudG9Gb3JtYXQoZm9ybWF0KSxcclxuICAgIHRpbWVab25lOiB6b25lLFxyXG4gIH07XHJcbn07XHJcblxyXG5jb25zdCBidWlsZENvbmZpcm1hdGlvbkJvZHkgPSAoe1xyXG4gIGNsaWVudE5hbWUsXHJcbiAgdGltaW5nLFxyXG4gIHNlcnZpY2UsXHJcbiAgbm90ZXMsXHJcbiAgcGV0cyxcclxuICBwYXNzd29yZERlbGl2ZXJ5LFxyXG59KSA9PiB7XHJcbiAgY29uc3QgcmVhZGFibGVTZXJ2aWNlID0gc2VydmljZT8udGl0bGUgfHwgc2VydmljZT8uc2VydmljZVRpdGxlIHx8ICdUcmFpbmluZyc7XHJcbiAgY29uc3QgcGV0RGV0YWlscyA9IChwZXRzIHx8IFtdKS5tYXAoKHBldCwgaW5kZXgpID0+IHtcclxuICAgIGNvbnN0IG5hbWUgPSBlc2NhcGVIdG1sKHBldD8ubmFtZSB8fCBgUGV0ICR7aW5kZXggKyAxfWApO1xyXG4gICAgY29uc3QgYnJlZWQgPSBlc2NhcGVIdG1sKHBldD8uYnJlZWQgfHwgJ0JyZWVkIHBlbmRpbmcnKTtcclxuICAgIHJldHVybiBgPGxpPjxzdHJvbmc+JHtuYW1lfTwvc3Ryb25nPiAoJHticmVlZH0pPC9saT5gO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBwYXNzd29yZEJsb2NrID0gcGFzc3dvcmREZWxpdmVyeVxyXG4gICAgPyBgPHAgc3R5bGU9XCJtYXJnaW46IDE2cHggMCAwO1wiPkFuIGFjY291bnQgaGFzIGJlZW4gY3JlYXRlZCBmb3IgeW91IHNvIHlvdSBjYW4gdXBkYXRlIGJvb2tpbmdzIGFuZCBwZXRzIGxhdGVyLiBVc2UgdGhpcyB0ZW1wb3JhcnkgcGFzc3dvcmQgdG8gc2lnbiBpbjogPHN0cm9uZz4ke2VzY2FwZUh0bWwoXHJcbiAgICAgICAgcGFzc3dvcmREZWxpdmVyeS50ZW1wb3JhcnlQYXNzd29yZFxyXG4gICAgICApfTwvc3Ryb25nPi48L3A+YFxyXG4gICAgOiAnJztcclxuXHJcbiAgY29uc3Qgbm90ZXNCbG9jayA9IG5vdGVzXHJcbiAgICA/IGA8cCBzdHlsZT1cIm1hcmdpbjogMTZweCAwIDA7XCI+PHN0cm9uZz5Ob3RlcyBmcm9tIHlvdTo8L3N0cm9uZz48YnI+JHtlc2NhcGVIdG1sKFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgICl9PC9wPmBcclxuICAgIDogJyc7XHJcblxyXG4gIGNvbnN0IHBldHNCbG9jayA9XHJcbiAgICBwZXREZXRhaWxzLmxlbmd0aCA+IDBcclxuICAgICAgPyBgPG9sIHN0eWxlPVwibWFyZ2luOiAwOyBwYWRkaW5nLWxlZnQ6IDIwcHg7XCI+JHtwZXREZXRhaWxzLmpvaW4oJycpfTwvb2w+YFxyXG4gICAgICA6ICc8cCBzdHlsZT1cIm1hcmdpbjogOHB4IDAgMDtcIj5ObyBwZXRzIHdlcmUgYXR0YWNoZWQgeWV0LjwvcD4nO1xyXG5cclxuICByZXR1cm4gYFxyXG4gICAgPGRpdiBzdHlsZT1cImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsgbGluZS1oZWlnaHQ6IDEuNjsgY29sb3I6ICMxMTE7XCI+XHJcbiAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiAwIDAgMTJweDtcIj5IaSAke2VzY2FwZUh0bWwoY2xpZW50TmFtZSB8fCAndGhlcmUnKX0sPC9wPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogMCAwIDEycHg7XCI+XHJcbiAgICAgICAgVGhhbmsgeW91IGZvciBib29raW5nIDxzdHJvbmc+JHtlc2NhcGVIdG1sKHJlYWRhYmxlU2VydmljZSl9PC9zdHJvbmc+LiBIZXJlIGFyZSB5b3VyIGFwcG9pbnRtZW50IGRldGFpbHM6XHJcbiAgICAgIDwvcD5cclxuICAgICAgPHVsIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAyMHB4OyBtYXJnaW46IDAgMCAxMnB4O1wiPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPlN0YXJ0czo8L3N0cm9uZz4gJHtlc2NhcGVIdG1sKHRpbWluZy5zdGFydCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5FbmRzOjwvc3Ryb25nPiAke2VzY2FwZUh0bWwodGltaW5nLmVuZCl9PC9saT5cclxuICAgICAgICA8bGk+PHN0cm9uZz5UaW1lIHpvbmU6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbCh0aW1pbmcudGltZVpvbmUgfHwgJ1VUQycpfTwvbGk+XHJcbiAgICAgIDwvdWw+XHJcbiAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiAxMnB4IDAgOHB4O1wiPjxzdHJvbmc+UGV0czo8L3N0cm9uZz48L3A+XHJcbiAgICAgICR7cGV0c0Jsb2NrfVxyXG4gICAgICAke25vdGVzQmxvY2t9XHJcbiAgICAgICAke3Bhc3N3b3JkQmxvY2t9XHJcbiAgICAgIDxwIHN0eWxlPVwibWFyZ2luOiAxNnB4IDAgMDtcIj5JZiB5b3UgbmVlZCB0byByZXNjaGVkdWxlIG9yIGhhdmUgcXVlc3Rpb25zLCBqdXN0IHJlcGx5IHRvIHRoaXMgZW1haWwgYW5kIHdlJ2xsIGJlIGhhcHB5IHRvIGhlbHAuPC9wPlxyXG4gICAgICA8cCBzdHlsZT1cIm1hcmdpbjogOHB4IDAgMDtcIj5Mb29raW5nIGZvcndhcmQgdG8gc2VlaW5nIHlvdSBzb29uITwvcD5cclxuICAgIDwvZGl2PlxyXG4gIGA7XHJcbn07XHJcblxyXG5jb25zdCBidWlsZE5vdGlmaWNhdGlvbkJvZHkgPSAoe1xyXG4gIHNlcnZpY2UsXHJcbiAgY2xpZW50LFxyXG4gIHRpbWluZyxcclxuICBub3RlcyxcclxuICBwZXRzLFxyXG59KSA9PiB7XHJcbiAgY29uc3QgcmVhZGFibGVTZXJ2aWNlID0gc2VydmljZT8udGl0bGUgfHwgc2VydmljZT8uc2VydmljZVRpdGxlIHx8ICdUcmFpbmluZyc7XHJcbiAgY29uc3QgcGV0RGV0YWlscyA9IChwZXRzIHx8IFtdKS5tYXAoKHBldCwgaW5kZXgpID0+IHtcclxuICAgIGNvbnN0IG5hbWUgPSBlc2NhcGVIdG1sKHBldD8ubmFtZSB8fCBgUGV0ICR7aW5kZXggKyAxfWApO1xyXG4gICAgY29uc3QgYnJlZWQgPSBlc2NhcGVIdG1sKHBldD8uYnJlZWQgfHwgJ0JyZWVkIHBlbmRpbmcnKTtcclxuICAgIHJldHVybiBgPGxpPjxzdHJvbmc+JHtuYW1lfTwvc3Ryb25nPiAoJHticmVlZH0pPC9saT5gO1xyXG4gIH0pO1xyXG5cclxuICBjb25zdCBub3Rlc0Jsb2NrID0gbm90ZXNcclxuICAgID8gYDxwIHN0eWxlPVwibWFyZ2luOiAxNnB4IDAgMDtcIj48c3Ryb25nPkNsaWVudCBub3Rlczo8L3N0cm9uZz48YnI+JHtlc2NhcGVIdG1sKFxyXG4gICAgICAgIG5vdGVzXHJcbiAgICAgICl9PC9wPmBcclxuICAgIDogJyc7XHJcblxyXG4gIHJldHVybiBgXHJcbiAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBsaW5lLWhlaWdodDogMS42OyBjb2xvcjogIzExMTtcIj5cclxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDAgMCAxMnB4O1wiPk5ldyBib29raW5nIHJlY2VpdmVkOjwvcD5cclxuICAgICAgPHVsIHN0eWxlPVwicGFkZGluZy1sZWZ0OiAyMHB4OyBtYXJnaW46IDAgMCAxMnB4O1wiPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPkNsaWVudDo8L3N0cm9uZz4gJHtlc2NhcGVIdG1sKGNsaWVudD8uZnVsbF9uYW1lIHx8IGNsaWVudD8uZW1haWwpfTwvbGk+XHJcbiAgICAgICAgPGxpPjxzdHJvbmc+RW1haWw6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbChjbGllbnQ/LmVtYWlsKX08L2xpPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPlNlcnZpY2U6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbChyZWFkYWJsZVNlcnZpY2UpfTwvbGk+XHJcbiAgICAgICAgPGxpPjxzdHJvbmc+U3RhcnRzOjwvc3Ryb25nPiAke2VzY2FwZUh0bWwodGltaW5nLnN0YXJ0KX08L2xpPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPkVuZHM6PC9zdHJvbmc+ICR7ZXNjYXBlSHRtbCh0aW1pbmcuZW5kKX08L2xpPlxyXG4gICAgICAgIDxsaT48c3Ryb25nPlRpbWUgem9uZTo8L3N0cm9uZz4gJHtlc2NhcGVIdG1sKHRpbWluZy50aW1lWm9uZSB8fCAnVVRDJyl9PC9saT5cclxuICAgICAgPC91bD5cclxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDEycHggMCA4cHg7XCI+PHN0cm9uZz5QZXRzOjwvc3Ryb25nPjwvcD5cclxuICAgICAgPG9sIHN0eWxlPVwibWFyZ2luOiAwOyBwYWRkaW5nLWxlZnQ6IDIwcHg7XCI+JHtwZXREZXRhaWxzLmpvaW4oJycpfTwvb2w+XHJcbiAgICAgICR7bm90ZXNCbG9ja31cclxuICAgICAgPHAgc3R5bGU9XCJtYXJnaW46IDE2cHggMCAwO1wiPlRoaXMgaXMgYW4gaW50ZXJuYWwgbm90aWZpY2F0aW9uIGZvciBKZXJvZW4gJiBQYXdzLjwvcD5cclxuICAgIDwvZGl2PlxyXG4gIGA7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcclxuICAgIHJlcy5zdGF0dXNDb2RlID0gNDA1O1xyXG4gICAgcmVzLnNldEhlYWRlcignQWxsb3cnLCAnUE9TVCcpO1xyXG4gICAgcmVzLmVuZCgnTWV0aG9kIE5vdCBBbGxvd2VkJyk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgY29uc3QgY2FsZW5kYXJJZCA9IHByb2Nlc3MuZW52Lk9VVExPT0tfQ0FMRU5EQVJfSUQ7XHJcbiAgICBsZXQgYWNjZXNzVG9rZW4gPSBudWxsO1xyXG5cclxuICAgIGlmIChjYWxlbmRhcklkKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgYWNjZXNzVG9rZW4gPSBhd2FpdCBnZXRBcHBPbmx5QWNjZXNzVG9rZW4oKTtcclxuICAgICAgfSBjYXRjaCAoYXV0aEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignQm9va2luZyBlbWFpbCBhdXRoIGVycm9yJywgYXV0aEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHBhcnNlQm9keShyZXEpO1xyXG4gICAgY29uc3Qge1xyXG4gICAgICBkYXRlLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkdXJhdGlvbk1pbnV0ZXMgPSA2MCxcclxuICAgICAgc2VydmljZUlkLFxyXG4gICAgICBzZXJ2aWNlVGl0bGUsXHJcbiAgICAgIGNsaWVudE5hbWUsXHJcbiAgICAgIGNsaWVudEVtYWlsLFxyXG4gICAgICBub3RlcyxcclxuICAgICAgdGltZVpvbmUgPSAnVVRDJyxcclxuICAgICAgcGV0cyA9IFtdLFxyXG4gICAgICBkb2dzID0gW10sXHJcbiAgICAgIGRvZ0NvdW50LFxyXG4gICAgfSA9IGJvZHk7XHJcblxyXG4gICAgaWYgKCFkYXRlIHx8ICF0aW1lKSB7XHJcbiAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xyXG4gICAgICByZXMuZW5kKEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogJ01pc3NpbmcgZGF0ZSBvciB0aW1lJyB9KSk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwZXRzRnJvbUJvZHkgPSBBcnJheS5pc0FycmF5KHBldHMpICYmIHBldHMubGVuZ3RoID8gcGV0cyA6IGRvZ3MgfHwgW107XHJcblxyXG4gICAgY29uc3QgYm9va2luZ1Jlc3VsdCA9IGF3YWl0IGNyZWF0ZUJvb2tpbmdXaXRoUHJvZmlsZXMoe1xyXG4gICAgICBkYXRlLFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkdXJhdGlvbk1pbnV0ZXMsXHJcbiAgICAgIHNlcnZpY2VJZCxcclxuICAgICAgc2VydmljZVRpdGxlLFxyXG4gICAgICBjbGllbnROYW1lLFxyXG4gICAgICBjbGllbnRFbWFpbCxcclxuICAgICAgbm90ZXMsXHJcbiAgICAgIHRpbWVab25lLFxyXG4gICAgICBwZXRzOiBwZXRzRnJvbUJvZHksXHJcbiAgICAgIGRvZ0NvdW50LFxyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgdGltaW5nID0gYnVpbGRGcmllbmRseVRpbWluZyh7XHJcbiAgICAgIHN0YXJ0OiBEYXRlVGltZS5mcm9tSVNPKGJvb2tpbmdSZXN1bHQuYm9va2luZy5zdGFydF9hdCwgeyB6b25lOiAnVVRDJyB9KSxcclxuICAgICAgZW5kOiBEYXRlVGltZS5mcm9tSVNPKGJvb2tpbmdSZXN1bHQuYm9va2luZy5lbmRfYXQsIHsgem9uZTogJ1VUQycgfSksXHJcbiAgICAgIHRpbWVab25lLFxyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKGFjY2Vzc1Rva2VuICYmIGNhbGVuZGFySWQgJiYgY2xpZW50RW1haWwpIHtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBjb25maXJtYXRpb25Cb2R5ID0gYnVpbGRDb25maXJtYXRpb25Cb2R5KHtcclxuICAgICAgICAgIGNsaWVudE5hbWUsXHJcbiAgICAgICAgICB0aW1pbmcsXHJcbiAgICAgICAgICBzZXJ2aWNlOiBib29raW5nUmVzdWx0LnNlcnZpY2UgfHwgeyBzZXJ2aWNlVGl0bGUgfSxcclxuICAgICAgICAgIG5vdGVzLFxyXG4gICAgICAgICAgcGV0czogYm9va2luZ1Jlc3VsdC5wZXRzLFxyXG4gICAgICAgICAgcGFzc3dvcmREZWxpdmVyeTogYm9va2luZ1Jlc3VsdC5wYXNzd29yZERlbGl2ZXJ5LFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBhd2FpdCBzZW5kTWFpbCh7XHJcbiAgICAgICAgICBhY2Nlc3NUb2tlbixcclxuICAgICAgICAgIGZyb21DYWxlbmRhcklkOiBjYWxlbmRhcklkLFxyXG4gICAgICAgICAgdG86IGNsaWVudEVtYWlsLFxyXG4gICAgICAgICAgc3ViamVjdDogYm9va2luZ1Jlc3VsdC5zZXJ2aWNlPy50aXRsZSB8fCBzZXJ2aWNlVGl0bGUsXHJcbiAgICAgICAgICBib2R5OiBjb25maXJtYXRpb25Cb2R5LFxyXG4gICAgICAgICAgY29udGVudFR5cGU6ICdIVE1MJyxcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uUmVjaXBpZW50cyA9IFtcclxuICAgICAgICAgIHByb2Nlc3MuZW52LkJPT0tJTkdfTk9USUZJQ0FUSU9OX0VNQUlMLFxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTk9USUZZX0VNQUlMLFxyXG4gICAgICAgICAgcHJvY2Vzcy5lbnYuSkVST0VOX0FORF9QQVdTX0VNQUlMLFxyXG4gICAgICAgICAgJ2plcm9lbkBqZXJvZW5hbmRwYXdzLmNvbScsXHJcbiAgICAgICAgXS5maWx0ZXIoQm9vbGVhbik7XHJcblxyXG4gICAgICAgIGlmIChub3RpZmljYXRpb25SZWNpcGllbnRzLmxlbmd0aCkge1xyXG4gICAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uQm9keSA9IGJ1aWxkTm90aWZpY2F0aW9uQm9keSh7XHJcbiAgICAgICAgICAgIHNlcnZpY2U6IGJvb2tpbmdSZXN1bHQuc2VydmljZSB8fCB7IHNlcnZpY2VUaXRsZSB9LFxyXG4gICAgICAgICAgICBjbGllbnQ6IGJvb2tpbmdSZXN1bHQuY2xpZW50LFxyXG4gICAgICAgICAgICB0aW1pbmcsXHJcbiAgICAgICAgICAgIG5vdGVzLFxyXG4gICAgICAgICAgICBwZXRzOiBib29raW5nUmVzdWx0LnBldHMsXHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBhd2FpdCBzZW5kTWFpbCh7XHJcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuLFxyXG4gICAgICAgICAgICBmcm9tQ2FsZW5kYXJJZDogY2FsZW5kYXJJZCxcclxuICAgICAgICAgICAgdG86IG5vdGlmaWNhdGlvblJlY2lwaWVudHMsXHJcbiAgICAgICAgICAgIHN1YmplY3Q6IGBOZXcgYm9va2luZzogJHtib29raW5nUmVzdWx0LnNlcnZpY2U/LnRpdGxlIHx8IHNlcnZpY2VUaXRsZX1gLFxyXG4gICAgICAgICAgICBib2R5OiBub3RpZmljYXRpb25Cb2R5LFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogJ0hUTUwnLFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChlbWFpbEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignQm9va2luZyBlbWFpbCBkZWxpdmVyeSBmYWlsZWQnLCBlbWFpbEVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcclxuICAgIHJlcy5lbmQoXHJcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICBib29raW5nOiBib29raW5nUmVzdWx0LmJvb2tpbmcsXHJcbiAgICAgICAgY2xpZW50OiBib29raW5nUmVzdWx0LmNsaWVudCxcclxuICAgICAgICBwZXRzOiBib29raW5nUmVzdWx0LnBldHMsXHJcbiAgICAgICAgcGFzc3dvcmREZWxpdmVyeTogYm9va2luZ1Jlc3VsdC5wYXNzd29yZERlbGl2ZXJ5LFxyXG4gICAgICAgIHNlcnZpY2U6IGJvb2tpbmdSZXN1bHQuc2VydmljZSB8fCB7IHRpdGxlOiBzZXJ2aWNlVGl0bGUgfSxcclxuICAgICAgICB0b3RhbHM6IGJvb2tpbmdSZXN1bHQudG90YWxzLFxyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQm9va2luZyBlcnJvcicsIGVycm9yKTtcclxuICAgIGNvbnN0IHN0YXR1cyA9IGVycm9yLnN0YXR1c0NvZGUgfHwgZXJyb3Iuc3RhdHVzIHx8IDUwMDtcclxuICAgIGNvbnN0IG1lc3NhZ2UgPVxyXG4gICAgICBlcnJvci5wdWJsaWNNZXNzYWdlIHx8XHJcbiAgICAgIGVycm9yLm1lc3NhZ2UgfHxcclxuICAgICAgJ0ZhaWxlZCB0byBib29rIGV2ZW50LiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLic7XHJcblxyXG4gICAgcmVzLnN0YXR1c0NvZGUgPSBzdGF0dXM7XHJcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xyXG4gICAgcmVzLmVuZChKU09OLnN0cmluZ2lmeSh7IG1lc3NhZ2UgfSkpO1xyXG4gIH1cclxufTsiXSwibmFtZXMiOlsiRGF0ZVRpbWUiLCJyZXF1aXJlIiwiZ2V0QXBwT25seUFjY2Vzc1Rva2VuIiwic2VuZE1haWwiLCJjcmVhdGVCb29raW5nV2l0aFByb2ZpbGVzIiwicGFyc2VCb2R5IiwicmVxIiwiY2h1bmtzIiwiY2h1bmsiLCJwdXNoIiwiYm9keSIsIkJ1ZmZlciIsImNvbmNhdCIsInRvU3RyaW5nIiwiSlNPTiIsInBhcnNlIiwiZXNjYXBlSHRtbCIsInZhbHVlIiwiU3RyaW5nIiwicmVwbGFjZSIsImJ1aWxkRnJpZW5kbHlUaW1pbmciLCJzdGFydCIsImVuZCIsInRpbWVab25lIiwiZm9ybWF0Iiwiem9uZSIsInNhZmVTdGFydCIsInNldFpvbmUiLCJrZWVwTG9jYWxUaW1lIiwic2FmZUVuZCIsInRvRm9ybWF0IiwiYnVpbGRDb25maXJtYXRpb25Cb2R5IiwiY2xpZW50TmFtZSIsInRpbWluZyIsInNlcnZpY2UiLCJub3RlcyIsInBldHMiLCJwYXNzd29yZERlbGl2ZXJ5IiwicmVhZGFibGVTZXJ2aWNlIiwidGl0bGUiLCJzZXJ2aWNlVGl0bGUiLCJwZXREZXRhaWxzIiwibWFwIiwicGV0IiwiaW5kZXgiLCJuYW1lIiwiYnJlZWQiLCJwYXNzd29yZEJsb2NrIiwidGVtcG9yYXJ5UGFzc3dvcmQiLCJub3Rlc0Jsb2NrIiwicGV0c0Jsb2NrIiwibGVuZ3RoIiwiam9pbiIsImJ1aWxkTm90aWZpY2F0aW9uQm9keSIsImNsaWVudCIsImZ1bGxfbmFtZSIsImVtYWlsIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlcyIsIm1ldGhvZCIsInN0YXR1c0NvZGUiLCJzZXRIZWFkZXIiLCJjYWxlbmRhcklkIiwicHJvY2VzcyIsImVudiIsIk9VVExPT0tfQ0FMRU5EQVJfSUQiLCJhY2Nlc3NUb2tlbiIsImF1dGhFcnJvciIsImNvbnNvbGUiLCJlcnJvciIsImRhdGUiLCJ0aW1lIiwiZHVyYXRpb25NaW51dGVzIiwic2VydmljZUlkIiwiY2xpZW50RW1haWwiLCJkb2dzIiwiZG9nQ291bnQiLCJzdHJpbmdpZnkiLCJtZXNzYWdlIiwicGV0c0Zyb21Cb2R5IiwiQXJyYXkiLCJpc0FycmF5IiwiYm9va2luZ1Jlc3VsdCIsImZyb21JU08iLCJib29raW5nIiwic3RhcnRfYXQiLCJlbmRfYXQiLCJjb25maXJtYXRpb25Cb2R5IiwiZnJvbUNhbGVuZGFySWQiLCJ0byIsInN1YmplY3QiLCJjb250ZW50VHlwZSIsIm5vdGlmaWNhdGlvblJlY2lwaWVudHMiLCJCT09LSU5HX05PVElGSUNBVElPTl9FTUFJTCIsIk5PVElGWV9FTUFJTCIsIkpFUk9FTl9BTkRfUEFXU19FTUFJTCIsImZpbHRlciIsIkJvb2xlYW4iLCJub3RpZmljYXRpb25Cb2R5IiwiZW1haWxFcnJvciIsInRvdGFscyIsInN0YXR1cyIsInB1YmxpY01lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./api/book.js\n");

/***/ }),

/***/ "(api)/./pages/api/book.js":
/*!***************************!*\
  !*** ./pages/api/book.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst bookHandler = __webpack_require__(/*! ../../api/book */ \"(api)/./api/book.js\");\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (bookHandler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvYm9vay5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLE1BQU1BLGNBQWNDLG1CQUFPQSxDQUFDO0FBRXJCLE1BQU1DLFNBQVM7SUFDcEJDLEtBQUs7UUFDSEMsWUFBWTtJQUNkO0FBQ0YsRUFBRTtBQUVGLGlFQUFlSixXQUFXQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vamVyb2VuYW5kcGF3cy8uL3BhZ2VzL2FwaS9ib29rLmpzPzI5MDMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYm9va0hhbmRsZXIgPSByZXF1aXJlKCcuLi8uLi9hcGkvYm9vaycpO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBhcGk6IHtcclxuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxyXG4gIH0sXHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBib29rSGFuZGxlcjsiXSwibmFtZXMiOlsiYm9va0hhbmRsZXIiLCJyZXF1aXJlIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/book.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fbook&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cbook.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();